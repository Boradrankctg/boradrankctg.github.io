<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Users Panel ‚Äî BoardRankCTG</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <main style="max-width: 1400px; margin: 20px auto;">
    <h1>üîê Admin Users Panel</h1>
    
    <div id="adminLogin" style="max-width: 400px; margin: 40px auto; padding: 20px; border: 2px solid #333; border-radius: 10px;">
      <h2>Admin Login Required</h2>
      <input type="password" id="adminPass" placeholder="Admin password" style="width: 100%; padding: 10px; margin: 10px 0;" />
      <button onclick="verifyAdmin()">Login</button>
    </div>

    <div id="usersPanel" style="display: none;">
      <h2>Registered Users</h2>
      <table style="width: 100%;">
        <thead>
          <tr>
            <th>#</th>
            <th>UID</th>
            <th>Email</th>
            <th>Name</th>
            <th>Institution</th>
            <th>Type</th>
            <th>Created</th>
            <th>Last Login</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="usersTable">
          <tr><td colspan="9">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.verifyAdmin = function() {
      const pass = document.getElementById('adminPass').value;
      if (pass === 'admin@boardrank2025') { // Change this password!
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('usersPanel').style.display = 'block';
        loadUsers();
      } else {
        alert('Wrong password!');
      }
    };

    function loadUsers() {
      onValue(ref(db, 'users'), (snapshot) => {
        const users = snapshot.val() || {};
        const tbody = document.getElementById('usersTable');
        tbody.innerHTML = '';
        
        let count = 1;
        Object.entries(users).forEach(([uid, user]) => {
          tbody.innerHTML += `
            <tr>
              <td>${count++}</td>
              <td>${uid.substring(0, 8)}...</td>
              <td>${user.email || '-'}</td>
              <td>${user.displayName || '-'}</td>
              <td>${user.institution || '-'}</td>
              <td>${user.type || '-'}</td>
              <td>${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : '-'}</td>
              <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : '-'}</td>
              <td>
                <button onclick="deleteUser('${uid}')">Delete</button>
              </td>
            </tr>
          `;
        });
      });
    }

    window.deleteUser = async function(uid) {
      if (confirm('Delete this user?')) {
        await remove(ref(db, `users/${uid}`));
      }
    };
  </script>
</body>
</html>