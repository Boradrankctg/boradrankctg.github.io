about.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>About ‚Äî BoardRankCTG (Unofficial)</title>
  <meta name="description" content="About BoardRankCTG ‚Äî unofficial SSC & HSC rankings for Chattogram Board. Learn the purpose, method, and who built it." />
  <meta name="keywords" content="About BoardRankCTG, Chittagong Board, SSC ranking, HSC ranking, Chattogram Education Board" />
  <meta name="author" content="Hasnyne" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://boradrankctg.github.io/rank/about.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="About ‚Äî BoardRankCTG" />
  <meta property="og:description" content="Unofficial SSC & HSC rankings for Chattogram Board ‚Äî purpose, approach, and team." />
  <meta property="og:url" content="https://boradrankctg.github.io/rank/about.html" />
  <meta property="og:type" content="website" />

  <!-- Fonts + Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />

  <!-- Fav -->
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />

  <!-- About-page specific styles (kept compact) -->
  <style>
    .about-main {
      max-width: 960px; width: 95%;
      background: #fff; margin: 24px auto; padding: 32px 24px 40px;
      border-radius: 12px; border: 2px solid #000; box-sizing: border-box; text-align: left;
      box-shadow: 4px 4px 15px rgba(0,179,122,0.3), -4px -4px 15px rgba(0,179,122,0.2);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; color: #222;
    }
    .about-main h1 {
      font-size: 2.1rem; font-weight: 900; margin-bottom: 18px; color: #00b37a;
      text-align: center; text-shadow: 0 0 6px #00b37a88;
    }
    .about-main h2 {
      font-size: 1.35rem; margin-top: 28px; margin-bottom: 12px; color: #00764f; font-weight: 800;
      border-left: 5px solid #00b37a; padding-left: 12px; letter-spacing: .02em; text-shadow: 0 0 4px #00b37a66;
    }
    .about-main p, .about-main li {
      font-size: 1.04rem; line-height: 1.7; color: #333; font-weight: 600; margin-bottom: 12px;
    }
    .about-main ul, .about-main ol { padding-left: 26px; margin-bottom: 20px; }
    .about-main li::marker { color: #00b37a; font-weight: 700; }
    .about-main strong { color: #00764f; font-weight: 900; }
    .about-main .green { color: #00b37a; font-weight: 700; }

    .about-main .contact {
      background: #e8f7f1; border: 2px dashed #00b37a;
      padding: 18px 18px 22px; border-radius: 12px; margin-top: 24px;
      box-shadow: 0 0 10px #00b37a33;
    }
    .about-main .contact h2 { color: #009e6b; margin-bottom: 10px; font-weight: 900; letter-spacing: .04em; }
    .about-main .contact p { margin: 8px 0; font-size: 1rem; }
    .about-main .contact a { color: #00764f; font-weight: 700; text-decoration: none; }
    .about-main .contact a:hover { text-decoration: underline; color: #004d32; }

    .about-main .special-thanks {
      margin-top: 26px; padding: 14px 16px; background: #f0fff9; border-left: 5px solid #00b37a;
      border-radius: 8px; font-size: 1.05rem; font-weight: 700; color: #00764f; text-align: center;
      box-shadow: 0 0 12px #00b37a44;
    }

    @media (max-width: 600px) {
      .about-main { padding: 22px 16px 30px; margin: 18px auto; }
      .about-main h1 { font-size: 1.6rem; }
      .about-main h2 { font-size: 1.15rem; padding-left: 10px; }
      .about-main p, .about-main li { font-size: .98rem; }
      .about-main .special-thanks { font-size: .98rem; padding: 12px; }
    }

    /* Dark mode overrides */
    body.dark-mode .about-main {
      background: #121a12; border-color: #00ff99;
      box-shadow: 4px 4px 15px #004d2044, -4px -4px 15px #00764f55; color: #cce5cc;
    }
    body.dark-mode .about-main h1 { color: #00ff99; text-shadow: 0 0 8px #00ff9955; }
    body.dark-mode .about-main h2 { color: #00cc77; border-left-color: #00ff99; text-shadow: 0 0 6px #00ff9966; }
    body.dark-mode .about-main p, body.dark-mode .about-main li { color: #b0e6b0; }
    body.dark-mode .about-main strong { color: #00cc77; }
    body.dark-mode .about-main .green { color: #00ff99; }
    body.dark-mode .about-main .contact { background: #002d00; border-color: #00ff99; box-shadow: 0 0 12px #00ff9933; }
    body.dark-mode .about-main .contact a { color: #00ff99; }
    body.dark-mode .about-main .special-thanks { background: #003a00; border-left-color: #00ff99; color: #00ff99; box-shadow: 0 0 15px #00ff9966; }
  </style>
</head>
<body>

    <nav class="app-nav" role="navigation">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>

      <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
        <li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
        <li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
        <li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>

        <li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
        <li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>

        <li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
        <li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
        <li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>

        <li class="divider"></li>
        <li>
          <label class="theme-switch" title="Toggle theme">
            <input type="checkbox" id="themeToggle" />
            <span class="slider" aria-hidden="true"></span>
            <span class="label">Dark mode</span>
          </label>
        </li>
      </ul>
    </div>
    <div class="nav-overlay" id="navOverlay"></div>
  </nav>

  <div id="annBanner" class="ann-banner type-info" style="display:none;">
    <div class="ann-inner">
      <div class="ann-text" id="annText"></div>
      <a id="annBtn" class="ann-btn" href="#" target="_blank" rel="noopener" style="display:none;">Learn more</a>
    </div>
  </div>

  <main class="about-main">
    <h1><i class="fas fa-info-circle"></i> About This Project</h1>
    <p>Hi! I'm <strong>Hasnyne</strong>, an ex-student of <strong>Chittagong College</strong>. I built this site to help <span class="green">SSC students</span> find out where they stand ‚Äî and where they can go next.</p>

    <h2><i class="fas fa-bullseye"></i> Purpose</h2>
    <ul>
      <li>üîé See your <span class="green">position</span> in the merit list</li>
      <li>üè´ Know which <span class="green">colleges</span> are within your range</li>
      <li>üìÖ Browse <span class="green">group-wise</span> and <span class="green">year-wise</span> rankings</li>
      <li>üìä Filter by <strong>roll</strong>, <strong>marks</strong>, or <strong>college</strong></li>
      <li>üìà View <span class="green">cutoff trends</span> from previous years</li>
      <li>‚ö° Fast, mobile-friendly, and zero ads</li>
    </ul>

    <h2><i class="fas fa-cogs"></i> Ranking Formula</h2>
    <ol>
      <li><strong>GPA</strong> ‚Äì main filter</li>
      <li><strong>Total Marks</strong> ‚Äì for finer sort</li>
      <li><strong>PCM Total</strong> ‚Äì Physics + Chemistry + Compulsory, as tie-breaker</li>
    </ol>
    <p>This isn't from the board ‚Äî it's a <strong>personal project</strong> based on <span class="green">publicly available data</span>.</p>

    <h2><i class="fas fa-exclamation-triangle"></i> Notes</h2>
    <p>I‚Äôm <strong>not a pro developer</strong>. This site was made with the help of AI tools ‚Äî so you might find a few bugs, issues, or missing info. If you spot something broken or want your name removed, just <span class="green">reach out</span> ‚Äî I got you.</p>

    <div class="special-thanks">
      <i class="fas fa-hands-helping"></i> Special thanks to <strong>Tasin (Pre-Buetian)</strong> for making this possible.
    </div>

    <div class="contact">
      <h2><i class="fas fa-envelope"></i> Contact Me</h2>
      <p><i class="fab fa-whatsapp"></i> <strong>WhatsApp:</strong> <a href="https://wa.me/8801788481222" target="_blank" rel="noopener">+8801788481222</a></p>
      <p><i class="fas fa-envelope"></i> <strong>Email:</strong> <a href="mailto:hasnyne2007@gmail.com">hasnyne2007@gmail.com</a></p>
      <p><i class="fab fa-facebook"></i> <strong>Facebook:</strong> <a href="https://www.facebook.com/hasnyne.mostafa" target="_blank" rel="noopener">hasnyne.mostafa</a></p>
      <p><i class="fab fa-instagram"></i> <strong>Instagram:</strong> <a href="https://www.instagram.com/hasnyne.01/" target="_blank" rel="noopener">@hasnyne.01</a></p>
    </div>
  </main>

  <footer>
    &copy; 2025 BoardRankCTG ‚Äî Made by Hasnyne
  </footer>

  <!-- Ban overlay (script enforces if device is banned) -->
  <div id="banOverlay">
    <div class="ban-card">
      <h3>üö´ Access Restricted</h3>
      <p id="banReason">Reason: ‚Äî</p>
      <p id="banUntil">Until: ‚Äî</p>
      <div id="banTimer" style="font-weight:800;margin-top:6px;"></div>
      <p style="margin-top:12px;font-size:.9rem;">If you think this is a mistake, contact the admin.</p>
    </div>
  </div>

 <script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script></body>
</html>
}

admin.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BoardRankCTG ‚Äî Local Admin (Poll, Banner, Global Settings)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

</head>
<body>
  <div class="wrap">
    <div class="bar">
      <h1>BoardRankCTG ‚Äî Local Admin</h1>
      <div id="conn" class="muted">DB: ‚Äî</div>
    </div>

    <section class="panel">
      <div class="muted" style="font-size:13px">
        No sign-in. Works on localhost. Updates Firebase Realtime Database keys:
        announcements/global, displaySettings, polls/global, pollVotes/{id}
      </div>
    </section>

    <div class="grid">
      <!-- Announcement / Banner -->
      <section class="panel">
        <h3 style="margin:0 0 8px">Announcement Banner</h3>
        <div class="row">
          <select id="annType">
            <option value="info">Info</option>
            <option value="warning">Warning</option>
            <option value="success">Success</option>
            <option value="danger">Danger</option>
          </select>
          <label><input type="checkbox" id="annActive"> Active</label>
        </div>
        <textarea id="annMsg" placeholder="Banner message..."></textarea>
        <div class="row">
          <input id="annBtnText" placeholder="Button text (optional)">
          <input id="annBtnUrl" placeholder="https://example.com (optional)">
        </div>
        <div class="row">
          <button id="annSave">Publish / Update</button>
          <button id="annClear">Clear</button>
          <div id="annStatus" class="status"></div>
        </div>
        <div class="preview">
          <div class="ann">
            <div id="annPrevText">Preview: your banner text will appear here.</div>
            <a id="annPrevBtn" class="btnlink" href="#" target="_blank" rel="noopener" style="display:none">Learn more</a>
          </div>
        </div>
        <div class="muted" style="font-size:12px">Path: announcements/global</div>
      </section>

      <!-- Poll -->
      <section class="panel">
        <h3 style="margin:0 0 8px">Site Poll</h3>
        <div class="row">
          <label><input type="checkbox" id="pollActive"> Active</label>
          <label><input type="checkbox" id="pollRequired"> Compulsory</label>
        </div>
        <input id="pollQ" placeholder="Poll question...">
        <div id="pollOpts" style="display:grid;gap:8px;margin-top:8px"></div>
        <div class="row" style="margin-top:8px">
          <button id="optAdd">+ Add option</button>
          <button id="pollSave">Publish / Update</button>
          <button id="pollClear">Clear config</button>
          <button id="pollReset">Reset votes</button>
          <div id="pollStatus" class="status"></div>
        </div>
        <div id="pollStats" style="margin-top:10px"></div>
        <div class="muted" style="font-size:12px">Config: polls/global ‚Ä¢ Votes: pollVotes/{poll.id}</div>
      </section>
    </div>

    <!-- Display Controls -->
    <section class="panel">
      <h3 style="margin:0 0 8px">Global Display Settings</h3>
      <div class="row">
        <label><input type="checkbox" id="optNameSearch"> Name Search</label>
        <label><input type="checkbox" id="optShowNames"> Show Name</label>
        <label><input type="checkbox" id="optShowRolls"> Show Roll</label>
      </div>
      <div class="muted" style="font-size:12px">Path: displaySettings (updates in real-time)</div>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, update, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // Firebase Realtime Database (no Auth needed for localhost use)
    const dbConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.appspot.com",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    };
    const app = initializeApp(dbConfig);
    const db = getDatabase(app);

    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    // Connection status
    const conn = $("#conn");
    onValue(ref(db, ".info/connected"), snap=>{
      const ok = !!snap.val();
      conn.textContent = "DB: " + (ok ? "Connected" : "Offline");
      conn.style.color = ok ? "#10b981" : "#ef4444";
    });

    // ========== Announcement ==========
    const annType = $("#annType");
    const annActive = $("#annActive");
    const annMsg = $("#annMsg");
    const annBtnText = $("#annBtnText");
    const annBtnUrl = $("#annBtnUrl");
    const annSave = $("#annSave");
    const annClear = $("#annClear");
    const annStatus = $("#annStatus");
    const annPrevText = $("#annPrevText");
    const annPrevBtn = $("#annPrevBtn");

    const updateAnnPreview = ()=>{
      annPrevText.textContent = annMsg.value.trim() || "Preview: your banner text will appear here.";
      const showBtn = annBtnText.value.trim() && annBtnUrl.value.trim();
      annPrevBtn.style.display = showBtn ? "inline-flex" : "none";
      if (showBtn){ annPrevBtn.textContent = annBtnText.value.trim(); annPrevBtn.href = annBtnUrl.value.trim(); }
    };
    [annType,annMsg,annBtnText,annBtnUrl].forEach(el=>el.addEventListener('input', updateAnnPreview));

    onValue(ref(db, 'announcements/global'), snap=>{
      const v = snap.val() || {};
      annType.value = v.type || 'info';
      annActive.checked = !!v.active;
      annMsg.value = v.message || '';
      annBtnText.value = v.buttonText || '';
      annBtnUrl.value = v.buttonUrl || '';
      updateAnnPreview();
    });

    annSave.addEventListener('click', async ()=>{
      const payload = {
        type: annType.value,
        active: annActive.checked,
        message: annMsg.value.trim(),
        buttonText: annBtnText.value.trim(),
        buttonUrl: annBtnUrl.value.trim(),
        updatedAt: Date.now(),
        by: 'local-admin'
      };
      try{
        await set(ref(db, 'announcements/global'), payload);
        annStatus.textContent = "Saved. Live now."; annStatus.className = "status ok";
        setTimeout(()=>annStatus.textContent='', 1200);
      }catch(e){
        annStatus.textContent = "Save failed: " + (e.message || e.code); annStatus.className = "status err";
      }
    });

    annClear.addEventListener('click', async ()=>{
      try{
        await set(ref(db, 'announcements/global'), { active:false, message:'', updatedAt: Date.now() });
        annStatus.textContent = "Cleared."; annStatus.className = "status";
        setTimeout(()=>annStatus.textContent='', 1200);
      }catch(e){
        annStatus.textContent = "Clear failed: " + (e.message || e.code); annStatus.className = "status err";
      }
    });

    // ========== Display Settings ==========
    const optNameSearch = $("#optNameSearch");
    const optShowNames = $("#optShowNames");
    const optShowRolls = $("#optShowRolls");
    const dRef = ref(db, 'displaySettings');

    onValue(dRef, snap=>{
      const v = snap.val() || {};
      optNameSearch.checked = (v.nameSearch !== false);
      optShowNames.checked = (v.showNames !== false);
      optShowRolls.checked = (v.showRolls !== false);
    });

    optNameSearch.addEventListener('change', e => update(dRef, { nameSearch: e.target.checked, updatedAt: Date.now() }));
    optShowNames.addEventListener('change', e => update(dRef, { showNames: e.target.checked, updatedAt: Date.now() }));
    optShowRolls.addEventListener('change', e => update(dRef, { showRolls: e.target.checked, updatedAt: Date.now() }));

    // ========== Poll ==========
    const pollActive = $("#pollActive");
    const pollRequired = $("#pollRequired");
    const pollQ = $("#pollQ");
    const pollOpts = $("#pollOpts");
    const optAdd = $("#optAdd");
    const pollSave = $("#pollSave");
    const pollClear = $("#pollClear");
    const pollReset = $("#pollReset");
    const pollStatus = $("#pollStatus");
    const pollStats = $("#pollStats");

    let pollConfig = {};
    let unsubVotes = null;

    const addOptionRow = (val='')=>{
      const row = document.createElement('div');
      row.className = "row";
      row.innerHTML = `
        <input class="pollOpt" placeholder="Option..." value="${String(val).replace(/"/g,'&quot;')}" style="flex:1">
        <button class="optRm">Remove</button>
      `;
      row.querySelector('.optRm').addEventListener('click', ()=> row.remove());
      pollOpts.appendChild(row);
    };
    optAdd.addEventListener('click', ()=> addOptionRow());

    const renderStats = (options=[], counts=[])=>{
      const total = counts.reduce((a,b)=>a+b,0);
      const rows = options.map((o,i)=>{
        const c = counts[i] || 0; const pct = total ? Math.round(c*100/total) : 0;
        return `<tr><td>${i+1}</td><td>${o}</td><td><b>${c}</b></td><td>${pct}%</td></tr>`;
      }).join('');
      pollStats.innerHTML = `
        <table>
          <thead><tr><th>#</th><th>Option</th><th>Votes</th><th>%</th></tr></thead>
          <tbody>${rows || `<tr><td colspan="4" class="muted">No options.</td></tr>`}</tbody>
          <tfoot><tr><td colspan="2" style="text-align:right;font-weight:700">Total</td><td><b>${total}</b></td><td>${total? '100%':'‚Äî'}</td></tr></tfoot>
        </table>
      `;
    };

    const wireVotes = ()=>{
      if (typeof unsubVotes === 'function'){ try{unsubVotes();}catch{} }
      const pid = pollConfig.id || 'global';
      unsubVotes = onValue(ref(db, 'pollVotes/' + pid), (vs)=>{
        const votes = vs.val() || {};
        const options = Array.isArray(pollConfig.options) ? pollConfig.options : [];
        const counts = options.map(()=>0);
        Object.values(votes).forEach(rec=>{
          const i = Number(rec?.opt);
          if (!isNaN(i) && counts[i] !== undefined) counts[i] += 1;
        });
        renderStats(options, counts);
      });
    };

    onValue(ref(db, 'polls/global'), (snap)=>{
      const v = snap.val() || {};
      pollConfig = v;
      pollActive.checked = !!v.active;
      pollRequired.checked = !!v.required;
      pollQ.value = v.question || '';
      pollOpts.innerHTML = '';
      (Array.isArray(v.options)? v.options: []).forEach(addOptionRow);
      wireVotes();
    });

    pollSave.addEventListener('click', async ()=>{
      const active = pollActive.checked;
      const required = pollRequired.checked;
      const question = pollQ.value.trim();
      const options = $$('.pollOpt').map(i => i.value.trim()).filter(Boolean);
      if (!question || options.length < 2){
        pollStatus.textContent = "Enter a question and at least 2 options."; pollStatus.className = "status err";
        return;
      }
      const cur = (await get(ref(db, 'polls/global'))).val() || {};
      const cfg = { id: cur.id || ('poll_' + Date.now()), active, required, question, options, updatedAt: Date.now() };
      try{
        await set(ref(db, 'polls/global'), cfg);
        pollStatus.textContent = "Saved. Poll is live."; pollStatus.className = "status ok";
        setTimeout(()=>pollStatus.textContent='', 1200);
      }catch(e){
        pollStatus.textContent = "Save failed: " + (e.message || e.code); pollStatus.className = "status err";
      }
    });

    pollClear.addEventListener('click', async ()=>{
      try{
        await set(ref(db, 'polls/global'), { active:false, required:false, question:'', options:[], updatedAt: Date.now() });
        pollStatus.textContent = "Cleared."; pollStatus.className = "status";
        setTimeout(()=>pollStatus.textContent='', 1000);
      }catch(e){
        pollStatus.textContent = "Clear failed: " + (e.message || e.code); pollStatus.className = "status err";
      }
    });

    pollReset.addEventListener('click', async ()=>{
      try{
        const cur = (await get(ref(db, 'polls/global'))).val() || {};
        if (!cur.id){ pollStatus.textContent = "No active poll to reset."; pollStatus.className = "status err"; return; }
        if (!confirm("Reset all poll votes?")) return;
        await remove(ref(db, 'pollVotes/' + cur.id));
        pollStatus.textContent = "Votes reset."; pollStatus.className = "status ok";
        setTimeout(()=>pollStatus.textContent='', 1000);
      }catch(e){
        pollStatus.textContent = "Reset failed: " + (e.message || e.code); pollStatus.className = "status err";
      }
    });
  </script>
</body>
</html>
}

block.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anti-Admin Lock ‚Äî BoardRankCTG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container" style="max-width:600px; padding:20px;">
    <div class="popup-content">
      <h2>Anti-Admin Lock</h2>
      <p>Use this to lock or unlock global features on the live site (without touching reviews or other data).</p>

      <label style="display:flex;align-items:center;gap:8px;margin-top:10px;">
        <input type="checkbox" id="lockBanner" />
        Lock Banner (announcements)
      </label>

      <label style="display:flex;align-items:center;gap:8px;margin-top:10px;">
        <input type="checkbox" id="lockPoll" />
        Lock Polls (disable poll popups)
      </label>

      <label style="display:flex;align-items:center;gap:8px;margin-top:10px;">
        <input type="checkbox" id="lockDisplay" />
        Lock Display Settings (force name/roll visible & name search on)
      </label>

      <div style="margin-top:16px; display:flex; gap:10px;">
        <button id="saveLockBtn" class="btn-primary">Save Lock</button>
        <button id="unlockAllBtn" class="btn-secondary">Unlock All</button>
      </div>

      <p id="lockStatus" style="margin-top:12px; font-weight:800; color:#16a34a;"></p>

      <p style="margin-top:18px; font-size:.9rem; color:#64748b;">
        This writes to <code>/adminLock</code> in <strong>boardrankctg</strong> Realtime Database.
        The live site reads these flags and disables the corresponding features.
      </p>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // boardrankctg config (same as app.js)
    const firebaseConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    };

    const app = initializeApp(firebaseConfig, "anti-admin");
    const db = getDatabase(app);

    const lockBanner = document.getElementById('lockBanner');
    const lockPoll = document.getElementById('lockPoll');
    const lockDisplay = document.getElementById('lockDisplay');
    const statusEl = document.getElementById('lockStatus');

    // Load current lock state
    onValue(ref(db, 'adminLock'), (snap) => {
      const v = snap.val() || {};
      lockBanner.checked = !!v.banner;
      lockPoll.checked = !!v.poll;
      lockDisplay.checked = !!v.displaySettings;
    });

    document.getElementById('saveLockBtn').addEventListener('click', async () => {
      const payload = {
        banner: lockBanner.checked,
        poll: lockPoll.checked,
        displaySettings: lockDisplay.checked,
        updatedAt: Date.now()
      };
      try {
        await set(ref(db, 'adminLock'), payload);
        statusEl.style.color = '#16a34a';
        statusEl.textContent = 'Lock settings saved.';
        setTimeout(() => statusEl.textContent = '', 2000);
      } catch (e) {
        statusEl.style.color = '#b91c1c';
        statusEl.textContent = 'Save failed: ' + (e.message || e.code);
      }
    });

    document.getElementById('unlockAllBtn').addEventListener('click', async () => {
      try {
        await set(ref(db, 'adminLock'), { banner:false, poll:false, displaySettings:false, updatedAt: Date.now() });
        statusEl.style.color = '#16a34a';
        statusEl.textContent = 'All locks cleared.';
        setTimeout(() => statusEl.textContent = '', 2000);
      } catch (e) {
        statusEl.style.color = '#b91c1c';
        statusEl.textContent = 'Unlock failed: ' + (e.message || e.code);
      }
    });
  </script>
</body>
</html>
}

contactus.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Removal Request ‚Äî BoardRankCTG</title>
  <meta name="description" content="Request removal of your data from BoardRankCTG rankings. Submit your details for admin approval." />
  <meta name="keywords" content="BoardRankCTG removal, data removal request, SSC HSC removal, privacy request">
  <meta name="author" content="Hasnyne" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="canonical" href="https://boradrankctg.github.io/rank/removal-request.html" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="Data Removal Request ‚Äî BoardRankCTG" />
  <meta property="og:description" content="Request removal of your data from BoardRankCTG rankings." />
  <meta property="og:url" content="https://boradrankctg.github.io/rank/removal-request.html" />
  <meta property="og:type" content="website" />
  
  <!-- Fonts + Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
  
  <!-- Fav -->
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />
</head>
<body>

  <nav class="app-nav" role="navigation">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>

      <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
        <li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
        <li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
        <li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>

        <li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
        <li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>

        <li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
        <li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
        <li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>

        <li class="divider"></li>
        <li>
          <label class="theme-switch" title="Toggle theme">
            <input type="checkbox" id="themeToggle" />
            <span class="slider" aria-hidden="true"></span>
            <span class="label">Dark mode</span>
          </label>
        </li>
      </ul>
    </div>
    <div class="nav-overlay" id="navOverlay"></div>
  </nav>


  <!-- Announcements (from Firebase) -->
  <div id="annBanner" class="ann-banner type-info" style="display:none;">
    <div class="ann-inner">
      <div class="ann-text" id="annText"></div>
      <a id="annBtn" class="ann-btn" href="#" target="_blank" rel="noopener" style="display:none;">Learn more</a>
    </div>
  </div>

  <main class="container" style="padding-top: 16px;">
    
    <!-- User Request Form -->
    <section id="userSection" style="max-width: 700px; margin: 20px auto;">
      <h1 style="color:#111; margin:8px 0;">Data Removal Request</h1>
      <p class="info-banner">
        <i class="fas fa-shield-alt"></i> Request removal of your data from our rankings. Admin approval required.
      </p>

      <div class="popup-content" style="margin-top: 20px;">
        <h2>Submit Removal Request</h2>
        
        <div id="requestForm">
          <label>Exam Type</label>
          <select id="examType" required>
            <option value="">Select Exam</option>
            <option value="SSC">SSC</option>
            <option value="HSC">HSC</option>
          </select>

          <label>Year</label>
          <select id="examYear" required>
            <option value="">Select Year</option>
            <option value="2025">2025</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
          </select>

          <label>Stream/Group</label>
          <select id="streamGroup" required>
            <option value="">Select Stream</option>
            <option value="Science">Science</option>
            <option value="Commerce">Commerce (Business)</option>
            <option value="Arts">Arts (Humanities)</option>
          </select>

          <label>Your Name</label>
          <input id="studentName" type="text" placeholder="Enter your full name" required />
          <div id="nameError" class="error-message"></div>

          <label>Roll Number</label>
          <input id="rollNumber" type="text" placeholder="Enter your roll number" required />
          <div id="rollError" class="error-message"></div>

          <label>Registration Number</label>
          <input id="regNumber" type="text" placeholder="Enter your registration number" required />
          <div id="regError" class="error-message"></div>

          <label>Reason for Removal (Optional)</label>
          <textarea id="removalReason" rows="3" placeholder="Tell us why you want your data removed..."></textarea>

          <button onclick="submitRemovalRequest()" style="margin-top:12px; width:100%;">
            <i class="fas fa-paper-plane"></i> Submit Request
          </button>
        </div>

        <!-- Status Display (hidden initially) -->
        <div id="statusDisplay" style="display:none; text-align:center; padding:30px;">
          <div class="loading-spinner" id="statusSpinner" style="margin:0 auto 10px;"></div>
          <h3 id="statusTitle">Processing Request...</h3>
          <p id="statusMessage" style="color:#64748b; margin-top:10px;">Please wait while we submit your request.</p>
          <div id="statusActions" style="margin-top:20px; display:none;">
            <button onclick="submitNewRequest()" class="btn-secondary">Submit Another Request</button>
          </div>
        </div>

        <!-- Existing Requests -->
        <div id="userRequests" style="margin-top:30px; display:none;">
          <h3>Your Previous Requests</h3>
          <div id="userRequestsList"></div>
        </div>
      </div>
    </section>

    <!-- Admin Section (hidden for regular users) -->
    <section id="adminSection" style="display:none; max-width: 1200px; margin: 20px auto;">
      <h2 style="color:#111; margin:16px 0;">
        <i class="fas fa-user-shield"></i> Admin Panel ‚Äî Removal Requests
      </h2>
      
      <div class="popup-content">
        <div style="display:flex; gap:10px; margin-bottom:16px; flex-wrap:wrap;">
          <button onclick="filterRequests('all')" class="btn-secondary">All</button>
          <button onclick="filterRequests('pending')" style="background:#f59e0b; color:#fff;">Pending</button>
          <button onclick="filterRequests('approved')" style="background:#22c55e; color:#fff;">Approved</button>
          <button onclick="filterRequests('rejected')" style="background:#ef4444; color:#fff;">Rejected</button>
        </div>

        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th>Date</th>
              <th>Name</th>
              <th>Exam</th>
              <th>Year</th>
              <th>Group</th>
              <th>Roll</th>
              <th>Registration</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="adminRequestsTable">
            <tr><td colspan="10" style="text-align:center; padding:20px;">Loading requests...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </main>

  <footer>
    &copy; 2025 BoardRankCTG ‚Äî Made by Hasnyne
  </footer>

  <!-- Ban overlay -->
  <div id="banOverlay">
    <div class="ban-card">
      <h3>üö´ Access Restricted</h3>
      <p id="banReason">Reason: ‚Äî</p>
      <p id="banUntil">Until: ‚Äî</p>
      <div id="banTimer" style="font-weight:800;margin-top:6px;"></div>
      <p style="margin-top:12px;font-size:.9rem;">If you think this is a mistake, contact the admin.</p>
    </div>
  </div>


  <script type="module" src="scripts/remove.js"></script>

  <script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script>
  <style>
    /* Additional styles specific to removal request page */
    .review-box {
      background-color: #fff;
      border: 2px solid var(--border-strong);
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 10px;
      box-shadow: var(--shadow-soft);
    }

    body.dark-mode .review-box {
      background: #0f172a;
      border-color: #334155;
    }

    #adminRequestsTable button {
      font-size: 0.85rem;
      border-radius: 6px;
      border: none;
    }

    #adminRequestsTable td {
      font-size: 0.95rem;
      padding: 10px 6px;
    }

    /* Status badges */
    .status-pending { color: #f59e0b; }
    .status-approved { color: #22c55e; }
    .status-rejected { color: #ef4444; }
  </style>
</body>
</html>
}

favorite.html {
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Favorites ‚Äî BoardRankCTG</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />
  </head>
  <body>
  <nav class="app-nav" role="navigation">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>

      <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
        <li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
        <li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
        <li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>

        <li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
        <li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>

        <li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
        <li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
        <li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>

        <li class="divider"></li>
        <li>
          <label class="theme-switch" title="Toggle theme">
            <input type="checkbox" id="themeToggle" />
            <span class="slider" aria-hidden="true"></span>
            <span class="label">Dark mode</span>
          </label>
        </li>
      </ul>
    </div>
    <div class="nav-overlay" id="navOverlay"></div>
  </nav>


    <main class="container" style="padding: 20px;">
      <h1 style="color: var(--text);">My Favorite Results</h1>
      <p class="info-banner">All your saved results in one place</p>
      
      <div id="favoritesContainer" style="margin-top: 20px;">
        <div class="loading-spinner" style="margin: 50px auto;"></div>
      </div>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
      import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

      const dbConfig = {
        apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
        authDomain: "boardrankctg.firebaseapp.com",
        databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "boardrankctg",
        storageBucket: "boardrankctg.firebasestorage.app",
        messagingSenderId: "751761229963",
        appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
      };

      const app = initializeApp(dbConfig);
      const db = getDatabase(app);

  // ensure login check runs after other scripts have been loaded
  document.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('userLoggedIn') !== 'true') {
      if (typeof window.requireLogin === 'function') {
        window.requireLogin('Please log in to access your profile.');
        setTimeout(() => { window.location.href = 'login.html'; }, 1000);
      } else {
        alert('Please log in to access your profile.');
        window.location.href = 'login.html';
      }
    }
  });

      const userUID = localStorage.getItem('loggedInUserId');
      
      onValue(ref(db, 'favorites/' + userUID), (snapshot) => {
        const container = document.getElementById('favoritesContainer');
        
        if (!snapshot.exists()) {
          container.innerHTML = '<p style="text-align:center; color:var(--text-muted);">No favorites yet. Start adding from the results page!</p>';
          return;
        }

        container.innerHTML = '';
        const favorites = snapshot.val();
        
        Object.entries(favorites).forEach(([key, fav]) => {
          const card = document.createElement('div');
          card.className = 'popup-content';
          card.style = 'margin-bottom: 20px; position: relative;';
          card.innerHTML = `
            <button onclick="removeFavorite('${key}')" style="position:absolute;top:10px;right:10px;background:#ef4444;color:white;border:none;padding:6px 12px;border-radius:8px;font-weight:700;">
              <i class="fas fa-trash"></i> Remove
            </button>
            <h3 style="color:var(--text);">${fav.name}</h3>
            <p><strong>Roll:</strong> ${fav.roll}</p>
            <p><strong>Institution:</strong> ${fav.institution || 'N/A'}</p>
            <p><strong>GPA:</strong> ${fav.gpa || 'N/A'}</p>
            <p><strong>Exam:</strong> ${fav.exam || 'N/A'} ${fav.year || ''}</p>
            <button onclick="viewResult('${fav.roll}', '${fav.year}', '${fav.group}')" style="margin-top:10px;">
              View Full Result
            </button>
          `;
          container.appendChild(card);
        });
      });

      window.removeFavorite = async function(key) {
        if (confirm('Remove from favorites?')) {
          await remove(ref(db, 'favorites/' + userUID + '/' + key));
        }
      };

      window.viewResult = function(roll, year, group) {
        window.location.href = `index.html?year=${year}&group=${group}&roll=${roll}`;
      };

  document.getElementById('logoutBtn').addEventListener('click', () => {
    if (typeof doLogout === 'function') doLogout();
  });

    </script>
  <script src="scripts/1-core.js" defer></script>
    <script src="scripts/2-data-table.js" defer></script>
    <script src="scripts/3A-popups-core.js" defer></script>
    <script src="scripts/3B-popups-verify-share.js" defer></script>
    <script src="scripts/4-routing-data-ui.js" defer></script></body>
  </html>
}

index.html {
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SSC & HSC Board Rank ‚Äî Chittagong Board (Unofficial)</title>
<meta name="description" content="View unofficial SSC & HSC rankings for Chattogram/Chittagong Board with marks list. Fast, easy, with GPA, total marks, and school comparisons.">
<meta name="keywords" content="SSC 2025, SSC Result 2025, Board Rank, Chittagong Board Rank, Bangladesh SSC Rank, SSC 2025 Rank, HSC 2024 Result, SSC 2024 Result, Board-wise Rank, CTG Board Result, GPA Rank Bangladesh">
<meta name="author" content="Hasnyne" />
<meta name="robots" content="index, follow" />
<meta name="google-site-verification" content="siNtiPjvsyElA07czENYNNvVQicPoBsDL_dU5cwSVQ0" />
<link rel="canonical" href="https://boradrankctg.github.io/rank/" />
<meta property="og:title" content="SSC & HSC Board Rank ‚Äî Chittagong Board (Unofficial)" />
<meta property="og:description" content="Unofficial SSC 2025 rankings for Chittagong Board and Bangladesh. Search by roll number, compare schools, view GPA, marks, and ranks easily." />
<meta property="og:url" content="https://boradrankctg.github.io/rank/" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://og-playground.vercel.app/api/og?title=BoardRankCTG&subtitle=SSC%20%26%20HSC%20Rankings%20%E2%80%94%20Chattogram%20Board" />
<meta name="twitter:card" content="summary_large_image" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="styles.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-f7n3GfUINp0dF2kIgwTQ5Q/NFOTdI1N3r2rOeGd8GvK7m9VB6g8lO6D8Dq/7Hc5VQsr6QyQGHTpM4RwFgq3GEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />
<link rel="manifest" href="/rank/manifest.json">
<link rel="apple-touch-icon" href="/rank/icons/icon-192.png">
<meta name="theme-color" content="#2563eb">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/rank/sitemap.xml">
<meta http-equiv="Content-Security-Policy-Report-Only" content="default-src 'self' https://boradrankctg.github.io; script-src 'self' https://www.gstatic.com https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app https://www.gstatic.com https://firebaseinstallations.googleapis.com https://firebasestorage.googleapis.com; worker-src 'self'; frame-ancestors 'self'; upgrade-insecure-requests">
</head>

<body>
<section class="hero hero-pro" aria-label="BoardRank Hero">
<div class="hero-bg">
<span class="blob b1"></span>
<span class="blob b2"></span>
<span class="blob b3"></span>
<span class="grid-lines"></span>
</div>
<div class="hero-inner">
<div class="hero-grid">
<div class="hero-left">
<div class="hero-eyebrow">
<i class="ri-shield-star-line"></i> Chattogram Board ‚Ä¢ Hasnyne
</div>
<h1>SSC & HSC Board Rankings</h1>
<p class="hero-sub">All SSC AND HSC students ranking since 2022</p>
</div>
</div>
</div>
</section>

<nav aria-label="breadcrumb">
<ul class="breadcrumb">
<li><a href="index.html">Home</a></li>
<li><a href="#" id="currentYear">Year</a></li>
<li id="currentGroup" style="display:none;"></li>
</ul>
</nav>

<nav class="app-nav" role="navigation">
<div class="nav-inner">
<a class="brand" href="index.html">üéì BoardRankCTG</a>
<button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
<i class="ri-menu-line"></i>
</button>
<ul class="nav-links" id="navLinks">
<li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
<li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
<li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
<li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>
<li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
<li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
<li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
<li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
<li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
<li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
<li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>
<li>
<label class="theme-switch">
<input type="checkbox" id="themeToggle" />
<span class="slider"></span>
<span class="label">Dark mode</span>
</label>
</li>
</ul>
</div>
<div class="nav-overlay" id="navOverlay"></div>
</nav>

<div id="customBanner" class="info-banner">‚ö†Ô∏è This is not an official rank. It's prepared based on publicly available data.</div>
<div id="annBanner" class="ann-banner type-info" style="display:none;">
<div class="ann-inner">
<div class="ann-text" id="annText"></div>
<a id="annBtn" class="ann-btn" href="#" target="_blank" rel="noopener" style="display:none;">Learn more</a>
</div>
</div>

<main>
<section>
<p id="selectPrompt">PLEASE SELECT EXAM AND YEAR <i class="fas fa-arrow-down down-arrow"></i></p>
<div class="year-dropdown">
<select id="yearDropdown" onchange="loadYear(this.value)">
<option value=""> Year and Exam</option>
<option value="hsc_2025">HSC 2025</option>
<option value="2025">SSC 2025</option>
<option value="2024">SSC 2024</option>
<option value="2023">SSC 2023</option>
<option value="2022">SSC 2022</option>
<option value="hsc_2024">HSC 2024</option>
<option value="hsc_2023">HSC 2023</option>
</select>
</div>
<div id="content"></div>
<div id="noDataMessage" style="display:none;">Oops! No data found.</div>
</section>

<div class="featured-box" data-value="hsc_2025" onclick="handleFeaturedClick('hsc_2025', this)">
<div class="new-ribbon"><span style="left: -14px; position: relative;">RECHECK</span></div>
<div class="featured-text">
<div class="ssc-line">HSC</div>
<div class="year-line">25</div>
</div>
</div>

<div class="featured-box" data-value="2025" onclick="handleFeaturedClick('2025', this)">
<div class="new-ribbon"><span style="left: -14px; position: relative;">RECHECK</span></div>
<div class="featured-text">
<div class="ssc-line">SSC</div>
<div class="year-line">25</div>
</div>
</div>

<div class="featured-box" data-value="2024" onclick="handleFeaturedClick('2024', this)">
<div class="featured-text">
<div class="ssc-line">SSC</div>
<div class="year-line">24</div>
</div>
</div>

<div class="featured-box" data-value="2023" onclick="handleFeaturedClick('2023', this)">
<div class="featured-text">
<div class="new-ribbon">HOT</div>
<div class="ssc-line">SSC</div>
<div class="year-line">23</div>
</div>
</div>

<div class="featured-box" data-value="2022" onclick="handleFeaturedClick('2022', this)">
<div class="featured-text">
<div class="ssc-line">SSC</div>
<div class="year-line">22</div>
</div>
</div>

<div class="featured-box" data-value="hsc_2024" onclick="handleFeaturedClick('hsc_2024', this)">
<div class="featured-text">
<div class="ssc-line">HSC</div>
<div class="year-line">24</div>
</div>
</div>

<div class="featured-box" data-value="hsc_2023" onclick="handleFeaturedClick('hsc_2023', this)">
<div class="featured-text">
<div class="ssc-line">HSC</div>
<div class="year-line">23</div>
</div>
</div>

<section id="seo-blurb">
<div class="seo-container">
<h2>SSC Result Rankings ‚Äî CHITTAGONG Board</h2>
<p>BoardRankCTG provides <strong>SSC Result Rankings</strong> for the <strong>Chattogram Education Board</strong>, covering <strong>Science</strong>, <strong>Business Studies</strong>, and <strong>Humanities</strong> for 2025, 2024, 2023, and earlier years. Our rankings are accurate, fast, and easy to use.</p>
<p>Search instantly by student name, roll number, or school, compare scores, and explore the <em>Top 100 institutions</em>. View GPA, total marks, and rank for each student, with shareable links and downloadable data.</p>
<p>Our platform offers complete year-wise SSC rankings for all streams, including Science, Business Studies, and Humanities. Users can quickly find results using instant search and stream-based filters, making navigation effortless. The dedicated <em>Top 100 Schools</em> view highlights the best-performing institutions in the Chattogram Board area. Every ranking table is fully mobile-friendly and optimized for fast loading, ensuring smooth access on any device. All data can be freely downloaded for offline use, and every record is based on accurate results from verified public sources.</p>
<p>From <strong>SSC 2025</strong> results to historical rankings, BoardRankCTG is the go-to platform for students, educators, and institutions in the Chattogram Board area.</p>
</div>
</section>

<section id="story" class="container" style="margin-top: 10px;">
<div class="info-banner">‚ö†Ô∏è This is not an official rank. Built from publicly available data.</div>
</section>

<section id="proof" class="container" style="margin-top: 16px;">
<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px;">
<div style="background:#fff; border:1px solid var(--border); border-radius:12px; padding:16px; text-align:center;">
<div style="font-size:2rem; font-weight:900; color:var(--primary)">‚ö°</div>
<div style="font-size:1.5rem; font-weight:900;" id="liveVisits">‚Äî</div>
<div style="color:var(--text-muted); font-weight:800;">Total Visits</div>
</section>

<section id="action" class="container" style="margin: 20px auto 0; text-align:center;">
<a class="btn btn-primary" href="#yearDropdown"><i class="ri-trophy-line"></i>Choose Year & Group</a>
</section>
</main>

<div id="popupWindow" style="display:none;">
<button id="closePopup" class="close-btn">&times;</button>
<div class="popup-content" id="popupContent"></div>
</div>

<button onclick="scrollToTop()" id="scrollToTopBtn" title="Go to top">
<img src="asset/arrow-up.png" alt="Scroll to top">
</button>

  <script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script>
  <script type="module" src="scripts/app.js"></script>

<footer>&copy; 2025 BoardRankCTG ‚Äî Made by Hasnyne</footer>

<div id="banOverlay">
<div class="ban-card">
<h3>üö´ Access Restricted</h3>
<p id="banReason">Reason: ‚Äî</p>
<p id="banUntil">Until: ‚Äî</p>
<div id="banTimer" style="font-weight:800;margin-top:6px;"></div>
<p style="margin-top:12px;font-size:.9rem;">If you think this is a mistake, contact the admin.</p>
</div>
</div>
</body>
</html>

}

login.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign In ‚Äî BoardRankCTG</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />

  <style  >
    
  
  .login-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: var(--gradient-primary);
  }
  .login-box {
    background: var(--surface);
    border-radius: 16px;
    box-shadow: var(--shadow-strong);
    width: 100%;
    max-width: 460px;
    padding: 28px;
    border: 1px solid var(--border-strong);
  }
  .login-logo {
    text-align: center;
    margin-bottom: 20px;
  }
  .login-logo h1 {
    color: var(--text);
    font-size: 28px;
    font-weight: 900;
    margin: 8px 0 2px;
  }
  .login-logo p {
    color: var(--text-muted);
    font-weight: 700;
    margin: 0;
  }
  .login-benefits {
    background: #f8fafc;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    margin-bottom: 16px;
  }
  .login-benefits h3 {
    color: var(--primary);
    margin: 0 0 8px 0;
    font-size: 14px;
    font-weight: 900;
  }
  .login-benefits ul {
    margin: 0;
    padding-left: 18px;
    color: var(--text-muted);
  }
  .login-benefits li {
    margin: 6px 0;
    font-weight: 700;
  }
  .login-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
  }
  .login-tab {
    flex: 1;
    padding: 10px;
    background: var(--surface-muted);
    border: 1px solid var(--border);
    border-radius: 10px;
    font-weight: 800;
    cursor: pointer;
    color: var(--text);
  }
  .login-tab.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }
  .login-input {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    border-radius: 10px;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
    background: white;
  }
  .login-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: var(--focus-ring);
  }
  .login-btn {
    width: 100%;
    padding: 12px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 900;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .login-btn:hover { background: var(--primary-600); }
  .message-div {
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    text-align: center;
    font-weight: 800;
    display: none;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .message-div.error {
    background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5;
  }
  .message-div.success {
    background: #dcfce7; color: #166534; border: 1px solid #86efac;
  }
  .divider { text-align: center; margin: 16px 0; color: #6b7280; font-weight: 800; position: relative; }
  .divider:before,.divider:after {
    content: ''; position: absolute; top: 50%; width: 42%; height: 1px; background: var(--border);
  }
  .divider:before { left: 0; }
  .divider:after { right: 0; }
  .google-btn {
    width: 100%; padding: 12px; background: white; color: var(--text);
    border: 1px solid var(--border); border-radius: 10px; font-weight: 900; display: flex;
    align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: all .2s;
  }
  .google-btn:hover { background: #f9fafb; border-color: var(--primary); }
  .forgot-wrap {
    display: flex; justify-content: space-between; align-items: center; margin: 6px 0 14px;
  }
  .forgot-wrap a { font-weight: 800; color: var(--primary); text-decoration: none; }
  .forgot-wrap a:hover { text-decoration: underline; }
  body.dark-mode .login-box { background: var(--surface); border: 1px solid var(--border-strong); }
  body.dark-mode .login-benefits { background: #0b1220; border-color: #334155; }
  body.dark-mode .login-input, body.dark-mode .google-btn { background: #0b1220; color: var(--text); border-color: var(--border-strong); }
</style>

  </style>
</head>



<body>
    <nav class="app-nav" role="navigation">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>

      <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
        <li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
        <li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
        <li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>

        <li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
        <li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>

        <li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
        <li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
        <li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>

        <li class="divider"></li>
        <li>
          <label class="theme-switch" title="Toggle theme">
            <input type="checkbox" id="themeToggle" />
            <span class="slider" aria-hidden="true"></span>
            <span class="label">Dark mode</span>
          </label>
        </li>
      </ul>
    </div>
    <div class="nav-overlay" id="navOverlay"></div>
  </nav>

  <div class="login-container">
    <div class="login-box">
      <div class="login-logo">
        <div style="font-size: 48px;">üéì</div>
        <h1>BoardRankCTG</h1>
        <p style="color: #6b7280; font-weight: 700;">Welcome back</p>
      </div>

      <div class="login-benefits">
        <h3>‚ú® Why Sign In?</h3>
        <ul>
          <li>No more verification popups - ever!</li>
          <li>Save favorite results</li>
          <li>Submit and reply to reviews</li>
          <li>Personal profile page</li>
          <li>Access from any device</li>
          <li>Compare Students</li>
<li>Top Schools view</li>
<li>Advanced mobile filters</li>
<li>Create custom lists (save any people you want)</li>

        </ul>
      </div>

      <div class="login-tabs">
        <button class="login-tab active" id="signInTabBtn">Sign In</button>
        <button class="login-tab" id="signUpTabBtn">Sign Up</button>
      </div>

      <!-- Message divs -->
      <div id="signInMessage" class="message-div"></div>
      <div id="signUpMessage" class="message-div"></div>

      <!-- Sign In Form -->
      <div id="signInForm">
        
        <input type="email" id="email" class="login-input" placeholder="Email address" />
        <input type="password" id="password" class="login-input" placeholder="Password" type="password" />
        <div class="forgot-wrap">
  <span></span>
  <a href="reset.html">Forgot password?</a>
</div>
        <button class="login-btn" id="submitSignIn">Sign In</button>
      </div>

      <!-- Sign Up Form -->
      <div id="signUpForm" style="display: none;">
        <input type="text" id="fName" class="login-input" placeholder="First name" />
        <input type="text" id="lName" class="login-input" placeholder="Last name (optional)" />
        <input type="email" id="rEmail" class="login-input" placeholder="Email address" />
        <input type="password" id="rPassword" class="login-input" placeholder="Password (min 6 characters)" type="password" />
        <button class="login-btn" id="submitSignUp">Create Account</button>
      </div>

      <div class="divider">or</div>

      <button class="google-btn" id="googleSignIn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" alt="Google" />
        Continue with Google
      </button>

      <p style="text-align: center; margin-top: 20px; font-weight: 700;">
        <a href="index.html" style="color: var(--primary);">‚Üê Back to Home</a> | 
        <a href="index.html" style="color: #6b7280;">Skip for now</a>
      </p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

    // Your NEW auth Firebase config
    const authConfig = {
      apiKey: "AIzaSyAIsOwpONfGwTDFEbfdno8O3sm2G8GObiU",
      authDomain: "loginforme-f4886.firebaseapp.com",
      projectId: "loginforme-f4886",
      storageBucket: "loginforme-f4886.firebasestorage.app",
      messagingSenderId: "634439962888",
      appId: "1:634439962888:web:72b9c573e76c8719f9dcbd",
      measurementId: "G-VJVC929MK3"
    };

    // Your existing database config
    const dbConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    };

    // Initialize both apps
    const authApp = initializeApp(authConfig);
    const dbApp = initializeApp(dbConfig, "dbApp");
    
    const auth = getAuth(authApp);
    const db = getDatabase(dbApp);
    const googleProvider = new GoogleAuthProvider();

    // Show message function
    function showMessage(message, divId) {
      var messageDiv = document.getElementById(divId);
      messageDiv.style.display = "block";
      messageDiv.innerHTML = message;
      messageDiv.style.opacity = 1;
      
      if (message.includes('Successfully') || message.includes('successful')) {
        messageDiv.className = 'message-div success';
      } else {
        messageDiv.className = 'message-div error';
      }
      
      setTimeout(function() {
        messageDiv.style.opacity = 0;
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 300);
      }, 5000);
    }

    // Tab switching
    document.getElementById('signInTabBtn').addEventListener('click', () => {
      document.getElementById('signInTabBtn').classList.add('active');
      document.getElementById('signUpTabBtn').classList.remove('active');
      document.getElementById('signInForm').style.display = 'block';
      document.getElementById('signUpForm').style.display = 'none';
    });

    document.getElementById('signUpTabBtn').addEventListener('click', () => {
      document.getElementById('signUpTabBtn').classList.add('active');
      document.getElementById('signInTabBtn').classList.remove('active');
      document.getElementById('signUpForm').style.display = 'block';
      document.getElementById('signInForm').style.display = 'none';
    });

    // Sign Up
    const signUp = document.getElementById('submitSignUp');
    signUp.addEventListener('click', (event) => {
      event.preventDefault();
      
      const email = document.getElementById('rEmail').value;
      const password = document.getElementById('rPassword').value;
      const firstName = document.getElementById('fName').value;
      const lastName = document.getElementById('lName').value || '';

      if (!email || !password || !firstName) {
        showMessage('Please fill required fields', 'signUpMessage');
        return;
      }

      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          const userData = {
            email: email,
            firstName: firstName,
            lastName: lastName,
            fullName: firstName + (lastName ? ' ' + lastName : ''),
            uid: user.uid,
            createdAt: Date.now()
          };
          
          showMessage('Account Created Successfully!', 'signUpMessage');
          
          // Save to database
          set(ref(db, 'users/' + user.uid), userData)
            .then(() => {
              localStorage.setItem('loggedInUserId', user.uid);
              localStorage.setItem('userLoggedIn', 'true');
              localStorage.setItem('userName', userData.fullName);
              localStorage.setItem('userEmail', email);
              
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 1500);
            })
            .catch((error) => {
              console.error("Error writing user data:", error);
            });
        })
.catch((error) => {
  const code = error.code || '';
  if (code === 'auth/user-not-found') {
    showMessage('Email not found. Please check and try again.', 'signInMessage');
  } else if (code === 'auth/wrong-password' || code === 'auth/invalid-credential') {
    showMessage('Incorrect password. Please try again.', 'signInMessage');
  } else if (code === 'auth/too-many-requests') {
    showMessage('Too many attempts. Please try later.', 'signInMessage');
  } else {
    showMessage('Login failed. Please try again.', 'signInMessage');
  }
});

    });

    // Sign In
    const signIn = document.getElementById('submitSignIn');
    signIn.addEventListener('click', (event) => {
      event.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      if (!email || !password) {
        showMessage('Please enter email and password', 'signInMessage');
        return;
      }

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          showMessage('Login successful!', 'signInMessage');
          const user = userCredential.user;
          
          localStorage.setItem('loggedInUserId', user.uid);
          localStorage.setItem('userLoggedIn', 'true');
          localStorage.setItem('userEmail', email);
          
          // Get user data from database
          set(ref(db, 'users/' + user.uid + '/lastLogin'), Date.now());
          
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1000);
        })
        .catch((error) => {
          const errorCode = error.code;
          if (errorCode === 'auth/invalid-credential') {
            showMessage('Incorrect Email or Password', 'signInMessage');
          } else if (errorCode === 'auth/user-not-found') {
            showMessage('Account does not exist', 'signInMessage');
          } else {
            showMessage('Login failed. Please try again', 'signInMessage');
          }
        });
    });

    // Google Sign In
    document.getElementById('googleSignIn').addEventListener('click', (event) => {
      event.preventDefault();
      
      signInWithPopup(auth, googleProvider)
        .then((result) => {
          const user = result.user;
          
          // Save user data
          const userData = {
            email: user.email,
            fullName: user.displayName,
            photoURL: user.photoURL,
            uid: user.uid,
            provider: 'google',
            createdAt: Date.now()
          };
          
          set(ref(db, 'users/' + user.uid), userData).then(() => {
            localStorage.setItem('loggedInUserId', user.uid);
            localStorage.setItem('userLoggedIn', 'true');
            localStorage.setItem('userName', user.displayName);
            localStorage.setItem('userEmail', user.email);
            localStorage.setItem('userPhoto', user.photoURL || '');
            
            showMessage('Welcome!', 'signInMessage');
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 1000);
          });
        })
        .catch((error) => {
          showMessage('Google sign-in failed', 'signInMessage');
          console.error(error);
        });
    });
  </script>
   <script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script></body>
</body>
</html>
}

profile.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profile ‚Äî BoardRankCTG</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />
  
  <style>
    .profile-container {
      padding: 20px;
      max-width: 100%;
    }
    .profile-card {
      max-width: 800px;
      margin: 40px auto;
      background: var(--surface);
      border-radius: 20px;
      padding: 40px;
      box-shadow: var(--shadow-strong);
      border: 2px solid var(--border);
    }
    .profile-header {
      text-align: center;
      padding-bottom: 30px;
      border-bottom: 2px solid var(--border);
      margin-bottom: 30px;
    }
    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid var(--primary);
      margin-bottom: 20px;
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.2);
    }
    .profile-name {
      font-size: 28px;
      font-weight: 900;
      color: var(--text);
      margin: 10px 0;
    }
    .profile-email {
      color: var(--text-muted);
      font-size: 16px;
      font-weight: 600;
    }
    .profile-form {
      margin-top: 30px;
    }
    .profile-form h3 {
      color: var(--text);
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 20px;
    }
    .profile-form label {
      display: block;
      margin: 20px 0 8px;
      font-weight: 700;
      color: var(--text);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .profile-form input, 
    .profile-form select, 
    .profile-form textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      background: var(--surface);
      color: var(--text);
      transition: all 0.3s;
      box-sizing: border-box;
    }
    .profile-form input:focus, 
    .profile-form select:focus, 
    .profile-form textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: var(--focus-ring);
    }
    .profile-form textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }
    .save-btn {
      width: 100%;
      padding: 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      margin-top: 24px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .save-btn:hover {
      background: var(--primary-600);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
    }
    .profile-stats {
      background: var(--surface-muted);
      border-radius: 15px;
      padding: 25px;
      margin-top: 30px;
      border: 1px solid var(--border);
    }
    .profile-stats h3 {
      color: var(--text);
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 20px;
    }
    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    .stat-item:last-child {
      border-bottom: none;
    }
    .stat-label {
      color: var(--text-muted);
      font-weight: 600;
    }
    .stat-value {
      color: var(--text);
      font-weight: 800;
    }
    .success-message {
      padding: 12px 16px;
      background: #dcfce7;
      color: #166534;
      border: 2px solid #86efac;
      border-radius: 10px;
      margin-top: 20px;
      font-weight: 700;
      display: none;
      animation: slideIn 0.3s;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Dark mode adjustments */
    body.dark-mode .profile-card {
      background: var(--surface);
      border-color: var(--border-strong);
    }
    body.dark-mode .profile-avatar {
      border-color: var(--primary);
    }
    body.dark-mode .profile-form input,
    body.dark-mode .profile-form select,
    body.dark-mode .profile-form textarea {
      background: #1e293b;
      color: var(--text);
      border-color: var(--border-strong);
    }
    body.dark-mode .profile-stats {
      background: #1e293b;
      border-color: var(--border-strong);
    }
    body.dark-mode .success-message {
      background: #052e16;
      color: #86efac;
      border-color: #166534;
    }
    
    @media (max-width: 768px) {
      .profile-card {
        padding: 24px;
        margin: 20px auto;
      }
      .profile-avatar {
        width: 100px;
        height: 100px;
      }
      .profile-name {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
    <nav class="app-nav" role="navigation">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>

      <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
        <li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
        <li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
        <li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>

        <li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
        <li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>

        <li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
        <li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
        <li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>

        <li class="divider"></li>
        <li>
          <label class="theme-switch" title="Toggle theme">
            <input type="checkbox" id="themeToggle" />
            <span class="slider" aria-hidden="true"></span>
            <span class="label">Dark mode</span>
          </label>
        </li>
      </ul>
    </div>
    <div class="nav-overlay" id="navOverlay"></div>
  </nav>


  <main class="profile-container">
    <div class="profile-card">
      <div class="profile-header">
        <img id="profileAvatar" class="profile-avatar" src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff&size=200" alt="Profile Avatar" />
        <h1 id="profileName" class="profile-name">Loading...</h1>
        <p id="profileEmail" class="profile-email">Loading...</p>
      </div>

      <div class="profile-form">
        <h3><i class="fas fa-edit"></i> Edit Profile</h3>
        
        <label for="editName">Display Name</label>
        <input type="text" id="editName" placeholder="Your full name" />
        
        <label for="editInstitution">Institution</label>
        <input type="text" id="editInstitution" placeholder="Your school or college name" />
        
        <label for="editType">Student Type</label>
        <select id="editType">
          <option value="">Select your role...</option>
          <option value="SSC">SSC Student</option>
          <option value="HSC">HSC Student</option>
          <option value="Teacher">Teacher</option>
          <option value="Parent">Parent</option>
          <option value="Alumni">Alumni</option>
          <option value="Other">Other</option>
        </select>

        <label for="editPhone">Phone Number</label>
        <input type="tel" id="editPhone" placeholder="Your contact number (optional)" />
        
        <label for="editAbout">About Me</label>
        <textarea id="editAbout" placeholder="Tell us about yourself, your goals, achievements..."></textarea>
        
        <button class="save-btn" onclick="saveProfile()">
          <i class="fas fa-save"></i> Save Changes
        </button>
        <div id="nameChangeMsg" class="success-message" style="display:none;"></div>
        <div id="successMessage" class="success-message">
          
          <i class="fas fa-check-circle"></i> Profile updated successfully!
        </div>
      </div>

      <div class="profile-stats">
        <h3><i class="fas fa-info-circle"></i> Account Information</h3>
        <div class="stat-item">
          <span class="stat-label">Member Since</span>
          <span id="memberSince" class="stat-value">-</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Last Updated</span>
          <span id="lastUpdated" class="stat-value">-</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Account Type</span>
          <span id="accountType" class="stat-value">Free Account</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">User ID</span>
          <span id="userId" class="stat-value" style="font-size: 12px;">-</span>
        </div>

      </div>

      <div class="popup-content" id="activityPages" style="margin-top:20px;">
  <h3>Recently Viewed Pages</h3>
  <div id="recentPagesList"></div>
</div>

<div class="popup-content" id="activityCompares" style="margin-top:20px;">
  <h3>Recently Compared Students</h3>
  <div id="recentComparesList"></div>
</div>

<div class="popup-content" id="favSchools" style="margin-top:20px;">
  <h3>Favorite Schools</h3>
  <div id="favSchoolsList"></div>
</div>

<div class="popup-content" id="viewsHistory" style="margin-top:20px;">
  <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
    <h3>Viewed Students ‚Äî Full History</h3>
    <button class="btn-secondary" id="clearAllHistoryBtn"><i class="fas fa-trash"></i> Clear All History</button>
  </div>
  <div id="viewsHistoryList"></div>
</div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getDatabase, ref, get, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

    // Database config (where user data is stored)
    const dbConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    };

    const app = initializeApp(dbConfig);
    const db = getDatabase(app);
        // Activity list limits and caches
    let pagesLimit = 5;
    let comparesLimit = 5;
    let viewsLimit = 5;
    let pagesRowsCache = [];
    let comparesRowsCache = [];
    let viewsRowsCache = [];
    function msLeftHuman(ms) {
  const s = Math.max(0, Math.floor(ms / 1000));
  const d = Math.floor(s / 86400);
  const h = Math.floor((s % 86400) / 3600);
  const m = Math.floor((s % 3600) / 60);
  return (d ? `${d}d ` : '') + (h ? `${h}h ` : '') + `${m}m`;
}

  if (localStorage.getItem('userLoggedIn') !== 'true') {
  if (typeof requireLogin === 'function') {
    requireLogin('Please log in to access your profile.');
    setTimeout(() => { window.location.href = 'login.html'; }, 1000);
  } else {
    alert('Please log in to access your profile.');
    window.location.href = 'login.html';
    
  }
}
    const params = new URLSearchParams(window.location.search);
    const overrideUID = params.get('uid');
    const isAdmin = (localStorage.getItem('userEmail') || '').toLowerCase() === 'hasnyne2007@gmail.com';

    // If admin opened profile.html?uid=OTHER_UID, show that user's profile
    const userUID = overrideUID && isAdmin
      ? overrideUID
      : localStorage.getItem('loggedInUserId');

    const userEmail = localStorage.getItem('userEmail');
    const userPhoto = localStorage.getItem('userPhoto');
    async function loadProfile() {
      try {
        const snapshot = await get(ref(db, 'users/' + userUID));
        const userData = snapshot.exists() ? snapshot.val() : {};
        
        // Display user info
        const displayName = userData.fullName || userData.firstName || localStorage.getItem('userName') || 'User';
        document.getElementById('profileName').textContent = displayName;
        // Prefer email from DB, fall back to locally cached email
        document.getElementById('profileEmail').textContent = userData.email || userEmail || '';
        
        // Set avatar (prefer stored photoURL for that user)
        const avatarUrl = userData.photoURL || userPhoto || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=2563eb&color=fff&size=200`;
        document.getElementById('profileAvatar').src = avatarUrl;

        // Save state for name‚Äëchange limit
        window._profileState = {
          fullName: displayName,
          lastUsernameChangeAt: userData.lastUsernameChangeAt || 0
        };
        
        // Fill form fields
        document.getElementById('editName').value = displayName;
        document.getElementById('editInstitution').value = userData.institution || '';
        document.getElementById('editType').value = userData.type || '';
        document.getElementById('editPhone').value = userData.phone || '';
        document.getElementById('editAbout').value = userData.about || '';
        
        // Account information
        document.getElementById('memberSince').textContent = userData.createdAt 
          ? new Date(userData.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
          : 'Today';
        
        document.getElementById('lastUpdated').textContent = userData.updatedAt 
          ? new Date(userData.updatedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
          : 'Never';
        
        document.getElementById('userId').textContent = userUID.substring(0, 8) + '...';
        
      } catch (error) {
        console.error('Error loading profile:', error);
      }
    }
    
    // Load profile on page load
    loadProfile();
    loadActivityBlocks();
window.saveProfile = async function() {
  const displayName = document.getElementById('editName').value.trim();
  const updates = {
    institution: document.getElementById('editInstitution').value.trim(),
    type: document.getElementById('editType').value,
    phone: document.getElementById('editPhone').value.trim(),
    about: document.getElementById('editAbout').value.trim(),
    updatedAt: Date.now()
  };

  const state = window._profileState || { fullName: '', lastUsernameChangeAt: 0 };
  const changingName = displayName && displayName !== state.fullName;
  const now = Date.now();
  const minGap = 14 * 24 * 60 * 60 * 1000; // 14 days
  const msg = document.getElementById('nameChangeMsg');

  if (changingName) {
    const last = state.lastUsernameChangeAt || 0;
    const diff = now - last;
    if (last && diff < minGap) {
      const left = minGap - diff;
      if (msg) {
        msg.style.display = 'block';
        msg.style.background = '#fee2e2';
        msg.style.color = '#991b1b';
        msg.style.border = '2px solid #fecaca';
        msg.innerHTML = `<i class="fas fa-clock"></i> You can change your name again in ${msLeftHuman(left)}.`;
      } else {
        alert(`You can change your name again in ${msLeftHuman(left)}.`);
      }
      return;
    }
    updates.fullName = displayName;
    updates.lastUsernameChangeAt = now;
  } else {
    updates.fullName = state.fullName || displayName;
  }

  try {
    await update(ref(db, 'users/' + userUID), updates);
    localStorage.setItem('userName', updates.fullName);
    document.getElementById('profileName').textContent = updates.fullName;
    document.getElementById('profileAvatar').src =
      `https://ui-avatars.com/api/?name=${encodeURIComponent(updates.fullName)}&background=2563eb&color=fff&size=200`;

    if (msg) msg.style.display = 'none';

    const successMsg = document.getElementById('successMessage');
    if (successMsg) {
      successMsg.style.display = 'block';
      setTimeout(() => { successMsg.style.display = 'none'; }, 3000);
    }

    // update local state and refresh
    window._profileState.fullName = updates.fullName;
    if (changingName) window._profileState.lastUsernameChangeAt = now;
    loadProfile();
    loadActivityBlocks();
  } catch (error) {
    console.error('Error saving profile:', error);
    alert('Failed to update profile. Please try again.');
  }
};


function loadActivityBlocks() {
  const uid = userUID;

  function renderPages() {
    const box = document.getElementById('recentPagesList');
    if (!box) return;
    box.innerHTML = '';

    if (!pagesRowsCache.length) {
      box.innerHTML = '<div style="color:#64748b">No pages yet.</div>';
      return;
    }

    const rows = pagesRowsCache;
    const show = rows.slice(0, pagesLimit);
    show.forEach(r => {
      const d = document.createElement('div');
      d.className = 'review-box';
      d.style.marginBottom = '8px';
      d.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div>
            <div style="font-weight:900">${r.title || 'Page'}</div>
            <div style="color:#64748b; font-size:.9rem;">${new Date(r.ts).toLocaleString()}</div>
            <a href="${r.url}" target="_blank" rel="noopener" style="font-weight:800;">Open</a>
          </div>
          <button class="btn-secondary" onclick="removePageLog('${r.key}')">Delete</button>
        </div>
      `;
      box.appendChild(d);
    });

    const section = document.getElementById('activityPages');
    if (!section) return;
    let btn = section.querySelector('.show-more-pages');
    if (rows.length > pagesLimit) {
      if (!btn) {
        btn = document.createElement('button');
        btn.textContent = 'Show More';
        btn.className = 'btn-secondary show-more-pages';
        btn.style.marginTop = '8px';
        btn.addEventListener('click', () => {
          pagesLimit += 5;
          renderPages();
        });
        section.appendChild(btn);
      }
      btn.style.display = 'inline-block';
    } else if (btn) {
      btn.style.display = 'none';
    }
  }

  function renderCompares() {
    const box = document.getElementById('recentComparesList');
    if (!box) return;
    box.innerHTML = '';

    if (!comparesRowsCache.length) {
      box.innerHTML = '<div style="color:#64748b">No comparisons yet.</div>';
      return;
    }

    const rows = comparesRowsCache;
    const show = rows.slice(0, comparesLimit);
    show.forEach(r => {
      const d = document.createElement('div');
      d.className = 'review-box';
      d.style.marginBottom = '8px';
      d.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div>
            <div><b>${r.roll1}</b> vs <b>${r.roll2}</b> ‚Äî ${r.year} ${r.group}</div>
            <div style="color:#64748b; font-size:.9rem;">${new Date(r.ts).toLocaleString()}</div>
          </div>
          <button class="btn-secondary" onclick="removeCompareLog('${r.key}')">Delete</button>
        </div>
      `;
      box.appendChild(d);
    });

    const section = document.getElementById('activityCompares');
    if (!section) return;
    let btn = section.querySelector('.show-more-compares');
    if (rows.length > comparesLimit) {
      if (!btn) {
        btn = document.createElement('button');
        btn.textContent = 'Show More';
        btn.className = 'btn-secondary show-more-compares';
        btn.style.marginTop = '8px';
        btn.addEventListener('click', () => {
          comparesLimit += 5;
          renderCompares();
        });
        section.appendChild(btn);
      }
      btn.style.display = 'inline-block';
    } else if (btn) {
      btn.style.display = 'none';
    }
  }

  function renderViews() {
    const box = document.getElementById('viewsHistoryList');
    if (!box) return;
    box.innerHTML = '';

    if (!viewsRowsCache.length) {
      box.innerHTML = '<div style="color:#64748b">No views yet.</div>';
      return;
    }

    const rows = viewsRowsCache;
    const show = rows.slice(0, viewsLimit);
    show.forEach(r => {
      const d = document.createElement('div');
      d.className = 'review-box';
      d.style.marginBottom = '8px';
      d.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
          <div>
            <div><b>${r.name || 'Student'}</b> ‚Äî Roll ${r.roll}</div>
            <div style="color:#64748b; font-size:.9rem;">${r.year} ${r.group} ‚Äî ${r.institution || ''}</div>
            <div style="color:#64748b; font-size:.9rem;">${new Date(r.ts).toLocaleString()}</div>
          </div>
          <div>
            <button class="btn-secondary" onclick="viewStudentFromHistory('${r.roll}','${r.year}','${r.group}')">Open</button>
            <button class="btn-secondary" onclick="removeViewLog('${r.key}')">Delete</button>
          </div>
        </div>
      `;
      box.appendChild(d);
    });

    const section = document.getElementById('viewsHistory');
    if (!section) return;
    let btn = section.querySelector('.show-more-views');
    if (rows.length > viewsLimit) {
      if (!btn) {
        btn = document.createElement('button');
        btn.textContent = 'Show More';
        btn.className = 'btn-secondary show-more-views';
        btn.style.marginTop = '8px';
        btn.addEventListener('click', () => {
          viewsLimit += 5;
          renderViews();
        });
        section.appendChild(btn);
      }
      btn.style.display = 'inline-block';
    } else if (btn) {
      btn.style.display = 'none';
    }
  }

  // Recently Viewed Pages
  onValue(ref(db, `userLogs/${uid}/pages`), (snap) => {
    if (!snap.exists()) {
      pagesRowsCache = [];
    } else {
      pagesRowsCache = Object.entries(snap.val())
        .map(([k, v]) => ({ key:k, ...v }))
        .sort((a,b) => b.ts - a.ts);
    }
    renderPages();
  });

  // Recently Compared Students
  onValue(ref(db, `userLogs/${uid}/comparisons`), (snap) => {
    if (!snap.exists()) {
      comparesRowsCache = [];
    } else {
      comparesRowsCache = Object.entries(snap.val())
        .map(([k, v]) => ({ key:k, ...v }))
        .sort((a,b) => b.ts - a.ts);
    }
    renderCompares();
  });

  // Favorite Schools (unchanged, show all)
  onValue(ref(db, `favoriteSchools/${uid}`), (snap) => {
    const box = document.getElementById('favSchoolsList');
    if (!box) return;
    box.innerHTML = '';
    if (!snap.exists()) {
      box.innerHTML = '<div style="color:#64748b">No favorite schools yet.</div>';
      return;
    }
    Object.entries(snap.val()).forEach(([key, v]) => {
      const d = document.createElement('div');
      d.className = 'review-box';
      d.style.marginBottom = '8px';
      d.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div><b>${(v && v.name) || key}</b></div>
          <button class="btn-secondary" onclick="unfavoriteSchool('${key}')">Unfavorite</button>
        </div>
      `;
      box.appendChild(d);
    });
  });

  // Viewed Students ‚Äî full history (limited by viewsLimit)
  onValue(ref(db, `userLogs/${uid}/views`), (snap) => {
    if (!snap.exists()) {
      viewsRowsCache = [];
    } else {
      viewsRowsCache = Object.entries(snap.val())
        .map(([k, v]) => ({ key:k, ...v }))
        .sort((a,b) => b.ts - a.ts);
    }
    renderViews();
  });

  // Clear all history
  document.getElementById('clearAllHistoryBtn')?.addEventListener('click', async () => {
    if (!confirm('Clear all history (pages, views, comparisons)?')) return;
    try {
      await remove(ref(db, `userLogs/${uid}/pages`));
      await remove(ref(db, `userLogs/${uid}/views`));
      await remove(ref(db, `userLogs/${uid}/comparisons`));
      alert('History cleared.');
    } catch (e) {
      console.error('Clear history error', e);
      alert('Failed to clear history.');
    }
  });
}
window.removePageLog = async function(key) {
  const uid = localStorage.getItem('loggedInUserId');
  await remove(ref(db, `userLogs/${uid}/pages/${key}`));
};

window.removeCompareLog = async function(key) {
  const uid = localStorage.getItem('loggedInUserId');
  await remove(ref(db, `userLogs/${uid}/comparisons/${key}`));
};

window.removeViewLog = async function(key) {
  const uid = localStorage.getItem('loggedInUserId');
  await remove(ref(db, `userLogs/${uid}/views/${key}`));
};

window.unfavoriteSchool = async function(key) {
  const uid = localStorage.getItem('loggedInUserId');
  await remove(ref(db, `favoriteSchools/${uid}/${key}`));
};

window.viewStudentFromHistory = function(roll, year, group) {
  window.location.href = `index.html?year=${encodeURIComponent(year)}&group=${encodeURIComponent(group)}&roll=${encodeURIComponent(roll)}`;
};

  </script>
  
<script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script></body>
</html>
}

reset-password.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Set New Password ‚Äî BoardRankCTG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <nav class="app-nav">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>
    </div>
  </nav>

  <main class="container" style="max-width: 520px;">
    <div class="popup-content">
      <h2>Set a new password</h2>
      <p>Your reset request was verified. Choose a new password.</p>

      <input
        id="newPass"
        type="password"
        placeholder="New password (min 6 characters)"
      />

      <input
        id="confirmPass"
        type="password"
        placeholder="Confirm new password"
      />

      <button id="setBtn" class="btn-primary">Update password</button>

      <p style="margin-top: 10px;">
        <a href="login.html">Back to login</a>
      </p>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getAuth, verifyPasswordResetCode, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";

    const authConfig = {
      apiKey: "AIzaSyAIsOwpONfGwTDFEbfdno8O3sm2G8GObiU",
      authDomain: "loginforme-f4886.firebaseapp.com",
      projectId: "loginforme-f4886",
      appId: "1:634439962888:web:72b9c573e76c8719f9dcbd"
    };

    const app = initializeApp(authConfig);
    const auth = getAuth(app);

    // Read oobCode from URL silently
    const params = new URLSearchParams(location.search);
    const oobCode = params.get("oobCode");

    if (!oobCode) {
      alert("Invalid reset link. Please request a new one.");
      window.location.href = "reset.html";
    }

    document.getElementById("setBtn").addEventListener("click", async () => {
      const newPass = document.getElementById("newPass").value.trim();
      const confirmPass = document.getElementById("confirmPass").value.trim();

      if (!newPass || !confirmPass) {
        alert("Please fill both password fields.");
        return;
      }

      if (newPass.length < 6) {
        alert("Password must be at least 6 characters.");
        return;
      }

      if (newPass !== confirmPass) {
        alert("Passwords do not match.");
        return;
      }

      try {
        // Validate the code first
        await verifyPasswordResetCode(auth, oobCode);

        // Update password
        await confirmPasswordReset(auth, oobCode, newPass);

        alert("Password updated successfully. Please login.");
        window.location.href = "login.html";

      } catch (e) {
        console.error(e);
        alert("Invalid or expired reset link. Please request a new one.");
      }
    });
  </script>
  <script src="scripts/1-core.js" defer></script>
</body>
</html>

}

reset.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Password Reset ‚Äî BoardRankCTG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />
</head>

<body>
  <nav class="app-nav">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>
    </div>
  </nav>

  <main class="container" style="max-width: 520px;">
    <div class="popup-content">
      <h2>Reset your password</h2>
      <p>Enter your account email. We‚Äôll send you a reset link. (check spam folder) </p>

      <input 
        id="resetEmail" 
        type="email" 
        placeholder="Email address" 
        autocomplete="email"
      />

      <button id="sendResetBtn" class="btn-primary">
        Send reset link
      </button>

      <p style="margin-top: 10px;">
        Remember now? <a href="login.html">Back to login</a>
      </p>
    </div>
  </main>

  <!-- Firebase Password Reset Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";

    const authConfig = {
      apiKey: "AIzaSyAIsOwpONfGwTDFEbfdno8O3sm2G8GObiU",
      authDomain: "loginforme-f4886.firebaseapp.com",
      projectId: "loginforme-f4886",
      appId: "1:634439962888:web:72b9c573e76c8719f9dcbd"
    };

    const app = initializeApp(authConfig);
    const auth = getAuth(app);

    document.getElementById('sendResetBtn').addEventListener('click', async () => {
      const email = (document.getElementById('resetEmail').value || '').trim();

      if (!email) {
        alert('Please enter your email');
        return;
      }

      try {
        await sendPasswordResetEmail(auth, email, {
          url: 'https://boradrankctg.github.io/rank/reset-password.html',
          handleCodeInApp: false
        });

        alert('Password reset email sent. Please check your inbox.');
      } catch (e) {
        console.error(e);

        if (e.code === 'auth/user-not-found') {
          alert('No account exists with this email.');
        } else if (e.code === 'auth/invalid-email') {
          alert('Invalid email format.');
        } else {
          alert('Failed to send reset email. Try again later.');
        }
      }
    });
  </script>
    <script src="scripts/1-core.js" defer></script>


</body>
</html>

}

review.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Reviews ‚Äî BoardRankCTG (Unofficial)</title>
  <meta name="description" content="Read and submit reviews for BoardRankCTG. Share your experience about SSC & HSC rankings for Chattogram Board." />
  <meta name="keywords" content="BoardRankCTG reviews, feedback, SSC HSC reviews, Chattogram Board reviews">
  <meta name="author" content="Hasnyne" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://boradrankctg.github.io/rank/review.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="Reviews ‚Äî BoardRankCTG" />
  <meta property="og:description" content="Share your experience with BoardRankCTG. Read and submit reviews." />
  <meta property="og:url" content="https://boradrankctg.github.io/rank/review.html" />
  <meta property="og:type" content="website" />

  <!-- Fonts + Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />

  <!-- Fav -->
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />

  <style>
    /* Minimal helpers so UI looks right even without extra CSS */
    .review-box {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px;
      margin: 12px 0;
      background: #fff;
    }
    .review-comment { margin-top: 8px; white-space: pre-wrap; }
    .badge-admin {
      color: #fff; background: #d00; padding: 2px 6px;
      border-radius: 4px; font-size: 12px; margin-right: 5px;
    }
    .reply-box {
      padding: 8px 10px;
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: 8px;
      margin: 8px 0 0 0;
    }
    .reply-actions{display:inline-flex;gap:8px;align-items:center;margin-left:8px;}
    .reply-like-btn,.reply-del-btn{padding:2px 8px;border-radius:6px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-weight:800;}
    .reply-like-btn:hover{background:#f3f4f6;}
    .reply-del-btn{color:#b91c1c;}
    .reply-del-btn:hover{background:#fee2e2;}
    .error-message { color: #dc2626; font-size: 0.9rem; margin-top: 4px; }
    .btn { display: inline-block; border-radius: 10px; border: 1px solid #e5e7eb; background:#fff; cursor:pointer; }
    .btn-primary { background: #0284c7; color: #fff; border-color:#0284c7; }
    .linklike { background: none; border: none; color: inherit; cursor: pointer; }
    .reviews-toolbar { display:flex; align-items:center; justify-content: space-between; gap:8px; margin: 6px 0 12px; }
    .muted { color:#64748b; }
  </style>
</head>
<body>

  <nav class="app-nav" role="navigation">
    <div class="nav-inner">
      <a class="brand" href="index.html">üéì BoardRankCTG</a>

      <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
      </button>

      <ul class="nav-links" id="navLinks">
        <li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
        <li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
        <li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
        <li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>

        <li class="logged-in-only" style="display:none;"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li class="logged-in-only" style="display:none;"><a href="favorite.html"><i class="fas fa-heart"></i> Favorites</a></li>
        <li class="logged-out-only"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <li class="logged-in-only" style="display:none;"><button class="linklike" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></li>

        <li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
        <li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
        <li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>

        <li class="divider"></li>
        <li>
          <label class="theme-switch" title="Toggle theme">
            <input type="checkbox" id="themeToggle" />
            <span class="slider" aria-hidden="true"></span>
            <span class="label">Dark mode</span>
          </label>
        </li>
      </ul>
    </div>
    <div class="nav-overlay" id="navOverlay"></div>
  </nav>

  <div id="annBanner" class="ann-banner type-info" style="display:none;">
    <div class="ann-inner">
      <div class="ann-text" id="annText"></div>
      <a id="annBtn" class="ann-btn" href="#" target="_blank" rel="noopener" style="display:none;">Learn more</a>
    </div>
  </div>

  <main class="container" style="padding-top: 16px;">
    <h1 style="color:#111; margin:8px 0;">Reviews</h1>
    <p class="info-banner">Tell us what you think. Your feedback helps improve the experience.</p>

    <!-- Submit Review Card - For logged in users -->
    <section id="reviewFormLoggedIn" class="popup-content" style="max-width: 700px; margin: 14px auto; display:none;">
      <h2>Leave a Review</h2>
      
     <div class="reviewing-as-badge"> <strong>Reviewing as:</strong> <span id="reviewingAsName">User</span> </div>

      <div id="starContainer" style="font-size: 1.5rem; color: gold; cursor: pointer; margin-top: 6px;">
        <span onclick="rateSite(1)">‚òÜ</span>
        <span onclick="rateSite(2)">‚òÜ</span>
        <span onclick="rateSite(3)">‚òÜ</span>
        <span onclick="rateSite(4)">‚òÜ</span>
        <span onclick="rateSite(5)">‚òÜ</span>
      </div>
      <div id="starError" class="error-message"></div>

      <textarea id="reviewText" rows="3" placeholder="Write your feedback‚Ä¶" style="margin-top:10px;"></textarea>
      <div id="commentError" class="error-message"></div>

      <button id="submitReviewBtn" type="button" onclick="submitReview(event)" style="margin-top:10px;">Submit Review</button>
    </section>

    <!-- Login prompt - For non-logged in users -->
    <section id="loginPrompt" class="popup-content" style="max-width: 700px; margin: 14px auto; display:none;">
      <div style="text-align: center; padding: 30px;">
        <h2><i class="fas fa-lock"></i> Sign In to Review</h2>
        <p class="muted" style="margin: 20px 0;">
          Join our community to share your feedback and interact with other users.
        </p>
    <div class="benefits-box"> <h3 style="color: #0284c7; margin-bottom: 15px;">Benefits of signing in:</h3> <ul style="text-align: left; list-style: none; padding: 0;"> <li style="margin: 8px 0;"><i class="fas fa-check" style="color: #22c55e; margin-right: 8px;"></i> Submit and manage your reviews</li> <li style="margin: 8px 0;"><i class="fas fa-check" style="color: #22c55e; margin-right: 8px;"></i> Reply to other reviews</li> <li style="margin: 8px 0;"><i class="fas fa-check" style="color: #22c55e; margin-right: 8px;"></i> No verification popups</li> <li style="margin: 8px 0;"><i class="fas fa-check" style="color: #22c55e; margin-right: 8px;"></i> Save favorite results</li> </ul> </div>
        <a href="login.html" class="btn btn-primary" style="padding: 12px 30px; font-size: 16px;">
          <i class="fas fa-sign-in-alt"></i> Sign In Now
        </a>
      </div>
    </section>

    <!-- All Reviews -->
    <section style="max-width: 900px; margin: 20px auto;">
      <div class="reviews-toolbar">
        <div>
          <label for="sortSelect" class="muted" style="margin-right:8px;">Sort by:</label>
          <select id="sortSelect" class="btn" style="padding:6px 10px;">
            <option value="top" selected>Most liked</option>
            <option value="new">Newest</option>
          </select>
        </div>
        <div class="muted" id="reviewsCount" aria-live="polite"></div>
      </div>

      <div id="reviewsContainer"></div>

      <div style="text-align:center; margin-top: 12px;">
        <button id="loadMoreBtn" class="btn" style="padding:8px 16px; display:none; color: #000;">Load more</button>
      </div>
    </section>
  </main>

  <footer>
    &copy; 2025 BoardRankCTG ‚Äî Made by Hasnyne
  </footer>

  <div id="banOverlay">
    <div class="ban-card">
      <h3>üö´ Access Restricted</h3>
      <p id="banReason">Reason: ‚Äî</p>
      <p id="banUntil">Until: ‚Äî</p>
      <div id="banTimer" style="font-weight:800;margin-top:6px;"></div>
      <p style="margin-top:12px;font-size:.9rem;">If you think this is a mistake, contact the admin.</p>
    </div>
  </div>

  <script type="module" src="scripts/review.js"> </script>
   <script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script>
</body>
</html>
}

secret.html {
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secret Admin ‚Äî BoardRankCTG</title>
  <meta name="robots" content="noindex, nofollow" />
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <main class="container" style="padding: 20px;">
    <h1>Secret Admin Dashboard</h1>

    <!-- Admin content now loads automatically -->
    <div id="adminContent">
      <div class="popup-content" style="margin-bottom:20px;">
        <h2>Statistics</h2>
        <p>Total Users: <span id="totalUsers">0</span></p>
        <p>Email Users: <span id="emailUsers">0</span></p>
        <p>Google Users: <span id="googleUsers">0</span></p>
      </div>

      <h2>All Registered Users</h2>
      <table style="width:100%;">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>UID</th>
            <th>Provider</th>
            <th>Institution</th>
            <th>Joined</th>
          </tr>
        </thead>
        <tbody id="usersTable">
          <tr><td colspan="6">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

    const dbConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    };

    const app = initializeApp(dbConfig);
    const db = getDatabase(app);

    // Load users immediately
    loadUsers();

    function loadUsers() {
      onValue(ref(db, 'users'), (snapshot) => {
        const tbody = document.getElementById('usersTable');
        tbody.innerHTML = '';
        
        if (!snapshot.exists()) {
          tbody.innerHTML = '<tr><td colspan="6">No users found</td></tr>';
          return;
        }

        const users = snapshot.val();
        let totalUsers = 0, emailUsers = 0, googleUsers = 0;

        Object.entries(users).forEach(([uid, user]) => {
          totalUsers++;
          if (user.provider === 'google') googleUsers++;
          else emailUsers++;

          const row = document.createElement('tr');
          row.innerHTML = `
            <td><a href="profile.html?uid=${encodeURIComponent(uid)}" target="_blank" rel="noopener">${user.fullName || user.firstName || 'N/A'}</a></td>
            <td>${user.email || 'N/A'}</td>
            <td><small>${uid}</small></td>
            <td>${user.provider || 'Email'}</td>
            <td>${user.institution || 'N/A'}</td>
            <td>${new Date(user.createdAt).toLocaleDateString()}</td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('emailUsers').textContent = emailUsers;
        document.getElementById('googleUsers').textContent = googleUsers;
      });
    }
  </script>
</body>
</html>

}

styles.css {
:root{
    --featured-bg-light:#acf8ff;
     --featured-bg-dark:#0f172a;
    /* Brand */
    --primary:#2563eb;
    /* Trust: Blue = main brand */
    --primary-600:#1d4ed8;
    --primary-700:#1e40af;
    --secondary:#14b8a6;
    /* Support: Teal */
    --accent:#f59e0b;
    /* Highlight: Amber for emphasis (notifications/Rank) */
    /* Surfaces */
    --bg:#f5f7fb;
    --surface:#ffffff;
    --surface-muted:#f1f5f9;
    /* Text */
    --text:#0f172a;
    --text-muted:#64748b;
    --text-inverse:#ffffff;
    /* Status */
    --warning:#f59e0b;
    --warning-600:#d97706;
    --danger:#ef4444;
    --danger-600:#dc2626;
    --info:#0ea5e9;
    /* Accents */
    --gold:#f5c542;
    --silver:#c0c7d1;
    --bronze:#cd7f32;
    /* Borders & shadows */
    --border:#e5e7eb;
    --border-strong:#cbd5e1;
    --shadow-soft:0 2px 8px rgba(0,0,0,0.08);
    --shadow:0 4px 15px rgba(0,0,0,0.12);
    --shadow-strong:0 10px 30px rgba(0,0,0,0.18);
    /* Gradients */
    --gradient-primary:linear-gradient(135deg, #1e3a8a, #2563eb, #0ea5e9);
    --gradient-soft:linear-gradient(145deg, #f0f0f3, #cacccd);
    --card-radial:radial-gradient(40% 60% at 25% 25%, #101318, #1b1f26 45%, #272a33 100%);
    --focus-ring:0 0 0 3px rgba(37, 99, 235, 0.25);
    /* Layout scale */
    --container:1100px;
    --radius:12px;
}
/* ========== BASE / LAYOUT ========== */
 *{
    -webkit-tap-highlight-color:transparent;
    user-select:none;
    box-sizing:border-box;
}
 html,body{
    overflow-x:hidden;
    width:100%;
    align-items:center;
}
 body{
    font-family:Arial,sans-serif;
    background-color:var(--bg);
    color:var(--text);
    margin:0;
    padding:0;
    display:flex;
    flex-direction:column;
    justify-content:center;
}
 main{
    text-align:center;
    padding:2.5rem;
    width:100%;
}
 header,footer{
    background:var(--gradient-primary);
    padding:20px;
    text-align:center;
    color:#fff;
    width:100%;
    border:3px solid var(--border-strong);
    border-radius:4px;
    font-weight:bolder;
    position:relative;
    box-shadow:var(--shadow);
}
/* ========== TYPOGRAPHY ========== */
 h1{
    font-size:3rem;
    margin-bottom:5px;
    padding:10px;
    font-weight:bolder;
    color:#fff;
}
 h2{
    font-size:1.25rem;
    color:#e2e8f0;
    padding:5px;
}
 h3{
    font-size:1.25rem;
    color:#1a1919;
    padding:5px;
}
 p{
    font-size:1.25rem;
    font-weight:bold;
    margin-bottom:1.25rem;
    color:var(--text);
}
/* ========== CONTROLS / FORMS ========== */
 label{
    display:block;
    font-weight:bold;
    margin-bottom:.5rem;
    color:var(--text);
}
 input[type="text"],input[type="email"],select{
    width:90%;
    padding:.625rem;
    border:1px solid var(--primary);
    border-radius:4px;
    box-sizing:border-box;
    margin-bottom:.625rem;
    color:var(--text);
    background-color:#fff;
}
 textarea#message,textarea#InstituationDropdown{
    width:90%;
    padding:.625rem;
    border:1px solid var(--primary);
    border-radius:4px;
    box-sizing:border-box;
    margin-bottom:.625rem;
    color:var(--text);
    background-color:#fff;
}
 .year-dropdown select{
    align-items:center;
    padding:6px;
    font-weight:bolder;
    font-size:20px;
    border:3px solid #cccccc;
    border-radius:4px;
    width:270px;
    margin-bottom:20px;
    color:var(--text);
    background-color:#fff;
}
 .search-container{
    margin:.625rem 0;
    width:100%;
    padding:0 10px;
    display:flex;
    flex-direction:column;
    align-items:center;
}
 input#InstituationDropdown[list]{
    background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%230f172a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='8'/><line x1='21' y1='21' x2='16.65' y2='16.65'/></svg>");
    background-repeat:no-repeat;
    background-position:10px center;
    background-size:16px 16px;
    padding-top:.625rem;
    padding-right:.625rem;
    padding-bottom:.625rem;
    padding-left:40px;
    font-size:1rem;
    width:90%;
    border:1px solid var(--primary);
    border-radius:4px;
    margin-bottom:1rem;
}
/* Datalist search input */
 input#InstituationDropdown[list]{
    background:url('asset/search.png') no-repeat 10px center;
    background-size:16px 16px;
    padding-top:.625rem;
    padding-right:.625rem;
    padding-bottom:.625rem;
    padding-left:40px;
    font-size:1rem;
    width:90%;
    border:1px solid var(--primary);
    border-radius:4px;
    margin-bottom:1rem;
}
/* ========== BUTTONS ========== */
 button{
    padding:.625rem 1.25rem;
    align-items:center;
    font-size:1rem;
    background-color:var(--primary);
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
    transition:background-color .2s ease-in-out,transform .2s,box-shadow .2s;
    position:relative;
    overflow:hidden;
}
 button:hover{
    background-color:var(--primary-600);
    transform:scale(1.05);
    box-shadow:var(--shadow-soft);
}
 button::after{
    content:'';
    position:absolute;
    width:100px;
    height:100px;
    background:rgba(255,255,255,.3);
    display:block;
    border-radius:50%;
    transform:scale(0);
    animation:ripple .6s linear;
    pointer-events:none;
}
 button:active::after{
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0);
    animation:ripple .6s linear;
}
/* Special action buttons */
 button[onclick^="promptComparison"],button[onclick^="showSSCResultFromHSC"]{
    background-color:#fff9c4 !important;
    color:#000 !important;
    border:1px solid #f0e68c !important;
    font-weight:bold;
    padding:8px 14px;
    border-radius:6px;
    cursor:pointer;
    transition:background-color .2s ease;
}
 button[onclick^="promptComparison"]::before{
    content:"‚öñ ";
}
 button[onclick^="showSSCResultFromHSC"]::before{
    content:"üìú ";
}
 button[onclick^="promptComparison"]:hover,button[onclick^="showSSCResultFromHSC"]:hover{
    background-color:#fff59d !important;
}
/* Grouped action buttons */
 .group-buttons{
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    margin-top:1rem;
}
 .group-buttons button{
    display:flex;
    align-items:center;
    background-color:var(--primary-700);
    font-size:1.75rem;
    font-weight:bold;
    text-transform:uppercase;
    padding:10px 20px;
    margin:1rem;
    border:none;
    border-radius:9px;
    color:#fff;
    transition:background-color .2s,transform .2s;
}
 .group-buttons button:hover{
    background-color:var(--primary-600);
    transform:scale(1.05);
}
 .group-buttons button img{
    margin-right:10px;
    width:30px;
    height:30px;
}
/* ========== TABLES & DATATABLES ========== */
 table{
    width:100%;
    margin:1.25rem 0;
    border-collapse:collapse;
    overflow-x:auto;
    display:table;
    font-family:'Poppins','Segoe UI',sans-serif;
    font-weight:bold;
    color:var(--text);
}
 table,th,td{
    border:1px solid #ddd;
}
 th{
    background-color:var(--primary-700);
    color:#fff;
    cursor:pointer;
}
 th,td{
    padding:.625rem;
    text-align:left;
}
 .dataTables_wrapper .dataTables_filter,.dataTables_wrapper .dataTables_paginate{
    float:right;
    text-align:right;
}
 .dataTables_wrapper .dataTables_info{
    float:left;
    text-align:left;
}
 .pagination{
    margin-top:1.25rem;
    text-align:center;
}
/* Zebra + subtle animated color shift (kept) */
 table tbody tr:nth-child(odd){
    background-color:#ffffff;
}
 table tbody tr:nth-child(even){
    background-color:#eaf6ff;
}
 @keyframes colorShift{
    0%{
        background-color:#fffbe6;
    }
    25%{
        background-color:#e0f7fa;
    }
    50%{
        background-color:#ffebee;
    }
    75%{
        background-color:#fef9e7;
    }
    100%{
        background-color:#fffbe6;
    }
}
 table tbody tr{
    animation:colorShift 10s infinite alternate;
}
/* Top Institutions table */
 table.top-institutions{
    margin-top:20px;
    border-collapse:collapse;
    width:100%;
}
 .top-institutions th,.top-institutions td{
    padding:12px;
    text-align:center;
    border:1px solid #ddd;
}
 .top-institutions th{
    background-color:var(--primary-700);
    color:white;
}
 .top-institutions tbody tr:nth-child(1){
    background-color:var(--gold);
    font-weight:bolder;
}
 .top-institutions tbody tr:nth-child(2){
    background-color:var(--silver);
    font-weight:bolder;
}
 .top-institutions tbody tr:nth-child(3){
    background-color:var(--bronze);
    font-weight:bolder;
}
/* ========== POPUPS ========== */
 .popup{
    border:4px solid var(--text);
    border-radius:4px;
    position:fixed;
    top:50%;
    z-index:9999;
    left:50%;
    transform:translate(-50%,-50%) scale(0);
    width:97%;
    max-width:400px;
    background-color:var(--surface);
    color:#fff;
    box-shadow:var(--shadow);
    padding:20px;
    overflow-y:auto;
    max-height:80vh;
    font-family:'Helvetica Neue',Arial,sans-serif;
    animation:popupAnimation .5s forwards;
}
 @keyframes popupAnimation{
    0%{
        transform:translate(-50%,-50%) scale(0);
    }
    100%{
        transform:translate(-50%,-50%) scale(1);
    }
}
 @keyframes popupOutAnimation{
    0%{
        transform:translate(-50%,-50%) scale(1);
    }
    100%{
        transform:translate(-50%,-50%) scale(0);
    }
}
 .popup.pop-out{
    animation:popupOutAnimation .5s forwards;
}
 .popup.pop-out.hidden{
    display:none;
}
/* Popup content structure */
 .popup-content{
    background-color:#ffffff;
    border:3px solid var(--text);
    border-radius:6px;
    padding:20px;
    margin-top:20px;
    box-shadow:4px 4px 0px #000;
    width:100% !important;
    max-width:100% !important;
    margin:0 auto;
    font-size:.95rem;
    color:var(--text);
}
 .popup-content h2{
    color:var(--text);
    font-size:1.4rem;
    font-weight:bolder;
    margin-bottom:10px;
    border-bottom:2px solid var(--text);
    padding-bottom:5px;
}
 .popup-content p{
    color:var(--text);
    font-size:medium;
    font-family:Arial,sans-serif;
    font-weight:bold;
    line-height:1;
    margin:15px 0;
}
/* Popup buttons */
 .popup-content button{
    display:block;
    margin:20px auto 0;
    padding:10px 20px;
    background-color:var(--primary-700);
    color:#fff;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:.9rem;
    transition:background-color .2s ease-in-out,transform .2s ease-in-out,box-shadow .2s ease-in-out;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
 .popup-content button:hover{
    background-color:var(--primary-600);
    transform:scale(1.05);
}
 .popup-content .close-btn{
    border:.75px solid #080808;
    border-radius:2px;
    position:absolute;
    top:10px;
    right:10px;
    width:30px;
    height:30px;
    font-size:2rem;
    color:var(--danger-600);
    cursor:pointer;
    transition:color .2s ease-in-out,background .2s ease-in-out;
    background:white;
    display:flex;
    align-items:center;
    justify-content:center;
}
 .popup-content .close-btn:hover{
    background:var(--danger);
    color:#fff;
}
/* Back button */
 .back-button{
    display:block;
    margin:20px auto 0;
    padding:10px 20px;
    background-color:var(--accent);
    color:#fff;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:.9rem;
    transition:background-color .2s ease-in-out,transform .2s ease-in-out,box-shadow .2s ease-in-out;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
 .back-button:hover{
    background-color:var(--accent-600);
    transform:scale(1.05);
    box-shadow:0 4px 10px rgba(0,0,0,0.2);
}
 .popup-content .progress-bar-container{
    border:1px solid var(--text);
    border-radius:4px;
    width:80%;
    background-color:#bdbcbc;
    overflow:hidden;
    margin-top:0;
}
 .popup-content .progress-bar{
    height:10px;
    text-align:center;
    font-weight:bolder;
    line-height:10px;
    font-size:.7rem;
    transition:width 1.5s ease,background-color 1.5s ease;
    color:#fff;
}
 .popup-content .progress-bar.yellow{
    color:#000;
}
/* Popup footer icons */
 .popup-footer{
    display:flex;
    justify-content:center;
    gap:12px;
    margin-top:15px;
}
 .footer-btn{
    background:rgba(1,196,255,.15) !important;
    border:1px solid rgba(255,255,255,.25);
    backdrop-filter:blur(6px);
    color:#000 !important;
    width:42px;
    height:42px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all .25s ease;
}
 .footer-btn i{
    font-size:1rem;
}
 .footer-btn:hover{
    transform:translateY(-2px) scale(1.05);
    background:rgba(255,255,255,.25) !important;
    box-shadow:0 4px 10px rgba(0,0,0,0.25);
}
/* ========== REVIEW SYSTEM (inside popup) ========== */
 #reviewName,#reviewText{
    width:100%;
    padding:10px;
    margin:10px 0;
    font-size:1rem;
    border:2px solid var(--text);
    border-radius:4px;
    background:#fafafa;
    color:var(--text);
    font-weight:bold;
}
 #starContainer span{
    font-size:1.6rem;
    padding:5px;
    color:#d4af37;
    cursor:pointer;
    transition:transform .2s ease,color .2s ease;
}
 #starContainer span:hover{
    transform:scale(1.15);
    color:#ffcc00;
}
 .review-box{
    background-color:#fff;
    border:3px solid var(--text);
    padding:15px;
    margin-top:15px;
    border-radius:6px;
    box-shadow:4px 4px 0px #000;
    text-align:left;
}
 .review-box strong{
    font-weight:bolder;
    color:var(--text);
    font-size:1.1rem;
}
 .review-comment{
    margin:10px 0;
    font-size:1rem;
    font-weight:normal;
}
 .reply-box{
    background-color:#f0f0f0;
    border-left:4px solid var(--accent);
    margin-top:10px;
    padding:8px 12px;
    font-size:.9rem;
    border-radius:4px;
}
 .review-box input[type="text"]{
    width:70%;
    padding:8px;
    margin-top:10px;
    border:2px solid var(--text);
    border-radius:4px;
    font-weight:bold;
}
 .review-box button{
    background-color:var(--primary-700);
    color:#fff;
    font-weight:bold;
    padding:6px 12px;
    border:none;
    margin-top:8px;
    border-radius:4px;
    cursor:pointer;
    transition:.2s;
}
 .review-box button:hover{
    background-color:var(--accent);
    color:#000;
}
 .review-box small{
    font-size:.8rem;
    color:gray;
    font-weight:normal;
}
/* ========== HIGHLIGHTS ========== */
 .popup .popup-content p.board-rank,.popup .popup-content>p:nth-of-type(5){
    background-color:var(--warning) !important;
    color:#000 !important;
    padding:6px 10px !important;
    border-radius:8px !important;
    display:inline-block !important;
    font-weight:800 !important;
    box-shadow:0 6px 18px rgba(245,158,11,0.16) !important;
    margin:6px 0 10px 0 !important;
    line-height:1.2 !important;
}
/* ========== COMPARE UI ========== */
 .popup-content .comparison-row{
    display:flex;
    align-items:center;
    margin:4px 0;
}
 .popup-content .comparison-label{
    flex:1;
    text-align:center;
    font-weight:bold;
    font-size:.85rem;
}
 .compare-row{
    display:flex;
    align-items:center;
    margin:6px 0 14px;
}
 .bar{
    height:12px;
    border-radius:3px;
}
 .left-bar{
    background-color:#4caf50;
    margin-right:6px;
    transform-origin:right;
}
 .right-bar{
    background-color:#2196f3;
    margin-left:6px;
    transform-origin:left;
}
 .bar-label{
    min-width:30px;
    text-align:center;
    font-weight:bold;
    font-size:.9rem;
}
 .compare-table-container{
    width:100%;
    overflow-x:auto;
    margin:10px 0;
    display:flex;
    justify-content:center;
}
 .compare-table{
    width:100%;
    max-width:100%;
    border-collapse:collapse;
    font-size:1.05rem;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}
 .compare-table th,.compare-table td{
    padding:12px;
    border:1px solid #ccc;
    text-align:center;
    min-width:90px;
}
 .compare-table th{
    background-color:var(--primary-700);
    color:white;
    font-size:1.1rem;
}
 .compare-table tr:nth-child(even){
    background-color:#f9f9f9;
}
/* ========== ICON NAV (Professional) ========== */
 .icon-nav-wrapper{
    max-width:700px;
    margin:20px auto 40px;
    padding:0 20px;
}
 .icon-nav-container{
    background:#fff;
    border-radius:12px;
    box-shadow:0 4px 14px rgba(0,0,0,0.1);
    display:flex;
    justify-content:center;
    gap:32px;
    padding:15px 25px;
    overflow-x:auto;
    white-space:nowrap;
}
 .icon-nav-container a,.icon-nav-container button{
    background:var(--gradient-soft);
    border-radius:14px;
    width:60px;
    height:60px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#333;
    font-size:1.9rem;
    border:none;
    cursor:pointer;
    box-shadow:none;
    transition:background-color .3s ease,color .3s ease,transform .2s ease;
    outline:none;
    text-decoration:none;
    flex:1 1 auto;
    min-width:40px;
    text-align:center;
}
 .icon-nav-container a:hover,.icon-nav-container button:hover{
    background:var(--primary-700);
    color:#fff;
    box-shadow:0 0 12px rgba(0,123,255,0.7),inset 0 0 8px rgba(0,123,255,0.5);
    transform:scale(1.1);
}
 .icon-nav-container a:focus,.icon-nav-container button:focus{
    outline:3px solid var(--primary);
    outline-offset:3px;
}
 .icon-nav-container i{
    font-size:1.8rem;
    transition:transform .3s ease,color .3s ease;
}
 .icon-nav-container a:hover i,.icon-nav-container button:hover i{
    color:#00cc66;
    transform:scale(1.25) rotate(-5deg);
}
/* ========== FEATURED BOX / CARD ========== */
 .new-box-wrapper{
    display:flex;
    justify-content:center;
    align-items:center;
    margin-top:1.5rem;
    animation:fadeIn 1s ease-in-out;
    gap:14px;
    flex-wrap:wrap;
}
 #featuredBox,.featured-box{
    position:relative;
    width:min(90vw, 300px);
    aspect-ratio:1 / 1;
    border-radius:16px;
    background:var(--card-radial);
    box-shadow:0 10px 25px rgba(0,0,0,0.6),inset 0 0 20px rgba(255,255,255,0.05);
    display:flex;
    justify-content:center;
    align-items:center;
    color:white;
    font-size:2.25rem;
    font-weight:bold;
    cursor:pointer;
    overflow:hidden;
    transition:all .3s ease;
}
 #featuredBox:hover,.featured-box:hover{
    transform:scale(1.05) rotate(.2deg);
    box-shadow:0 12px 30px rgba(255,255,255,0.2);
}
 .featured-text{
    z-index:2;
    text-align:center;
    line-height:1.1;
}
 .ssc-line{
    font-size:4.25rem;
    font-weight:900;
    letter-spacing:2px;
}
 .year-line{
    font-size:7.25rem;
    font-weight:1000;
    letter-spacing:1px;
    margin-top:.25rem;
    text-shadow:0 0 10px rgba(255,255,255,0.2);
}
 .new-ribbon{
    position:absolute;
    top:12px;
    left:-50px;
    transform:rotate(-45deg);
    background:#ff0055;
    color:white;
    padding:6px 60px;
    font-size:.85rem;
    font-weight:bold;
    letter-spacing:1px;
    box-shadow:0 0 12px rgba(255, 0, 85, 0.7);
    animation:pulseGlow 1.8s infinite ease-in-out;
    z-index:5;
}
 @keyframes pulseGlow{
    0%,100%{
        box-shadow:0 0 10px #ff0055;
    }
    50%{
        box-shadow:0 0 25px white;
    }
}
/* ========== UTILS & MISC ========== */
 .menu-btn{
    position:absolute;
    top:15px;
    right:20px;
    font-size:24px;
    cursor:pointer;
    z-index:1001;
    color:var(--text-muted);
}
 .student-name,.student-roll,.student-school{
    cursor:pointer;
}
 body:not(.dark-mode) .student-name,body:not(.dark-mode) .student-roll,body:not(.dark-mode) .student-school{
    color:var(--text);
    font-weight:bolder;
}
 header img.home-icon{
    position:absolute;
    top:15px;
    left:12.5px;
    width:18px;
    height:18px;
    cursor:pointer;
    z-index:1001;
    color:#ffffff;
}
 .locked,body.locked{
    overflow:hidden !important;
    position:fixed !important;
    width:100% !important;
}
/* Scroll-to-top */
 #scrollToTopBtn{
    display:none;
    position:fixed;
    top:20px;
    right:calc(center);
    z-index:99;
    border:none;
    outline:none;
    background-color:#d9d9d9;
    color:white;
    cursor:pointer;
    padding:0px;
    border-radius:150%;
}
 #scrollToTopBtn img{
    width:32x;
    height:32px;
}
/* Notification / status */
 .copy-status{
    position:fixed;
    bottom:80px;
    left:50%;
    transform:translateX(-50%);
    background:#111;
    color:#0f0;
    font-weight:bold;
    padding:6px 12px;
    border-radius:6px;
    opacity:0;
    transition:opacity .5s ease-in-out;
    z-index:10000;
}
 .error-message{
    color:var(--danger-600);
    font-size:.9em;
    margin-top:4px;
}
 .shake{
    animation:shake .3s;
}
 @keyframes shake{
    0%{
        transform:translateX(0);
    }
    25%{
        transform:translateX(-5px);
    }
    50%{
        transform:translateX(5px);
    }
    75%{
        transform:translateX(-5px);
    }
    100%{
        transform:translateX(0);
    }
}
/* Hint banners */
 #tableHint{
    text-transform:uppercase;
    font-weight:800;
    font-size:1rem;
    background-color:#e6f7ff;
    color:#005580;
    padding:10px 15px;
    margin:20px auto;
    border-left:5px solid #0099cc;
    border-radius:4px;
    max-width:95%;
    text-align:center;
    box-shadow:2px 2px 6px rgba(0,0,0,0.08);
}
 #tableHint i{
    margin-right:8px;
}
 #selectPrompt{
    text-transform:uppercase;
    font-weight:900;
    font-size:1.2rem;
    padding:16px 24px;
    margin:40px auto 35px;
    background:linear-gradient(145deg, #d32f2f, #b71c1c);
    color:#fff;
    border-left:6px solid #b71c1c;
    border-radius:8px;
    box-shadow:3px 3px 10px rgba(0,0,0,0.25);
    text-align:center;
    max-width:90%;
    letter-spacing:1px;
    transition:background .3s ease;
    position:relative;
}
 #selectPrompt .down-arrow{
    margin-left:10px;
    font-size:1.4rem;
    vertical-align:middle;
    animation:bounceArrow 1.5s infinite;
}
 @keyframes bounceArrow{
    0%,100%{
        transform:translateY(0);
    }
    50%{
        transform:translateY(6px);
    }
}
/* Ripple element */
 .ripple{
    position:absolute;
    background:rgba(255,255,255,.4);
    border-radius:50%;
    transform:scale(0);
    animation:rippleAnimation .6s linear;
    pointer-events:none;
    width:100px;
    height:100px;
    opacity:.75;
}
 @keyframes rippleAnimation{
    to{
        transform:scale(4);
        opacity:0;
    }
}
/* Corner icons */
 .corner-icon{
    position:absolute;
    width:28px;
    height:28px;
    cursor:pointer;
    opacity:.8;
    transition:transform .2s ease;
    z-index:999;
}
 .corner-icon:hover{
    transform:scale(1.2);
    opacity:1;
}
 .bottom-left{
    bottom:12px;
    left:12px;
}
 .bottom-right{
    bottom:12px;
    right:12px;
}
 nav[aria-label="breadcrumb"]{
    display:none !important;
}
/* Copy buttons */
 .copy-result-btn,.copy-link-btn{
    width:44px;
    height:44px;
    border-radius:50%;
    font-size:18px;
    border:none;
    background:#eee;
    cursor:pointer;
}
 .copy-result-btn:hover,.copy-link-btn:hover{
    background:#ddd;
}
/* ========== CONTACT BOX ========== */
 .contact-box{
    background:#ffffff;
    padding:40px 30px;
    border-radius:16px ;
    max-width:460px;
    width:100%;
    border:2px solid var(--accent);
    box-shadow:4px 4px 10px #bebebe,-4px -4px 10px #ffffff;
    margin:30px auto;
}
 .contact-box h2{
    color:#00b37a;
    font-size:1.7rem;
    font-weight:900;
    margin-bottom:25px;
    text-align:center;
}
 .contact-box .form-group{
    margin-bottom:20px;
}
 .contact-box label{
    display:block;
    margin-bottom:6px;
    font-weight:bold;
    color:#333;
    font-size:1rem;
}
 .contact-box input,.contact-box textarea{
    width:100%;
    padding:12px 14px;
    font-size:15px;
    border:1px solid #ccc;
    border-radius:10px;
    background-color:#f9f9f9;
    color:#111;
    resize:none;
    box-shadow:inset 3px 3px 6px #d1d1d1,inset -3px -3px 6px #fff;
}
 .contact-box input::placeholder,.contact-box textarea::placeholder{
    color:#888;
}
 .contact-box button{
    width:100%;
    background:var(--gradient-soft);
    color:#000;
    font-weight:800;
    font-size:16px;
    padding:14px;
    border-radius:12px;
    border:2px solid var(--accent);
    cursor:pointer;
    transition:all .3s ease;
    box-shadow:3px 3px 6px #bebebe,-3px -3px 6px #ffffff;
}
 .contact-box button:hover{
    background:var(--accent);
    color:#000;
    box-shadow:0 0 12px rgba(0,255,153,0.7),inset 0 0 8px rgba(0,255,153,0.5);
    transform:scale(1.05);
}
/* ========== FORM POPUP (Access gate) ========== */
 .form-popup{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
 .form-container{
    background:#fff;
    padding:20px 25px;
    border-radius:12px;
    max-width:400px;
    width:90%;
    box-shadow:0 5px 25px rgba(0,0,0,0.15);
}
 .form-container h2{
    margin-bottom:15px;
    font-size:1.4rem;
    text-align:center;
}
 .form-container input,.form-container select,.form-container textarea{
    width:100%;
    padding:10px;
    margin:6px 0 15px;
    border:1px solid #ccc;
    border-radius:6px;
    font-size:1rem;
}
 .btn-primary{
    background:var(--primary);
    color:white;
    padding:10px 15px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
 .btn-primary:hover{
    background:var(--primary-600);
}
 .btn-secondary{
    background:#e0e0e0;
    padding:10px 15px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    margin-left:10px;
}
 .popup-actions{
    display:flex;
    justify-content:flex-end;
    margin-top:10px;
}
/* Access status animation */
 .access-status{
    text-align:center;
    padding:30px 20px;
}
 .access-status .circle{
    width:80px;
    height:80px;
    margin:0 auto 20px;
    border:4px solid #ddd;
    border-top:4px solid #3b82f6;
    border-radius:50%;
    animation:spin 1s linear infinite;
}
 .access-status .tick,.access-status .cross{
    font-size:3rem;
    opacity:0;
    transform:scale(.8);
    animation:popIn .3s forwards;
}
 .access-status .tick{
    color:#16a34a;
}
 .access-status .cross{
    color:#dc2626;
}
 .access-status .status-text{
    font-size:1.2rem;
    font-weight:600;
}
/* ========== INFO BANNERS & TEAM ========== */
 .info-banner{
    font-size:1.2rem;
    margin:20px auto 10px;
    font-weight:bold;
    background-color:#ffefc1;
    border-left:4px solid orange;
    padding:10px 14px;
    border-radius:5px;
    max-width:90%;
    color:#000;
    display:inline-block;
    box-shadow:2px 2px 6px rgba(0,0,0,0.1);
}
 .team-container{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:25px;
    margin-top:40px;
}
 .team-card{
    background:#f0fff9;
    border:2px solid #00b37a;
    padding:25px;
    border-radius:12px;
    width:100%;
    max-width:300px;
    flex:1 1 300px;
    box-shadow:0 0 10px #00b37a33;
    text-align:center;
}
 .team-card h2{
    font-size:1.1rem;
    margin-bottom:8px;
    color:#00764f;
    font-weight:800;
    text-shadow:0 0 4px #00b37a66;
}
 .team-card h3{
    font-size:1.5rem;
    margin-bottom:14px;
    color:#00b37a;
    font-weight:900;
}
 .team-card p{
    font-size:.95rem;
    font-weight:600;
    color:#333;
    line-height:1.6;
    margin-bottom:12px;
}
 .team-img{
    width:100px;
    height:100px;
    object-fit:cover;
    object-position:center;
    border-radius:50%;
    border:3px solid #00b37a;
    margin-bottom:15px;
}
/* ========== SEO SECTION ========== */
 #seo-blurb{
    background:linear-gradient(135deg, #f9fafb, #f1f3f6);
    padding:30px 0;
}
 .seo-container{
    margin:0 auto;
    padding:0 20px;
}
 #seo-blurb h2{
    font-size:2rem;
    font-weight:800;
    margin-bottom:12px;
    color:#111;
}
 #seo-blurb h3{
    font-size:1.3rem;
    margin:20px 0 10px;
    color:#6e6e6e;
}
 #seo-blurb p{
    font-size:1.05rem;
    line-height:1.7;
    color:#222;
    margin-bottom:14px;
}
 #seo-blurb strong{
    color:#000;
}
 #seo-blurb em{
    font-style:normal;
    font-weight:600;
    color:#333;
}
 #seo-blurb ul{
    list-style:none;
    padding:0;
    margin:0 0 16px;
}
 #seo-blurb li{
    padding-left:26px;
    position:relative;
    margin-bottom:10px;
    font-size:1rem;
    line-height:1.6;
}
 #seo-blurb li::before{
    content:"‚úî";
    position:absolute;
    left:0;
    color:#0d6efd;
    font-weight:bold;
}
/* ========== MOBILE FILTER DRAWER ========== */
 .btn-top-schools{
    padding:8px 12px;
    border-radius:999px;
    border:0;
    background:#111;
    color:#fff;
    font-weight:600;
    box-shadow:0 2px 10px rgba(0,0,0,.12);
}
 .btn-top-schools:active{
    transform:translateY(1px);
}
 .btn-mobile-filter{
    padding:8px 14px;
    border-radius:999px;
    border:1px solid black;
    background:black;
    font-weight:600;
    color:white;
}
 .btn-mobile-filter:active{
    transform:translateY(1px);
}
 @media(min-width:769px){
    #mobileFilterBtn{
        display:none
    }
}
 .mf-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.35);
    opacity:0;
    pointer-events:none;
    transition:.2s;
    z-index:9998;
}
 .mf-overlay.open{
    opacity:1;
    pointer-events:auto;
}
 .mf-drawer{
    position:fixed;
    top:0;
    left:0;
    height:100dvh;
    width:82vw;
    max-width:420px;
    background:#fff;
    box-shadow:0 0 40px rgba(0,0,0,.2);
    transform:translateX(-100%);
    transition:.25s;
    z-index:9999;
    display:flex;
    flex-direction:column;
}
 .mf-drawer.open{
    transform:translateX(0);
}
 .mf-head{
    padding:14px 16px;
    border-bottom:1px solid #eee;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
 .mf-title{
    font-weight:700;
    font-size:16px;
}
 .mf-close{
    border:0;
    background:transparent;
    font-size:20px;
    line-height:1;
    cursor:pointer;
    background:#ff0000;
}
 .mf-body{
    padding:12px 16px;
    overflow:auto;
    gap:16px;
    display:flex;
    flex-direction:column;
}
 .mf-section{
    border:1px solid #eee;
    border-radius:12px;
    padding:12px;
}
 .mf-section h4{
    margin:0 0 8px 0;
    font-size:14px;
}
 .mf-range{
    display:flex;
    flex-direction:column;
    gap:8px;
}
 .mf-range input[type=number]{
    width:100%;
    padding:8px;
    border:1px solid #ddd;
    border-radius:8px;
}
 .mf-dual{
    position:relative;
    height:36px;
    display:flex;
    align-items:center;
}
 .mf-dual input[type=range]{
    position:absolute;
    width:100%;
    pointer-events:none;
    background:transparent;
    height:36px;
}
 .mf-dual input[type=range]::-webkit-slider-thumb{
    pointer-events:auto;
    -webkit-appearance:none;
    width:18px;
    height:18px;
    border-radius:50%;
    background:#111;
    border:2px solid #fff;
    box-shadow:0 1px 6px rgba(0,0,0,.2);
}
 .mf-dual input[type=range]::-moz-range-thumb{
    pointer-events:auto;
    width:18px;
    height:18px;
    border-radius:50%;
    background:#111;
    border:2px solid #fff;
    box-shadow:0 1px 6px rgba(0,0,0,.2);
}
 .mf-track{
    position:absolute;
    height:6px;
    width:100%;
    background:#e9e9e9;
    border-radius:999px;
}
 .mf-track-fill{
    position:absolute;
    height:6px;
    background:#111;
    border-radius:999px;
}
 .mf-chips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    max-height:164px;
    overflow:auto;
}
 .mf-chip{
    display:flex;
    align-items:center;
    gap:8px;
}
 .mf-chip input{
    transform:scale(1.1);
}
 .mf-search{
    display:flex;
    gap:8px;
    margin-bottom:8px;
}
 .mf-search input{
    flex:1;
    padding:8px;
    border:1px solid #ddd;
    border-radius:8px;
}
 .mf-list{
    max-height:240px;
    overflow:auto;
    display:grid;
    gap:8px;
}
 .mf-item{
    display:flex;
    align-items:center;
    gap:8px;
}
 .mf-foot{
    position:sticky;
    bottom:0;
    background:#fff;
    border-top:1px solid #eee;
    padding:12px 16px;
    display:flex;
    gap:8px;
}
 .mf-apply{
    flex:1;
    padding:10px;
    border-radius:10px;
    border:0;
    background:#111;
    color:#fff;
    font-weight:700;
}
 .mf-reset{
    padding:10px 14px;
    border-radius:10px;
    border:1px solid #ddd;
    background:#111111;
}
/* Pills */
 .btn-pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 14px;
    border-radius:999px;
    border:1px solid #0f172a;
    background:linear-gradient(135deg,#1f2937,#111827);
    color:#fff;
    font-weight:700;
    box-shadow:0 2px 10px rgba(0,0,0,.15);
    cursor:pointer;
    transition:transform .1s ease,box-shadow .2s ease;
}
 .btn-pill:hover{
    transform:translateY(-1px);
    box-shadow:0 6px 16px rgba(0,0,0,.2);
}
 .btn-pill:active{
    transform:translateY(0);
}
 .btn-pill i{
    font-size:18px;
    line-height:0;
}
 .btn-top-schools,.btn-mobile-filter{
    background:linear-gradient(135deg,#1f2937,#111827);
    border-color:#0f172a;
    min-width:120px;
    justify-content:center;
}
 .btn-top-schools i{
    color:#facc15;
}
 .btn-mobile-filter i{
    color:#38bdf8;
}
 #mobileFilterBtn{
    display:inline-flex !important;
}
/* ========== STATUS / LOADING ========== */
 .loading-spinner{
    border:4px solid rgba(0,0,0,0.1);
    border-top:4px solid var(--primary-700);
    border-radius:50%;
    width:1.25rem;
    height:1.25rem;
    animation:spin 1s linear infinite;
    align-items:center;
}
/* ========== ANIMATIONS ========== */
 @keyframes fadeIn{
    0%{
        opacity:0;
    }
    100%{
        opacity:1;
    }
}
 @keyframes slideIn{
    0%{
        transform:translateX(-100%);
    }
    100%{
        transform:translateX(0);
    }
}
 @keyframes bounce{
    0%,20%,50%,80%,100%{
        transform:translateY(0);
    }
    40%{
        transform:translateY(-30px);
    }
    60%{
        transform:translateY(-15px);
    }
}
 @keyframes ripple{
    to{
        transform:scale(4);
        opacity:0;
    }
}
 @keyframes spin{
    to{
        transform:rotate(360deg);
    }
}
 @keyframes popIn{
    to{
        opacity:1;
        transform:scale(1);
    }
}
 @keyframes fadeSlideIn{
    to{
        opacity:1;
        transform:translateY(0);
    }
}
 @keyframes shineMove{
    0%{
        background-position:200% center;
    }
    100%{
        background-position:0% center;
    }
}
/* Header animations */
 header h1{
    animation:fadeIn 2s ease-in-out;
}
 header h2{
    animation:fadeIn 2.25s ease-in-out;
}
/* Helpers */
 .fade-slide{
    opacity:0;
    transform:translateY(20px);
    animation:fadeSlideIn 1s ease-out forwards;
}
 .shine{
    position:relative;
    display:inline-block;
    background:linear-gradient(90deg, #ffffff 0%, #fff 50%, #ffffff 100%);
    background-size:200% auto;
    color:transparent;
    -webkit-background-clip:text;
    background-clip:text;
    animation:shineMove 2s linear infinite;
}
/* ========== ACCESSIBILITY / MISC ========== */
 .click-count{
    margin-left:4px;
    font-size:12px;
    color:gray;
}
 .student-name h3,.student-school h4{
    all:unset;
    display:inline;
}
/* ========== RESPONSIVE ========== */
 @media (max-width:768px){
    body{
        font-size:.8rem;
        overflow-y:auto;
    }
    h1{
        font-size:2rem;
    }
    h2{
        font-size:1rem;
    }
    table,th,td{
        padding:.25em;
    }
    button{
        padding:.50rem .50rem;
        font-size:.66rem;
        border:none;
        border-radius:0px;
    }
    .loading-spinner{
        width:1rem;
        height:1rem;
    }
    .popup{
        width:90%;
        min-height:89%;
        padding:10px;
        padding-top:40px;
        border:5px;
    }
    .back-button{
        font-size:.8rem;
        padding:8px 15px;
    }
    input[type="text"],select{
        padding-left:8%;
    }
    header{
        text-align:center;
        padding:10px;
    }
    .home-icon{
        width:28px;
        height:28px;
    }
    h1{
        padding:10px;
        font-size:1.2rem;
    }
    h2{
        font-size:.9rem;
    }
    .icon-nav-container{
        flex-wrap:wrap;
        gap:16px;
        justify-content:center;
        padding:10px;
    }
    .icon-nav-container a,.icon-nav-container button{
        width:48px;
        height:48px;
        font-size:1.4rem;
    }
    .icon-nav-wrapper{
        padding:0 10px;
    }
    .year-dropdown select{
        width:100%;
        font-size:1rem;
        padding:8px;
    }
    #featuredBox,.featured-box{
        font-size:1.5rem;
        width:80vw;
        transform:scale(.9);
        margin:10px auto;
    }
    #popupWindow{
        width:95%;
        left:2.5%;
        right:2.5%;
        max-width:none;
    }
    #selectPrompt{
        font-size:1rem;
        padding:12px 20px;
        margin:15px auto 20px;
    }
    main{
        padding:1rem .5rem;
    }
    .popup-content{
        font-size:.9rem !important;
        padding:10px;
    }
}
/* Popup responsiveness fix (kept) */
 .popup-content input[type="text"],.popup-content input[type="email"],.popup-content textarea,#shareInput{
    width:100% !important;
    padding:10px !important;
    margin:10px 0 !important;
    border:2px solid var(--text) !important;
    border-radius:8px !important;
    font-weight:bold;
    resize:none !important;
}
 .popup-content input{
    display:block;
    margin:0 auto;
}
/* ========== BUTTONS (generic) ========== */
 button{
    padding:10px 14px;
    font-size:1rem;
    background-color:var(--primary);
    color:white;
    border:0;
    border-radius:10px;
    cursor:pointer;
    transition:background-color .2s,transform .2s,box-shadow .2s;
}
 button:hover{
    background-color:var(--primary-600);
    transform:translateY(-1px);
    box-shadow:var(--shadow-soft);
}
 button[onclick^="promptComparison"],button[onclick^="showSSCResultFromHSC"]{
    background-color:#fff9c4 !important;
    color:#000 !important;
    border:1px solid #f0e68c !important;
    font-weight:800;
    padding:8px 14px;
    border-radius:10px;
    transition:background-color .2s;
}
 button[onclick^="promptComparison"]::before{
    content:"‚öñ ";
}
 button[onclick^="showSSCResultFromHSC"]::before{
    content:"üìú ";
}
 button[onclick^="promptComparison"]:hover,button[onclick^="showSSCResultFromHSC"]:hover{
    background-color:#fff59d !important;
}
/* ========== FEATURED YEAR CARDS ========== */
 .new-box-wrapper{
    display:flex;
    justify-content:center;
    gap:14px;
    flex-wrap:wrap;
    margin:18px auto 0;
    max-width:var(--container);
    padding:0 16px;
}
 .featured-box,#featuredBox{
     position:relative;
     width:min(90vw, 300px);
     aspect-ratio:1/1;
     border-radius:18px;
     background:var(--featured-bg-light);
     color:var(--text);
     box-shadow:var(--shadow-strong);
     display:grid;
     place-items:center;
     font-size:2.25rem;
     font-weight:900;
     cursor:pointer;
     overflow:hidden;
     transition:transform .25s ease,box-shadow .25s ease;
}
 .featured-box:hover{
    transform:translateY(-4px) scale(1.03);
    box-shadow:0 18px 48px rgba(0,0,0,0.35);
}
 .featured-text{
    text-align:center;
    line-height:1.05;
    z-index:2;
}
 .ssc-line{
    font-size:3.8rem;
    letter-spacing:1.5px;
}
 .year-line{
    font-size:6.2rem;
    text-shadow:0 0 12px rgba(255,255,255,0.18);
}
 .new-ribbon{
    position:absolute;
    top:12px;
    left:-50px;
    transform:rotate(-45deg);
    background:#ff0055;
    color:#fff;
    padding:6px 60px;
    font-size:.85rem;
    font-weight:900;
    letter-spacing:1px;
    box-shadow:0 0 12px rgba(255, 0, 85, .7);
    animation:pulseGlow 1.8s infinite ease-in-out;
    z-index:5;
}
 @keyframes pulseGlow{
    0%,100%{
        box-shadow:0 0 10px #ff0055;
    }
    50%{
        box-shadow:0 0 22px #fff;
    }
}
/* ========== POPUPS ========== */
 .popup{
    position:fixed;
    inset:50% auto auto 50%;
    transform:translate(-50%,-50%) scale(.96);
    z-index:9999;
    width:min(92vw, 520px);
    max-height:82vh;
    background:transparent;
    border:0;
    animation:popupIn .28s ease forwards;
}
 @keyframes popupIn{
    from{
        transform:translate(-50%,-50%) scale(.96);
        opacity:0;
    }
    to{
        transform:translate(-50%,-50%) scale(1);
        opacity:1;
    }
}
 .popup.pop-out{
    animation:popupOut .28s ease forwards;
}
 @keyframes popupOut{
    from{
        transform:translate(-50%,-50%) scale(1);
        opacity:1;
    }
    to{
        transform:translate(-50%,-50%) scale(.96);
        opacity:0;
    }
}
 .popup-content{
    background:#fff;
    color:var(--text);
    border:2px solid var(--border-strong);
    border-radius:16px;
    padding:16px 16px 18px;
    box-shadow:0 24px 80px rgba(0,0,0,.25);
    width:100% !important;
    max-width:100% !important;
    margin:0 auto;
    font-size:.98rem;
}
 .popup-content h2{
    color:var(--text);
    font-size:1.25rem;
    font-weight:900;
    border-bottom:2px solid var(--border);
    padding-bottom:6px;
    margin:4px 0 12px;
}
 .popup-content p{
    font-size:.98rem;
    font-weight:700;
    line-height:1.4;
    margin:10px 0;
}
 .popup-content .close-btn{
    position:absolute;
    top:10px;
    right:10px;
    width:34px;
    height:34px;
    display:grid;
    place-items:center;
    font-size:1.4rem;
    color:var(--danger-600);
    background:#fff;
    border:1px solid var(--border-strong);
    border-radius:8px;
    cursor:pointer;
    transition:background .18s ease,color .18s ease,transform .18s ease;
}
 .popup-content .close-btn:hover{
    background:var(--danger-600);
    color:#fff;
    transform:scale(1.03);
}
 .progress-bar-container{
    border:1px solid var(--border-strong);
    border-radius:8px;
    width:100%;
    background-color:#f0f0f0;
    overflow:hidden;
    margin:8px 0 2px;
}
 .progress-bar{
    height:12px;
    text-align:center;
    font-weight:800;
    line-height:12px;
    font-size:.7rem;
    transition:width 1.2s ease,background-color 1.2s ease;
    color:#fff;
}
 .progress-bar.yellow{
    color:#000;
}
 .popup-footer{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:12px;
}
 .footer-btn{
    background:#1018270f !important;
    border:1px solid #e5e7eb;
    color:#000 !important;
    width:42px;
    height:42px;
    border-radius:50%;
    display:grid;
    place-items:center;
    transition:transform .2s ease,background .2s ease,box-shadow .2s ease;
}
 .footer-btn:hover{
    transform:translateY(-2px) scale(1.05);
    background:#f3f4f6 !important;
    box-shadow:0 6px 16px rgba(0,0,0,.12);
}
 .popup .popup-content p.board-rank,.popup .popup-content>p:nth-of-type(5){
    background:#fff3c6 !important;
    color:#2b1b00 !important;
    padding:6px 10px !important;
    border-radius:10px !important;
    display:inline-block !important;
    font-weight:900 !important;
    box-shadow:0 6px 18px rgba(245, 158, 11, 0.16) !important;
    margin:6px 0 10px !important;
    line-height:1.2 !important;
}
 .compare-table-container{
    width:100%;
    overflow-x:auto;
    margin:10px 0;
    display:flex;
    justify-content:center;
}
 .compare-table{
    width:100%;
    border-collapse:collapse;
    font-size:1.02rem;
    box-shadow:0 0 10px rgba(0,0,0,.18);
}
 .compare-table th,.compare-table td{
    padding:10px 12px;
    border:1px solid #e5e7eb;
    text-align:center;
    min-width:90px;
}
 .compare-table th{
    background:var(--primary-700);
    color:#fff;
}
/* Review system in popup */
 #reviewName,#reviewText{
    width:100%;
    padding:10px;
    margin:10px 0;
    font-size:1rem;
    border:2px solid var(--border-strong);
    border-radius:10px;
    background:#fafafa;
    color:var(--text);
    font-weight:700;
}
 #starContainer span{
    font-size:1.5rem;
    padding:4px;
    color:#d4af37;
    cursor:pointer;
    transition:transform .2s ease,color .2s ease;
}
 #starContainer span:hover{
    transform:scale(1.1);
    color:#ffcc00;
}
/* ========== BANNERS & HINTS ========== */
 .info-banner{
    font-size:1rem;
    margin:14px auto;
    font-weight:800;
    background:#fff7d6;
    border-left:4px solid var(--accent);
    padding:10px 14px;
    border-radius:10px;
    max-width:var(--container);
    color:#1d1a0b;
    box-shadow:var(--shadow-soft);
}
 #tableHint{
    text-transform:none;
    font-weight:800;
    font-size:.95rem;
    background:#e8f3ff;
    color:#07305c;
    padding:10px 14px;
    margin:16px auto;
    border-left:5px solid #2b7df5;
    border-radius:10px;
    max-width:var(--container);
    text-align:center;
    box-shadow:var(--shadow-soft);
}
 #tableHint i{
    margin-right:6px;
}
/* Select prompt */
 #selectPrompt{
    font-weight:900;
    font-size:1.05rem;
    padding:14px 18px;
    margin:24px auto 8px;
    background:linear-gradient(145deg, #d32f2f, #b71c1c);
    color:#fff;
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,.16);
    text-align:center;
    max-width:min(760px, 92vw);
    letter-spacing:.3px;
}
 #selectPrompt .down-arrow{
    margin-left:10px;
    font-size:1.3rem;
    vertical-align:middle;
    animation:bounceArrow 1.5s infinite ease;
}
 @keyframes bounceArrow{
    0%,100%{
        transform:translateY(0);
    }
    50%{
        transform:translateY(5px);
    }
}
/* ========== SEO BLURB (Story) ========== */
 #seo-blurb{
    width:100%;
    background:linear-gradient(135deg, #f9fafb, #f1f3f6);
    padding:24px 0 28px;
}
 .seo-container{
    max-width:var(--container);
    margin:0 auto;
    padding:0 16px;
}
 #seo-blurb h2{
    font-size:1.8rem;
    font-weight:900;
    margin-bottom:10px;
    color:#0b1020;
}
 #seo-blurb h3{
    font-size:1.15rem;
    margin:16px 0 10px;
    color:#374151;
}
 #seo-blurb p{
    font-size:1rem;
    line-height:1.7;
    color:#212938;
    margin-bottom:12px;
}
/* ========== MOBILE FILTER DRAWER ========== */
 .btn-pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 14px;
    border-radius:999px;
    border:1px solid #0f172a;
    background:linear-gradient(135deg,#1f2937,#111827);
    color:#fff;
    font-weight:800;
    box-shadow:0 2px 10px rgba(0,0,0,.15);
}
 .btn-pill:hover{
    transform:translateY(-1px);
    box-shadow:0 6px 16px rgba(0,0,0,.2);
}
 .btn-top-schools,.btn-mobile-filter{
    min-width:120px;
    justify-content:center;
}
 .btn-top-schools i{
    color:#facc15;
}
 .btn-mobile-filter i{
    color:#38bdf8;
}
 #mobileFilterBtn{
    display:inline-flex !important;
}
 .mf-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.35);
    opacity:0;
    pointer-events:none;
    transition:.2s;
    z-index:9998;
}
 .mf-overlay.open{
    opacity:1;
    pointer-events:auto;
}
 .mf-drawer{
    position:fixed;
    top:0;
    left:0;
    height:100dvh;
    width:82vw;
    max-width:420px;
    background:#fff;
    box-shadow:0 0 40px rgba(0,0,0,.2);
    transform:translateX(-100%);
    transition:.25s;
    z-index:9999;
    display:flex;
    flex-direction:column;
}
 .mf-drawer.open{
    transform:translateX(0);
}
 .mf-head{
    padding:14px 16px;
    border-bottom:1px solid #eee;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
 .mf-close{
    border:0;
    background:#ef4444;
    color:#fff;
    font-size:16px;
    border-radius:8px;
    padding:6px 10px;
    cursor:pointer;
}
 .mf-body{
    padding:12px 16px;
    overflow:auto;
    gap:16px;
    display:flex;
    flex-direction:column;
}
 .mf-section{
    border:1px solid #eee;
    border-radius:12px;
    padding:12px;
}
/* ========== STATUS / LOADING ========== */
 .loading-spinner{
    width:20px;
    height:20px;
    border:3px solid rgba(0,0,0,.08);
    border-top:3px solid var(--primary-700);
    border-radius:50%;
    animation:spin 1s linear infinite;
}
 @keyframes spin{
    to{
        transform:rotate(360deg);
    }
}
/* ========== MISC / FIXES ========== */
 .copy-status{
    position:fixed;
    bottom:80px;
    left:50%;
    transform:translateX(-50%);
    background:#111;
    color:#0f0;
    font-weight:800;
    padding:6px 12px;
    border-radius:8px;
    opacity:0;
    transition:opacity .3s ease;
    z-index:10000;
}
 .error-message{
    color:var(--danger-600);
    font-size:.9em;
    margin-top:4px;
}
 .shake{
    animation:shake .28s;
}
 @keyframes shake{
    0%,100%{
        transform:translateX(0);
    }
    25%{
        transform:translateX(-4px);
    }
    50%{
        transform:translateX(4px);
    }
    75%{
        transform:translateX(-3px);
    }
}
/* Hide breadcrumb if not needed */
 nav[aria-label="breadcrumb"]{
    display:none;
}
/* Credits */
 footer{
    padding:16px 0;
    text-align:center;
}
/* ========== BASE / TYPOGRAPHY / ACCESSIBILITY ========== */
 *,*::before,*::after{
    box-sizing:border-box;
}
 html{
    -webkit-tap-highlight-color:transparent;
    scroll-behavior:smooth;
}
 html,body{
    width:100%;
    overflow-x:hidden;
}
 body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
    background:var(--bg);
    color:var(--text);
    display:flex;
    flex-direction:column;
    align-items:center;
}
 .container{
    width:100%;
    max-width:var(--container);
    margin:0 auto;
    padding:0 16px;
}
 main{
    width:100%;
    padding:2rem 0 2.5rem;
}
 h1{
    font-size:clamp(2rem, 2vw + 1.5rem, 3rem);
    line-height:1.15;
    margin:0 0 6px;
    color:var(--text-inverse);
    font-weight:900;
}
 h2{
    font-size:clamp(1rem, 0.8vw + 0.9rem, 1.25rem);
    color:#e2e8f0;
    margin:.25rem 0 0;
    font-weight:700;
}
 h3{
    font-size:1.15rem;
    color:var(--text);
    font-weight:800;
    margin:.5rem 0;
}
 p{
    font-size:1rem;
    color:var(--text);
    margin:.75rem 0 1rem;
}
 a{
    color:var(--primary);
    text-decoration:none;
}
 a:hover{
    text-decoration:underline;
}
 :focus-visible{
    outline:none;
    box-shadow:var(--focus-ring);
    border-radius:6px;
}
 .app-nav{
    width:100%;
    background:#fff;
    box-shadow:var(--shadow);
    position:sticky;
    top:0;
    z-index:1000;
}
 .app-nav .nav-inner{
    max-width:var(--container);
    margin:0 auto;
    padding:10px 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
 .app-nav .brand{
    font-weight:900;
    color:#111;
    display:flex;
    align-items:center;
    gap:10px;
    font-size:1.05rem;
    text-decoration:none;
}
 .app-nav .nav-toggle{
    display:none;
    background:transparent;
    border:0;
    font-size:1.5rem;
}
 .app-nav .nav-links{
    display:flex;
    gap:14px;
    align-items:center;
    list-style:none;
    margin:0;
    padding:0;
}
 .app-nav .nav-links a,.app-nav .nav-links .linklike{
    text-decoration:none;
    background:transparent;
    border:0;
    color:#111;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
}
 .app-nav .nav-links a:hover,.app-nav .nav-links .linklike:hover{
    background:#f3f4f6;
}
 .app-nav .nav-links .divider{
    height:18px;
    width:1px;
    background:#e5e7eb;
}
 .theme-switch{
    display:flex;
    align-items:center;
    gap:8px;
}
 .theme-switch .slider{
    width:36px;
    height:20px;
    background:#e5e7eb;
    border-radius:999px;
    position:relative;
    display:inline-block;
    vertical-align:middle;
}
 .theme-switch input{
    display:none;
}
 .theme-switch .slider::after{
    content:'';
    position:absolute;
    width:16px;
    height:16px;
    background:#fff;
    border-radius:50%;
    top:2px;
    left:2px;
    transition:.2s;
    box-shadow:0 1px 4px rgba(0,0,0,.15);
}
 .theme-switch input:checked+.slider::after{
    left:18px;
}
 .theme-switch .label{
    font-weight:700;
    font-size:.9rem;
    color:#111;
}
 @media (max-width:860px){
    .app-nav .nav-toggle{
        display:block;
        background-color:#2787cf;
    }
    .app-nav .nav-links{
        position:absolute;
        top:58px;
        left:0;
        right:0;
        background:#fff;
        box-shadow:var(--shadow);
        display:none;
        flex-direction:column;
        padding:12px;
    }
    .app-nav .nav-links.open{
        display:flex;
    }
    .app-nav .nav-links li{
        width:100%;
    }
}
 .hero{
    width:100%;
    background:radial-gradient(1200px 600px at 20% -10%, #60a5fa22, transparent),linear-gradient(135deg, #1e3a8a, #2563eb, #0ea5e9);
    color:#fff;
    padding:32px 16px 28px;
    box-shadow:var(--shadow);
}
 .hero-inner{
    max-width:var(--container);
    margin:0 auto;
    text-align:center;
}
 .hero-badge{
    display:inline-block;
    padding:6px 10px;
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.25);
    border-radius:999px;
    font-weight:800;
    margin-bottom:8px;
}
 .hero h1{
    margin:6px 0 8px;
    font-size:clamp(1.8rem, 2.6vw, 2.8rem);
    font-weight:900;
    color:#fff;
}
 .hero p{
    color:#eef2ff;
    font-weight:600;
    max-width:760px;
    margin:0 auto;
}
 .hero-actions{
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:center;
    margin-top:12px;
    flex-wrap:wrap;
}
 .btn-secondary{
    background:#ffffff;
    color:#111;
    border:1px solid #e5e7eb;
}
 .btn-secondary:hover{
    background:#f3f4f6;
}
 body.dark-mode .hero{
    background:radial-gradient(1200px 600px at 20% -10%, #60a5fa11, transparent),#0f172a;
}
 .search-container{
    position:relative;
}
 .suggest-box{
    position:absolute;
    z-index:50;
    top:62px;
    left:50%;
    transform:translateX(-50%);
    width:90%;
    max-height:240px;
    overflow:auto;
    background:#fff;
    border:1px solid var(--border-strong);
    border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,.12);
    display:none;
}
 .suggest-item{
    padding:10px 12px;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:8px;
    font-weight:700;
}
 .suggest-item small{
    color:#6b7280;
    font-weight:600;
}
 .suggest-item:hover{
    background:#f3f4f6;
}
 .suggest-empty{
    padding:10px 12px;
    color:#6b7280;
    font-weight:700;
}
 body.dark-mode .suggest-box{
    background:#0f172a;
    border-color:var(--border-strong);
}
 body.dark-mode .suggest-item:hover{
    background:#111827;
}
/* Use system form controls in dark */
 body.dark-mode{
    color-scheme:dark;
    --bg:#0b1220;
    --surface:#0f172a;
    --surface-muted:#111827;
    --text:#e5e7eb;
    --text-muted:#94a3b8;
    --border:#1f2937;
    --border-strong:#334155;
    --shadow-soft:0 2px 10px rgba(0,0,0,0.35);
    --shadow:0 6px 24px rgba(0,0,0,0.45);
}
 body.dark-mode body,body.dark-mode main{
    background:var(--bg);
    color:var(--text);
}
 body.dark-mode header,body.dark-mode footer{
    border-color:#1f2937;
}
 body.dark-mode a{
    color:#93c5fd;
}
 body.dark-mode a:hover{
    color:#bfdbfe;
}
 body.dark-mode input[type="text"],body.dark-mode input[type="email"],body.dark-mode select,body.dark-mode textarea,body.dark-mode .search-input,body.dark-mode input#InstituationDropdown[list]{
    background:#0b1220;
    color:var(--text);
    border:1px solid var(--border-strong);
}
body.dark-mode .search-input,body.dark-mode input#InstituationDropdown[list]{
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='8'/><line x1='21' y1='21' x2='16.65' y2='16.65'/></svg>");
    background-repeat: no-repeat;
    background-position: 10px center;
    background-size: 16px 16px;
}
 body.dark-mode button{
    background:#1f2937;
    color:#e5e7eb;
    border:1px solid #2b3544;
}
 body.dark-mode button:hover{
    background:#243043;
}
 body.dark-mode .btn-primary{
    background:#2563eb;
    border-color:#1e40af;
    color:#fff;
}
 body.dark-mode .btn-primary:hover{
    background:#1e40af;
}
 body.dark-mode .btn-secondary{
    background:#111827;
    color:#e5e7eb;
    border:1px solid #2b3544;
}
 body.dark-mode .btn-secondary:hover{
    background:#1f2937;
}
 body.dark-mode table{
    color:var(--text);
}
 body.dark-mode th{
    background:#1f2937;
    color:#e5e7eb;
    border-color:#303a49;
}
 body.dark-mode td{
    border-color:#2a3342;
}
 body.dark-mode table tbody tr:nth-child(odd){
    background:#0f172a;
}
 body.dark-mode table tbody tr:nth-child(even){
    background:#0b1220;
}
 body.dark-mode .pagination button{
    background:#111827;
    border:1px solid #2b3544;
    color:#e5e7eb;
}
 body.dark-mode .pagination button:hover{
    background:#1f2937;
}
 body.dark-mode .popup-content{
    background:#0f172a;
    color:var(--text);
    border-color:var(--border-strong);
    box-shadow:0 24px 80px rgba(0,0,0,.55);
}
 body.dark-mode .popup-content .close-btn{
    background:#0f172a;
    color:#fca5a5;
    border-color:var(--border-strong);
}
 body.dark-mode .popup-content .close-btn:hover{
    background:#dc2626;
    color:#fff;
}
 body.dark-mode .progress-bar-container{
    background:#0b1220;
    border-color:var(--border-strong);
}
 body.dark-mode .progress-bar{
    color:#fff;
}
 body.dark-mode .suggest-box{
    background:#0f172a;
    border-color:var(--border-strong);
    box-shadow:0 10px 30px rgba(0,0,0,.5);
}
 body.dark-mode .suggest-item{
    color:#e5e7eb;
}
 body.dark-mode .suggest-item small{
    color:#94a3b8;
}
 body.dark-mode .suggest-item:hover{
    background:#0b1220;
}
 body.dark-mode .app-nav{
    background:#0f172a;
    box-shadow:0 2px 20px rgba(0,0,0,.45);
}
 body.dark-mode .app-nav .nav-links a,body.dark-mode .app-nav .nav-links .linklike,body.dark-mode .app-nav .brand{
    color:#e5e7eb;
}
 body.dark-mode .app-nav .nav-links a:hover,body.dark-mode .app-nav .nav-links .linklike:hover{
    background:#111827;
}
 body.dark-mode .app-nav .nav-links{
    background:#0f172a;
}
 body.dark-mode .theme-switch .slider{
    background:#1f2937;
}
 body.dark-mode .theme-switch .label{
    color:#e5e7eb;
}
 body.dark-mode .hero{
    background:radial-gradient(1200px 600px at 20% -10%, #60a5fa11, transparent),#0f172a;
}
 body.dark-mode .hero h1,body.dark-mode .hero p{
    color:#e5e7eb;
}
 body.dark-mode .info-banner{
    background:#1f2937;
    color:#e5e7eb;
    border-left-color:#f59e0b;
    box-shadow:0 2px 10px rgba(0,0,0,.35);
}
 body.dark-mode #tableHint{
    background:#0b1220;
    color:#cbd5e1;
    border-left-color:#2563eb;
}
 body.dark-mode .featured-box,body.dark-mode #featuredBox{
    box-shadow:0 16px 40px rgba(0,0,0,.55);
}
 body.dark-mode .new-ribbon{
    box-shadow:0 0 12px rgba(255,0,85,.45);
}
 body.dark-mode .mf-overlay{
    background:rgba(0,0,0,.55);
}
 body.dark-mode .mf-drawer{
    background:#0f172a;
    color:#e5e7eb;
}
 body.dark-mode .mf-head{
    border-color:#1f2937;
}
 body.dark-mode .mf-section{
    border:1px solid #1f2937;
}
 body.dark-mode .mf-range input[type=number]{
    background:#0b1220;
    border:1px solid #2b3544;
    color:#e5e7eb;
}
 body.dark-mode .mf-track{
    background:#1f2937;
}
 body.dark-mode .mf-track-fill{
    background:#2563eb;
}
 body.dark-mode .mf-dual input[type=range]::-webkit-slider-thumb{
    background:#2563eb;
    border-color:#0f172a;
}
 body.dark-mode .mf-search input{
    background:#0b1220;
    border:1px solid #2b3544;
    color:#e5e7eb;
}
 body.dark-mode .mf-apply{
    background:#2563eb;
}
 body.dark-mode .mf-reset{
    background:#111827;
    color:#e5e7eb;
    border-color:#2b3544;
}
 body.dark-mode #dataLoaderOverlay{
    background:rgba(0,0,0,0.65);
}
 body.dark-mode #dataLoaderOverlay .loader-box{
    background:#0f172a;
    color:#e5e7eb;
    border:1px solid #334155;
    box-shadow:0 18px 60px rgba(0,0,0,.6);
}
 body.dark-mode .compare-table{
    box-shadow:0 0 10px rgba(0,0,0,.4);
}
 body.dark-mode .compare-table th{
    background:#1f2937;
}
 body.dark-mode #scrollToTopBtn{
    background:#111827;
}
 body.dark-mode .year-dropdown select{
    background:#0b1220;
    color:#e5e7eb;
    border:1px solid #2b3544;
}
 body.dark-mode .group-buttons button{
    background:#1f2937;
}
 body.dark-mode .group-buttons button:hover{
    background:#243043;
}
 body.dark-mode nav[aria-label="breadcrumb"]{
    display:none !important;
}
 body.dark-mode ::selection{
    background:#1e40af;
    color:#fff;
}
 body.dark-mode :focus-visible{
    box-shadow:0 0 0 3px rgba(59,130,246,0.35);
}
 body.dark-mode{
    scrollbar-color:#334155 #0b1220;
}
 body.dark-mode::-webkit-scrollbar{
    width:10px;
    height:10px;
}
 body.dark-mode::-webkit-scrollbar-track{
    background:#0b1220;
}
 body.dark-mode::-webkit-scrollbar-thumb{
    background:#334155;
    border-radius:10px;
}
 body.dark-mode::-webkit-scrollbar-thumb:hover{
    background:#3f4c61;
}
/* === Dark Mode Finishing Pack (paste at end) === */
/* 1) SEO blurb area ‚Äî dark background + light text */
 body.dark-mode #seo-blurb{
    background:linear-gradient(135deg, #0d1424, #0b1220);
}
 body.dark-mode #seo-blurb h2,body.dark-mode #seo-blurb h3,body.dark-mode #seo-blurb p,body.dark-mode #seo-blurb strong,body.dark-mode #seo-blurb em,body.dark-mode #seo-blurb ul,body.dark-mode #seo-blurb li{
    color:#e5e7eb;
}
 body.dark-mode #seo-blurb li::before{
    color:#93c5fd;
}
 @keyframes colorShiftDark{
    0%{
        background-color:#0f172a;
    }
    25%{
        background-color:#121a2a;
    }
    50%{
        background-color:#0b1323;
    }
    75%{
        background-color:#111827;
    }
    100%{
        background-color:#0f172a;
    }
}
 body.dark-mode table{
    color:#e5e7eb;
}
 body.dark-mode th,body.dark-mode td{
    border-color:#243043;
}
 body.dark-mode th{
    background:#1f2937;
    color:#e5e7eb;
}
 body.dark-mode table tbody tr:nth-child(odd),body.dark-mode table tbody tr:nth-child(even){
    background-color:transparent !important;
}
 body.dark-mode table tbody tr{
    animation:colorShiftDark 10s infinite alternate;
    color:#e5e7eb;
}
 body.dark-mode .mf-foot{
    background:#0f172a;
    border-top:1px solid #1f2937;
}
 body.dark-mode .mf-apply{
    background:#2563eb;
    color:#fff;
    border:0;
}
 body.dark-mode .mf-reset{
    background:#111827;
    color:#e5e7eb;
    border:1px solid #2b3544;
}
 body.dark-mode .popup-header{
    background:linear-gradient(135deg, #0b1220, #111827) !important;
    color:#e5e7eb !important;
    border-bottom:1px solid #1f2937 !important;
}
 body.dark-mode .popup-body{
    color:#e5e7eb;
}
 body.dark-mode .popup-body label{
    color:#cbd5e1;
}
 body.dark-mode .popup-body>div[style="border-left:5px"]{
    background:#0b1220 !important;
    color:#e5e7eb !important;
    border-left-color:#2563eb !important;
}
 body.dark-mode #proof>div>div{
    background:#0f172a !important;
    border:1px solid #334155 !important;
    color:#e5e7eb !important;
    box-shadow:0 12px 30px rgba(0,0,0,0.45) !important;
}
 .popup-footer{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:12px;
}
 .footer-btn{
    background:#ffffff !important;
    border:1px solid #e5e7eb !important;
    color:#111 !important;
    width:44px;
    height:44px;
    border-radius:50%;
    display:grid;
    place-items:center;
    padding:0;
    line-height:1;
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
}
 .footer-btn i{
    display:block;
    line-height:1;
    font-size:1.1rem;
}
 body.dark-mode .footer-btn{
    border-color:#334155 !important;
    background:#ffffff !important;
    color:#111 !important;
}
 @media (max-width:860px){
    .nav-overlay{
        position:fixed;
        inset:0;
        background:rgba(0,0,0,.45);
        opacity:0;
        pointer-events:none;
        transition:.2s;
        z-index:1000;
    }
    .nav-overlay.open{
        opacity:1;
        pointer-events:auto;
    }
    .app-nav .nav-links{
        position:fixed;
        left:0;
        right:0;
        top:0;
        height:68vh;
        margin-top:58px;
        background:var(--surface);
        border-top-left-radius:16px;
        border-top-right-radius:16px;
        box-shadow:0 18px 48px rgba(0,0,0,.35);
        display:flex;
        flex-direction:column;
        gap:8px;
        padding:22px 16px 14px;
        transform:translateY(-110%);
        transition:transform .25s ease;
        z-index:1001;
    }
    .app-nav .nav-links.open{
        transform:translateY(0);
    }
    .app-nav .nav-links::before{
        content:'';
        position:absolute;
        top:8px;
        left:50%;
        width:48px;
        height:4px;
        border-radius:999px;
        background:var(--border-strong);
        transform:translateX(-50%);
        opacity:.75;
    }
    .app-nav .nav-links li{
        width:100%;
    }
    .app-nav .nav-links a,.app-nav .nav-links .linklike{
        display:flex;
        align-items:center;
        gap:10px;
        padding:12px 14px;
        font-size:1.05rem;
        font-weight:700;
        background:var(--surface-muted);
        border:1px solid var(--border);
        border-radius:12px;
        color:var(--text);
    }
    .app-nav .nav-links a:hover,.app-nav .nav-links .linklike:hover{
        background:#e5e7eb33;
    }
    body.dark-mode .app-nav .nav-links{
        background:#0f172a;
    }
    body.dark-mode .app-nav .nav-links a,body.dark-mode .app-nav .nav-links .linklike{
        background:#0b1220;
        border-color:#1f2937;
        color:#e5e7eb;
    }
    body.dark-mode .nav-overlay{
        background:rgba(0,0,0,.6);
    }
}
/* PC only */
 @media (min-width: 770px) {
     .featured-box {
         display: inline-block;
         margin: 10px;
         vertical-align: top;
         text-align: center;
        /* center text inside each box */
         padding-top: 70px;
    }
}
/* === Ban overlay (not closable) === */
 #banOverlay {
     position: fixed;
     inset: 0;
     z-index: 999999;
     background: rgba(0,0,0,.85);
     display: none;
     align-items: center;
     justify-content: center;
}
 #banOverlay .ban-card {
     width: min(92vw, 520px);
     background: #fff;
     color: #111;
     border: 2px solid #e5e7eb;
     border-radius: 16px;
     box-shadow: 0 24px 80px rgba(0,0,0,.5);
     padding: 18px;
     text-align: center;
}
 #banOverlay .ban-logo {
     width:48px;
     height:48px;
     object-fit:contain;
     margin-bottom:6px;
}
 body.ban-locked {
     overflow: hidden !important;
}
 body.dark-mode #banOverlay .ban-card {
     background:#0f172a;
     color:#e5e7eb;
     border-color:#334155;
}
/* === Announcement banner === */
 .ann-banner {
     display:none;
     margin: 10px auto;
     max-width: var(--container);
     border-left: 6px solid;
     border-radius: 10px;
     padding: 10px 12px;
     box-shadow: var(--shadow-soft);
}
 .ann-banner .ann-inner {
     display:flex;
     align-items:center;
     justify-content:space-between;
     gap:10px;
     flex-wrap:wrap;
}
 .ann-banner .ann-text {
     font-weight: 800;
}
 .ann-banner .ann-btn {
     padding: 8px 12px;
     border-radius: 8px;
     font-weight: 800;
     text-decoration: none;
     border: 1px solid #e5e7eb;
     background: #fff;
     color: #111;
}
 .ann-banner.type-info {
     background:#e0f2fe;
     color:#0c4a6e;
     border-left-color:#38bdf8;
}
 .ann-banner.type-warning {
     background:#fff7d6;
     color:#3b2f00;
     border-left-color:#f59e0b;
}
 .ann-banner.type-success {
     background:#dcfce7;
     color:#064e3b;
     border-left-color:#22c55e;
}
 .ann-banner.type-danger {
     background:#fee2e2;
     color:#7f1d1d;
     border-left-color:#ef4444;
}
 body.dark-mode .ann-banner.type-info {
     background:#0b1220;
     color:#93c5fd;
     border-left-color:#38bdf8;
}
 body.dark-mode .ann-banner.type-warning {
     background:#1f2937;
     color:#fde68a;
     border-left-color:#f59e0b;
}
 body.dark-mode .ann-banner.type-success {
     background:#052e26;
     color:#86efac;
     border-left-color:#22c55e;
}
 body.dark-mode .ann-banner.type-danger {
     background:#2b1111;
     color:#fecaca;
     border-left-color:#ef4444;
}
 body.dark-mode .ann-banner .ann-btn {
     background:#0b1220;
     color:#e5e7eb;
     border-color:#334155;
}
/* === HERO PRO (override safely) === */
 .hero.hero-pro{
     position:relative;
     overflow:hidden;
     padding:42px 16px 34px;
     color:#fff;
     background: radial-gradient(1200px 600px at 15% -10%, #60a5fa22, transparent), linear-gradient(135deg, #0b1e63, #1e3a8a 40%, #2563eb 70%, #0ea5e9);
     box-shadow:var(--shadow);
}
 .hero.hero-pro .hero-inner{
    max-width:var(--container);
    margin:0 auto;
}
 .hero.hero-pro .hero-grid{
     display:grid;
     gap:22px;
     grid-template-columns:1fr;
}
 @media(min-width:900px){
     .hero.hero-pro .hero-grid{
         grid-template-columns:1.2fr .8fr;
         align-items:center;
    }
}
 .hero.hero-pro .hero-eyebrow{
     display:inline-flex;
     align-items:center;
     gap:8px;
     font-weight:800;
     letter-spacing:.2px;
     padding:6px 10px;
     border:1px solid rgba(255,255,255,.25);
     border-radius:999px;
     background:rgba(255,255,255,.12);
     backdrop-filter:saturate(130%) blur(2px);
     margin-bottom:10px;
}
 .hero.hero-pro h1{
     margin:6px 0 8px;
     font-weight:900;
     font-size:clamp(1.9rem, 2.8vw, 2.8rem);
     line-height:1.12;
}
 .hero.hero-pro .grad{
     background:linear-gradient(90deg, #ffffff, #e2e8f0, #cfe2ff);
     -webkit-background-clip:text;
     background-clip:text;
     color:transparent;
     text-shadow:0 0 24px rgba(255,255,255,.18);
}
 .hero.hero-pro .hero-sub{
     color:#eef2ff;
     font-weight:700;
     max-width:680px;
     margin:6px 0 12px;
}
 .hero.hero-pro .hero-cta{
     display:flex;
     gap:10px;
     flex-wrap:wrap;
     align-items:center;
     margin-top:10px;
}
 .hero.hero-pro .hero-kpis{
     display:flex;
     gap:10px;
     flex-wrap:wrap;
     margin-top:16px;
}
 .hero.hero-pro .kpi{
     background:rgba(255,255,255,.12);
     border:1px solid rgba(255,255,255,.25);
     border-radius:12px;
     padding:10px 12px;
     min-width:120px;
     display:flex;
     flex-direction:column;
     gap:2px;
     backdrop-filter:saturate(130%) blur(3px);
}
 .hero.hero-pro .kpi i{
     font-size:1.2rem;
     opacity:.95;
}
 .hero.hero-pro .kpi span{
     font-weight:900;
}
 .hero.hero-pro .kpi small{
     color:#e5e7eb;
     font-weight:700;
}
 .hero.hero-pro .hero-right{
     display:flex;
     justify-content:center;
}
 .hero.hero-pro .glass-card{
     width:100%;
     max-width:420px;
     background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
     border:1px solid rgba(255,255,255,.35);
     border-radius:16px;
     padding:14px;
     box-shadow:0 24px 60px rgba(0,0,0,.25);
     backdrop-filter: blur(6px) saturate(120%);
}
 .hero.hero-pro .glass-card .card-head{
     font-weight:900;
     display:flex;
     gap:8px;
     align-items:center;
     padding-bottom:8px;
     border-bottom:1px dashed rgba(255,255,255,.35);
}
 .hero.hero-pro .glass-card .card-list{
     list-style:none;
     padding:10px 0 0;
     margin:0;
     display:grid;
     gap:8px;
}
 .hero.hero-pro .glass-card .card-list li{
     display:flex;
     gap:8px;
     align-items:center;
     font-weight:700;
     color:#f7fafc;
}
 .hero.hero-pro .glass-card .card-foot{
     display:flex;
     gap:8px;
     flex-wrap:wrap;
     margin-top:12px;
}
 .hero.hero-pro .glass-card .pill{
     padding:6px 10px;
     border-radius:999px;
     background:rgba(255,255,255,.16);
     border:1px solid rgba(255,255,255,.28);
     font-weight:800;
     display:inline-flex;
     align-items:center;
     gap:6px;
}
/* Floating background blobs + subtle grid */
 .hero.hero-pro .hero-bg{
     position:absolute;
     inset:0;
     overflow:hidden;
     pointer-events:none;
}
 .hero.hero-pro .blob{
     position:absolute;
     width:320px;
     height:320px;
     border-radius:50%;
     filter:blur(36px);
     opacity:.25;
     transform:translate3d(0,0,0);
     animation:floaty 12s ease-in-out infinite alternate;
}
 .hero.hero-pro .b1{
     background:#22d3ee;
     top:-60px;
     left:-60px;
}
 .hero.hero-pro .b2{
     background:#a78bfa;
     bottom:-80px;
     right:8%;
     animation-duration:14s;
}
 .hero.hero-pro .b3{
     background:#f59e0b;
     top:30%;
     right:-80px;
     animation-duration:16s;
}
 @keyframes floaty{
     0%{
         transform:translate3d(0,0,0) 
    }
     100%{
         transform:translate3d(12px,-18px,0) 
    }
}
 .hero.hero-pro .grid-lines{
     position:absolute;
     inset:-20%;
     background: linear-gradient(transparent 29px, rgba(255,255,255,.06) 30px) 0 0/ 100% 30px, linear-gradient(90deg, transparent 29px, rgba(255,255,255,.06) 30px) 0 0/ 30px 100%;
}
/* Dark mode refinements */
 body.dark-mode .hero.hero-pro{
     background: radial-gradient(1200px 600px at 15% -10%, #60a5fa11, transparent), linear-gradient(135deg, #0b1220, #0f172a 40%, #111827 90%);
}
 body.dark-mode .hero.hero-pro .grad{
     background:linear-gradient(90deg, #e5e7eb, #cbd5e1, #93c5fd);
}
 body.dark-mode .hero.hero-pro .hero-sub{
     color:#cbd5e1;
}
 body.dark-mode .hero.hero-pro .kpi small{
     color:#cbd5e1;
}
 body.dark-mode .hero.hero-pro .glass-card .card-list li{
     color:#e5e7eb;
}
/* GPA badges */
 .gpa-badge{
    padding:4px 8px;
    border-radius:999px;
    font-weight:900;
    color:#fff;
    display:inline-block;
    min-width:46px;
    text-align:center
}
 .gpa-a1{
    background:#16a34a
}
.gpa-a{
    background:#22c55e
}
.gpa-a-{
    background:#84cc16
}
.gpa-b{
    background:#f59e0b
}
.gpa-c{
    background:#f97316
}
.gpa-d{
    background:#ef4444
}
.gpa-f{
    background:#991b1b
}
/* Row hover clarity */
 table tbody tr:hover{
     outline:2px solid rgba(37,99,235,.25);
     background:#eef2ff !important;
}
/* ‚Äî‚Äî‚Äî Review boxes: Dark mode ‚Äî‚Äî‚Äî */
 body.dark-mode .review-box{
     background:#0f172a;
     border:2px solid #334155;
     border-radius:10px;
     box-shadow:0 10px 30px rgba(0,0,0,.45);
     color:#e5e7eb;
}
 body.dark-mode .review-box strong{
     color:#e5e7eb;
}
 body.dark-mode .review-comment{
     color:#cbd5e1;
}
 body.dark-mode .reply-box{
     background:#0b1220;
     border-left:4px solid #f59e0b;
     color:#e5e7eb;
}
 body.dark-mode .review-box input[type="text"], body.dark-mode #reviewName, body.dark-mode #reviewText{
     background:#0b1220;
     border:1px solid #334155;
     color:#e5e7eb;
}
 body.dark-mode .review-box button{
     background:#1f2937;
     color:#e5e7eb;
     border:1px solid #2b3544;
}
 body.dark-mode .review-box button:hover{
     background:#243043;
}
 body.dark-mode #starContainer span{
     color:#facc15;
}
 body.dark-mode #nameError, body.dark-mode #commentError, body.dark-mode #starError{
     color:#fca5a5;
     font-weight:800;
}
/* Dark mode ‚Äî uses your CSS variables so it just works */
 body.dark-mode .help-item{
     background: var(--surface);
     color: var(--text);
     border-color: var(--border-strong);
}
 body.dark-mode .help-chip{
     background: var(--surface);
     color: var(--text);
     border-color: var(--border-strong);
}
 body.dark-mode .help-note{
     color: var(--text-muted);
}
 #firstVisitHint{
    display:none!important
}
 table.busy{
    pointer-events:none;
    opacity:.7;
    transition:opacity .2s;
}
/* Admin eye toggle */
 .hide-eye {
     margin-left:6px;
     padding:2px 6px;
     font-size:12px;
     border:1px solid #e5e7eb;
     background:#f3f4f6;
     border-radius:6px;
     cursor:pointer;
     transition:transform 0.1s ease;
}
 .hide-eye:hover {
     transform:translateY(-1px);
}
/* Hidden result (admin-only blur) */
 .popup-content {
     position: relative;
}
 .popup-content.admin-blur {
     filter: blur(3px);
}
 .admin-hidebar {
     display: none;
     background: #111;
     color: #fff;
     border-radius: 8px;
     padding: 6px 10px;
     font-weight: 800;
}
 body.dark-mode .admin-hidebar {
     background: #0b1220;
     color: #e5e7eb;
}
/* === Poll popup UI === */
 .poll-box {
     padding-top: 16px;
}
 .poll-head {
     display:flex;
     align-items:center;
     gap:10px;
     margin-bottom:10px;
}
 .poll-emoji {
     font-size:1.6rem;
}
 .poll-title {
     font-weight:900;
     font-size:1.1rem;
}
 .poll-optgrid {
     display:grid;
     gap:10px;
     margin-top:8px;
}
 .poll-chip {
     display:flex;
     align-items:center;
     gap:10px;
     padding:10px 12px;
     border:1px solid var(--border-strong);
     border-radius:10px;
     cursor:pointer;
     transition:transform .12s ease, background .15s ease, border-color .15s ease;
     user-select:none;
}
 .poll-chip:hover {
     transform:translateY(-1px);
     background:#f8fafc;
}
 .poll-chip.active {
     border-color:#2563eb;
     background:#eef2ff;
}
 .poll-chip input {
     display:none;
}
 .poll-actions {
     display:flex;
     gap:8px;
     justify-content:center;
     margin-top:12px;
}
 .poll-stats {
     margin-top:12px;
}
 .poll-results {
     border:1px solid var(--border-strong);
     border-radius:10px;
     padding:10px;
}
 .poll-results-title {
     font-weight:900;
     margin-bottom:8px;
}
 .poll-row {
     display:grid;
     grid-template-columns: 1fr 1fr auto;
     align-items:center;
     gap:8px;
     margin:6px 0;
}
 .poll-row-text {
     font-weight:800;
}
 .poll-bar {
     height:12px;
     background:#e5e7eb;
     border-radius:999px;
     overflow:hidden;
}
 .poll-bar-fill {
     height:100%;
     background:linear-gradient(90deg, #2563eb, #38bdf8);
}
 .poll-pct {
     font-weight:900;
     min-width:44px;
     text-align:right;
}
 .poll-total {
     margin-top:8px;
     font-size:.9rem;
     color:#555;
}
 body.dark-mode .poll-chip {
     background:#0b1220;
     border-color:#2b3544;
}
 body.dark-mode .poll-chip:hover {
     background:#0f172a;
}
 body.dark-mode .poll-chip.active {
     background:#0f172a;
     border-color:#2563eb;
}
 body.dark-mode .poll-bar {
     background:#1f2937;
}
 body.dark-mode .poll-bar-fill {
     background:linear-gradient(90deg, #2563eb, #38bdf8);
}
 body.dark-mode .poll-results {
     border-color:#334155;
}
/* GPA shine when all subjects ‚â• 79.5% */
 .gpa-shine {
     font-weight: 900;
     color: #facc15;
    /* gold tone */
     text-shadow: 0 0 6px rgba(250, 204, 21, 0.8), 0 0 12px rgba(245, 158, 11, 0.7), 0 0 18px rgba(250, 204, 21, 0.5);
     animation: glowPulse 2s ease-in-out infinite alternate;
}
 body.dark-mode .gpa-shine {
     color: #fde68a;
    /* lighter gold for contrast */
     text-shadow: 0 0 8px rgba(253, 224, 71, 0.9), 0 0 16px rgba(245, 158, 11, 0.8), 0 0 24px rgba(250, 204, 21, 0.6);
}
/* smooth pulsing glow animation */
 @keyframes glowPulse {
     0% {
         text-shadow: 0 0 4px rgba(250, 204, 21, 0.5), 0 0 8px rgba(245, 158, 11, 0.4), 0 0 12px rgba(250, 204, 21, 0.3);
         transform: scale(1);
    }
     100% {
         text-shadow: 0 0 8px rgba(250, 204, 21, 0.9), 0 0 16px rgba(245, 158, 11, 0.8), 0 0 24px rgba(250, 204, 21, 0.6);
         transform: scale(1.05);
    }
}
 .admin-stats-box {
     max-width: 600px;
     margin: 30px auto;
     padding: 12px;
     border: 2px solid #333;
     background: #f8f8f8;
     color: #111;
}
/* Dark mode */
 body.dark-mode .admin-stats-box {
     background: #111;
     color: #eee;
     border-color: #444;
}
 .badge-admin {
     color: #fff;
     background: #d00;
     padding: 2px 6px;
     border-radius: 4px;
     font-size: 12px;
     margin-right: 5px;
}
 .reply-actions{
    display:inline-flex;
    gap:8px;
    align-items:center;
}
 .reply-like-btn,.reply-del-btn{
    padding:2px 8px;
    border-radius:6px;
    border:1px solid #e5e7eb;
    background:#fff;
    cursor:pointer;
    font-weight:800;
}
 .reply-like-btn:hover{
    background:#f3f4f6;
}
 .reply-del-btn{
    color:#b91c1c;
}
 .reply-del-btn:hover{
    background:#fee2e2;
}
 body.dark-mode .featured-box, body.dark-mode #featuredBox{
     background:var(--featured-bg-dark);
     color:var(--text);
}
 .badge-admin {
     color: #fff;
     background: #d00;
     padding: 2px 6px;
     border-radius: 4px;
     font-size: 12px;
     margin-right: 5px;
}
 .reply-actions{
    display:inline-flex;
    gap:8px;
    align-items:center;
}
 .reply-like-btn,.reply-del-btn{
    padding:2px 8px;
    border-radius:6px;
    border:1px solid #e5e7eb;
    background:#fff;
    cursor:pointer;
    font-weight:800;
}
 .reply-like-btn:hover{
    background:#f3f4f6;
}
 .reply-del-btn{
    color:#b91c1c;
}
 .reply-del-btn:hover{
    background:#fee2e2;
}
/* Dark mode fixes for removal request page */
 body.dark-mode .review-box {
     background: #0f172a;
     border-color: #334155;
     color: #e5e7eb;
}
 body.dark-mode .review-box strong {
     color: #f3f4f6;
}
/* Fix admin note background and text */
 body.dark-mode .review-box div[style*="background:#f3f4f6"] {
     background: #1f2937 !important;
     color: #e5e7eb !important;
}
/* Fix header text */
 body.dark-mode h1, body.dark-mode h2, body.dark-mode h3 {
     color: #e5e7eb !important;
}
/* Fix form labels */
 body.dark-mode label {
     color: #cbd5e1;
}
/* Fix select dropdowns and inputs */
 body.dark-mode select, body.dark-mode input[type="text"], body.dark-mode textarea {
     background: #0b1220;
     color: #e5e7eb;
     border: 1px solid #334155;
}
/* Fix table headers and cells */
 body.dark-mode #adminRequestsTable th {
     background: #1f2937;
     color: #e5e7eb;
}
 body.dark-mode #adminRequestsTable td {
     color: #cbd5e1;
     border-color: #334155;
}
/* Fix status display */
 body.dark-mode #statusDisplay {
     color: #e5e7eb;
}
 body.dark-mode #statusMessage {
     color: #94a3b8 !important;
}
/* Fix popup-content in dark mode */
 body.dark-mode .popup-content {
     background: #0f172a;
     border-color: #334155;
     color: #e5e7eb;
}
 body.dark-mode .popup-content h2 {
     color: #f3f4f6;
     border-bottom-color: #334155;
}
/* Accessibility contrast tweaks */
 .popup-content a, .review-box a {
     color: var(--primary);
     font-weight: 800;
}
 body.dark-mode .review-box a, body.dark-mode .popup-content a {
     color: #93c5fd;
}
 .suggest-item, .suggest-item small {
     color: #111;
}
 body.dark-mode .suggest-item, body.dark-mode .suggest-item small {
     color: #e5e7eb;
}
 .ann-banner .ann-btn {
     border-color:#cbd5e1;
}
 body.dark-mode .ann-banner .ann-btn {
     border-color:#334155;
}
 .help-note {
     color: var(--text);
}
 body.dark-mode .help-note {
     color: var(--text);
}
 .popup-content .progress-bar {
     color: #fff !important;
}
 .popup-content .progress-bar.yellow {
     color:#111 !important;
}
/* review page: dark-mode friendly boxes */
 .benefits-box {
     background: #f8fafc;
     border-radius: 12px;
     padding: 20px;
     margin: 20px 0;
}
 body.dark-mode .benefits-box {
     background: #0b1220;
     border: 1px solid #334155;
     color: #e5e7eb;
}
 .reviewing-as-badge {
     background: #e0f2fe;
     padding: 10px;
     border-radius: 8px;
     margin-bottom: 15px;
}
 body.dark-mode .reviewing-as-badge {
     background: #0b1220;
     border: 1px solid #334155;
     color: #e5e7eb;
}
 .reviewing-as-badge #reviewingAsName {
     color: #0284c7;
     font-weight: 900;
}
 body.dark-mode .reviewing-as-badge #reviewingAsName {
     color: #93c5fd;
}
@media (max-width: 860px) {
    .nav-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.45);
        opacity: 0;
        pointer-events: none;
        transition: .2s;
        z-index: 1000;
    }
    
    .nav-overlay.open {
        opacity: 1;
        pointer-events: auto;
    }
    
    .app-nav .nav-toggle {
        display: block;
        background: #2563eb;
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
    }
    
    .app-nav .nav-links {
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: auto;
        height: auto;
        max-height: 80vh;
        margin-top: 58px;
        background: var(--surface);
        border-radius: 0 0 16px 16px;
        box-shadow: 0 18px 48px rgba(0,0,0,.35);
        display: none !important; /* Hidden by default on mobile */
        flex-direction: column;
        gap: 8px;
        padding: 22px 16px 14px;
        transform: translateY(0);
        transition: transform .25s ease;
        z-index: 1001;
        overflow-y: auto;
    }
    
    .app-nav .nav-links.open {
        display: flex !important; /* Show when open */
        transform: translateY(0);
    }
    
    .app-nav .nav-links::before {
        content: '';
        position: absolute;
        top: 8px;
        left: 50%;
        width: 48px;
        height: 4px;
        border-radius: 999px;
        background: var(--border-strong);
        transform: translateX(-50%);
        opacity: .75;
    }
    
    .app-nav .nav-links li {
        width: 100%;
    }
    
    .app-nav .nav-links a,
    .app-nav .nav-links .linklike {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 14px;
        font-size: 1.05rem;
        font-weight: 700;
        background: var(--surface-muted);
        border: 1px solid var(--border);
        border-radius: 12px;
        color: var(--text);
        width: 100%;
        text-align: left;
    }
    
    .app-nav .nav-links a:hover,
    .app-nav .nav-links .linklike:hover {
        background: #e5e7eb33;
    }
    
    .app-nav .nav-links .divider {
        height: 1px;
        width: 100%;
        background: var(--border);
        margin: 8px 0;
    }
    
    body.dark-mode .app-nav .nav-links {
        background: #0f172a;
    }
    
    body.dark-mode .app-nav .nav-links a,
    body.dark-mode .app-nav .nav-links .linklike {
        background: #0b1220;
        border-color: #1f2937;
        color: #e5e7eb;
    }
    
    body.dark-mode .nav-overlay {
        background: rgba(0,0,0,.6);
    }
}
}

visitors.html {
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SSC & HSC Board Rank ‚Äî Chittagong Board (Unofficial)</title>
<meta name="description" content="View unofficial SSC & HSC rankings for Chattogram/Chittagong Board with marks list. Fast, easy, with GPA, total marks, and school comparisons.">
<meta name="keywords" content="SSC 2025, SSC Result 2025, Board Rank, Chittagong Board Rank, Bangladesh SSC Rank, SSC 2025 Rank, HSC 2024 Result, SSC 2024 Result, Board-wise Rank, CTG Board Result, GPA Rank Bangladesh">
<meta name="author" content="Hasnyne" />
<meta name="robots" content="index, follow" />
<meta name="google-site-verification" content="siNtiPjvsyElA07czENYNNvVQicPoBsDL_dU5cwSVQ0" />
<link rel="canonical" href="https://boradrankctg.github.io/rank/" />
<meta property="og:title" content="SSC & HSC Board Rank ‚Äî Chittagong Board (Unofficial)" />
<meta property="og:description" content="Unofficial SSC 2025 rankings for Chittagong Board and Bangladesh. Search by roll number, compare schools, view GPA, marks, and ranks easily." />
<meta property="og:url" content="https://boradrankctg.github.io/rank/" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://og-playground.vercel.app/api/og?title=BoardRankCTG&subtitle=SSC%20%26%20HSC%20Rankings%20%E2%80%94%20Chattogram%20Board" />
<meta name="twitter:card" content="summary_large_image" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="styles.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-f7n3GfUINp0dF2kIgwTQ5Q/NFOTdI1N3r2rOeGd8GvK7m9VB6g8lO6D8Dq/7Hc5VQsr6QyQGHTpM4RwFgq3GEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="icon" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/icons/trophy-line.svg" type="image/svg+xml" />
<link rel="manifest" href="/rank/manifest.json">
<link rel="apple-touch-icon" href="/rank/icons/icon-192.png">
<meta name="theme-color" content="#2563eb">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/rank/sitemap.xml">
<meta http-equiv="Content-Security-Policy-Report-Only" content="default-src 'self' https://boradrankctg.github.io; script-src 'self' https://www.gstatic.com https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app https://www.gstatic.com https://firebaseinstallations.googleapis.com https://firebasestorage.googleapis.com; worker-src 'self'; frame-ancestors 'self'; upgrade-insecure-requests">
</head>

<body>
<section class="hero hero-pro" aria-label="BoardRank Hero">
<div class="hero-bg">
<span class="blob b1"></span>
<span class="blob b2"></span>
<span class="blob b3"></span>
<span class="grid-lines"></span>
</div>
<div class="hero-inner">
<div class="hero-grid">
<div class="hero-left">
<div class="hero-eyebrow">
<i class="ri-shield-star-line"></i> Chattogram Board ‚Ä¢ Hasnyne
</div>
<h1>SSC & HSC Board Rankings</h1>
<p class="hero-sub">All SSC AND HSC students ranking since 2022</p>
</div>
</div>
</div>
</section>

<nav aria-label="breadcrumb">
<ul class="breadcrumb">
<li><a href="index.html">Home</a></li>
<li><a href="#" id="currentYear">Year</a></li>
<li id="currentGroup" style="display:none;"></li>
</ul>
</nav>

<nav class="app-nav" role="navigation">
<div class="nav-inner">
<a class="brand" href="index.html">üéì BoardRankCTG</a>
<button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
<i class="ri-menu-line"></i>
</button>
<ul class="nav-links" id="navLinks">
<li><a href="index.html"><i class="fas fa-house-chimney"></i> Home</a></li>
<li><a href="about.html"><i class="fas fa-user-tie"></i> About</a></li>
<li><a href="review.html"><i class="fas fa-star-half-stroke"></i> Reviews</a></li>
<li><a href="contactus.html"><i class="fas fa-envelope-open-text"></i> Contact</a></li>
<li><button id="helpBtn" class="linklike"><i class="fas fa-question-circle"></i> Help</button></li>
<li><button id="shareBtn" class="linklike"><i class="ri-share-line"></i> Share</button></li>
<li><a href="visitors.html" id="visitorsLink"><i class="fas fa-users"></i> Visitors</a></li>
<li class="divider"></li>
<li>
<label class="theme-switch">
<input type="checkbox" id="themeToggle" />
<span class="slider"></span>
<span class="label">Dark mode</span>
</label>
</li>
</ul>
</div>
<div class="nav-overlay" id="navOverlay"></div>
</nav>

<div id="customBanner" class="info-banner">‚ö†Ô∏è This is not an official rank. It's prepared based on publicly available data.</div>
<div id="annBanner" class="ann-banner type-info" style="display:none;">
<div class="ann-inner">
<div class="ann-text" id="annText"></div>
<a id="annBtn" class="ann-btn" href="#" target="_blank" rel="noopener" style="display:none;">Learn more</a>
</div>
</div>




  <!-- Visitors Table -->
  <main >
    <table>
      <thead>
        <tr>
          <th>No.</th>
          <th>Name</th>
          <th>Type</th>
          <th>Source</th>
          <th>Institution</th>
          <th>Experience</th>
          <th>Message</th>
          <th>Device</th>
          <th>Fingerprint</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="visitorsContainer"></tbody>
    </table>
  </main>



 
  <script type="module" src="scripts/admin.js"></script>
  <script src="scripts/1-core.js" defer></script>
  <script src="scripts/2-data-table.js" defer></script>
  <script src="scripts/3A-popups-core.js" defer></script>
  <script src="scripts/3B-popups-verify-share.js" defer></script>
  <script src="scripts/4-routing-data-ui.js" defer></script>
    <script src="scripts/admin-2.js"></script>
  




</body>
</html>

}

.vscode\settings.json {
{
    "liveServer.settings.port": 5502
}
}

scripts\1-core.js {
// 1-core.js ‚Äî Core globals, SEO helpers, JSON-LD, crypto/decode, utilities, loader, theme/nav
/* ===== Modal helpers (global) ===== */
window.showModal = function(opts) {
  const cfg = typeof opts === 'string'
    ? { title: 'Notice', message: String(opts) }
    : (opts || {});
  const title = cfg.title || 'Notice';
  const message = cfg.message || '';
  const buttons = Array.isArray(cfg.buttons) && cfg.buttons.length
    ? cfg.buttons
    : [{ text: 'OK', variant: 'primary', onClick: () => closePopup() }];

  const btnHtml = buttons.map((b, i) => `
    <button class="${b.variant === 'secondary' ? 'btn-secondary' : 'btn-primary'}"
            data-idx="${i}">
      ${b.text}
    </button>
  `).join('');

  openPopup(`
    <div class="popup-content">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <h2>${title}</h2>
      <p>${message}</p>
      <div class="popup-footer">
        ${btnHtml}
      </div>
    </div>
  `);

  // bind button callbacks on the most recently created popup
  const popupContents = document.querySelectorAll('.popup .popup-content');
  const lastPopup = popupContents[popupContents.length - 1];
  if (lastPopup) {
    lastPopup.querySelectorAll('.popup-footer button').forEach((btn) => {
      btn.addEventListener('click', () => {
        const idx = Number(btn.getAttribute('data-idx'));
        const b = buttons[idx];
        try { b.onClick && b.onClick(); } catch (e) {}
        if (!b || b.autoClose !== false) closePopup();
      });
    });
  }
};
// Always-available login gate helper (global)
window.requireLogin = function(message = 'Please log in to access this feature.', redirect = 'login.html') {
  showModal({
    title: 'Login required',
    message,
    buttons: [
      { text: 'Go to login', onClick: () => { window.location.href = redirect; } },
      { text: 'Cancel', variant: 'secondary' }
    ]
  });
};
// Promise-based confirm modal
window.confirmModal = function({ title='Confirm', message='Are you sure?', okText='Yes', cancelText='No' } = {}) {
  return new Promise((resolve) => {
    showModal({
      title, message,
      buttons: [
        { text: cancelText, variant: 'secondary', onClick: () => resolve(false) },
        { text: okText, variant: 'primary', onClick: () => resolve(true) }
      ]
    });
  });
};

// Auto-upgrade native alerts to modals
window.alert = function(msg) {
  // Require-login helper for gated features
window.requireLogin = function(message = 'Please log in to access this feature.', redirect = 'login.html') {
  showModal({
    title: 'Login required',
    message,
    buttons: [
      { text: 'Go to login', onClick: () => { window.location.href = redirect; } },
      { text: 'Cancel', variant: 'secondary' }
    ]
  });
};

  showModal({ title: 'Notice', message: String(msg), buttons:[{ text:'OK' }] });
};

// ===== Global DOM refs + admin helper =====
const contentDiv = document.getElementById('content');
function isAdmin(){
  return (localStorage.getItem('userEmail') || '').toLowerCase() === 'hasnyne2007@gmail.com';
}

const currentYear = document.getElementById('currentYear');
const currentGroup = document.getElementById('currentGroup');
const noDataMessage = document.getElementById('noDataMessage');
const yearDropdown = document.getElementById('yearDropdown');

// Logout function
async function doLogout() {
  const yes = await confirmModal({
    title: 'Sign out?',
    message: 'Do you really want to sign out?',
    okText: 'Sign out',
    cancelText: 'Cancel'
  });
  if (!yes) return;
  localStorage.clear();
  window.location.href = 'index.html';
}
window.doLogout = doLogout;

window.doLogout = doLogout;

window.doLogout = doLogout;
// ===== SEO/Share helpers =====
function upsertMeta(name, content) {
  let tag = document.querySelector(`meta[name="${name}"]`);
  if (!tag) { tag = document.createElement('meta'); tag.setAttribute('name', name); document.head.appendChild(tag); }
  tag.setAttribute('content', content);
}

function upsertProperty(property, content) {
  let tag = document.querySelector(`meta[property="${property}"]`);
  if (!tag) { tag = document.createElement('meta'); tag.setAttribute('property', property); document.head.appendChild(tag); }
  tag.setAttribute('content', content);
}

function setCanonical(url) {
  let link = document.querySelector('link[rel="canonical"]');
  if (!link) { link = document.createElement('link'); link.setAttribute('rel','canonical'); document.head.appendChild(link); }
  link.setAttribute('href', url);
}

function injectJSONLD(obj, id) {
  // remove previous block with same id
  if (id) document.querySelectorAll(`script[type="application/ld+json"][data-id="${id}"]`).forEach(n=>n.remove());
  const s = document.createElement('script');
  s.type = 'application/ld+json';
  if (id) s.setAttribute('data-id', id);
  s.text = JSON.stringify(obj);
  document.head.appendChild(s);
}


// ===== Dynamic SEO (Year+Group / School / Student) =====
function updateSEOForYearGroup(year, group) {
  const isHSC = String(year).includes('hsc');
  const yr = String(year).replace('hsc_', '');
  const exam = isHSC ? 'HSC' : 'SSC';

  const title = `SSC Result Ranking ${yr} ‚Äî ${exam === 'HSC' ? 'Chattogram Board (HSC archive)' : 'Chattogram Board'} ${group}`;
  const desc  = `See ${exam} ${yr} ${group} rankings for Chattogram Board ‚Äî GPA, total marks, top schools, and student comparisons. Fast and accurate.`;
  const url   = `${location.origin}${location.pathname}?year=${encodeURIComponent(year)}&group=${encodeURIComponent(group)}`;

  document.title = title;
  upsertMeta('description', desc);
  setCanonical(url);
  upsertProperty('og:title', title);
  upsertProperty('og:description', desc);
  upsertProperty('og:url', url);
  upsertProperty('og:type', 'website');
  upsertMeta('twitter:title', title);
  upsertMeta('twitter:description', desc);
}

function updateSEOForSchool(year, group, schoolName) {
  const yr = String(year).replace('hsc_', '');
  const exam = String(year).includes('hsc') ? 'HSC' : 'SSC';
  const title = `${schoolName} ‚Äî ${exam} ${yr} Ranking (Chattogram Board)`;
  const desc  = `Rank list for ${schoolName} ‚Äî ${exam} ${yr}, ${group}. View GPA, totals, and student positions from Chattogram Board.`;
  const url   = `${location.origin}${location.pathname}?year=${encodeURIComponent(year)}&group=${encodeURIComponent(group)}&school=${encodeURIComponent(schoolName)}`;

  document.title = title;
  upsertMeta('description', desc);
  setCanonical(url);
  upsertProperty('og:title', title);
  upsertProperty('og:description', desc);
  upsertProperty('og:url', url);
  upsertMeta('twitter:title', title);
  upsertMeta('twitter:description', desc);
}

function updateSEOForStudent(year, group, studentName, roll) {
  const yr = String(year).replace('hsc_', '');
  const exam = String(year).includes('hsc') ? 'HSC' : 'SSC';
  const title = `${studentName} ‚Äî ${exam} ${yr} Result (Chattogram Board) | Roll ${roll}`;
  const desc  = `Subject-wise marks, GPA, total and rank for ${studentName} (${exam} ${yr}, ${group}) ‚Äî Chattogram Board.`;
  const pagePath = location.pathname.includes('entity.html') ? location.pathname : '/rank/entity.html';
  const url   = `${location.origin}${pagePath}?year=${encodeURIComponent(year)}&group=${encodeURIComponent(group)}&roll=${encodeURIComponent(roll)}`;

  document.title = title;
  upsertMeta('description', desc);
  setCanonical(url);
  upsertProperty('og:title', title);
  upsertProperty('og:description', desc);
  upsertProperty('og:url', url);
  upsertMeta('twitter:title', title);
  upsertMeta('twitter:description', desc);

  injectJSONLD({
    "@context": "https://schema.org",
    "@type": "Person",
    "name": studentName,
    "identifier": `${exam}-${yr}-${roll}`,
    "affiliation": { "@type": "EducationalOrganization", "name": "Chattogram Education Board" }
  }, 'student');
}


// ===== JSON-LD: breadcrumbs + dataset =====
function injectBreadcrumbs(homeUrl, year, group, school) {
  const items = [
    { "@type":"ListItem", "position":1, "name":"Home", "item": homeUrl }
  ];
  if (year) items.push({ "@type":"ListItem", "position":2, "name": String(year).replace('hsc_','') });
  if (group) items.push({ "@type":"ListItem", "position":3, "name": group });
  if (school) items.push({ "@type":"ListItem", "position":4, "name": school });

  injectJSONLD({
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement": items
  }, 'breadcrumbs');
}

function injectDatasetForYearGroup(year, group) {
  const isHSC = String(year).includes('hsc');
  const yr = String(year).replace('hsc_','');
  const exam = isHSC ? 'HSC' : 'SSC';

  injectJSONLD({
    "@context": "https://schema.org",
    "@type": "Dataset",
    "name": `${exam} ${yr} ${group} Result Ranking ‚Äî Chattogram Board`,
    "description": `Unofficial ${exam} ${yr} ${group} rankings for Chattogram Board including GPA, totals, school names and positions.`,
    "creator": { "@type":"Organization", "name":"BoardRankCTG" },
    "distribution": [
      { "@type":"DataDownload", "encodingFormat":"text/tab-separated-values", "contentUrl": `${location.origin}${location.pathname.replace(/index\.html?$/,'')}data_${year}_${group.toLowerCase()}.txt` }
    ],
    "license": "https://creativecommons.org/licenses/by/4.0/"
  }, 'dataset');
}

function injectDatasetForSchool(year, group, schoolName) {
  const yr = String(year).replace('hsc_','');
  const exam = String(year).includes('hsc') ? 'HSC' : 'SSC';
  injectJSONLD({
    "@context": "https://schema.org",
    "@type": "Dataset",
    "name": `${schoolName} ‚Äî ${exam} ${yr} Ranking (Chattogram Board)`,
    "description": `Ranking table for ${schoolName} in ${exam} ${yr}, ${group} ‚Äî GPA, totals and positions.`,
    "creator": { "@type":"Organization", "name":"BoardRankCTG" }
  }, 'dataset');
}


// ===== Crypto helpers (XOR + base64 wrapper fetch) =====
function xorDecrypt(dataBytes, key) {
  const keyBytes = new TextEncoder().encode(key);
  return dataBytes.map((b, i) => b ^ keyBytes[i % keyBytes.length]);
}

async function fetchAndDecode(url, key) {
  const res = await fetch(url);
  const encodedText = await res.text();
  const decodedBase64 = atob(encodedText);
  const decodedBytes = new Uint8Array(decodedBase64.split("").map(c => c.charCodeAt(0)));
  const originalBytes = xorDecrypt(decodedBytes, key);
  return new TextDecoder().decode(originalBytes);
}


// ===== Utilities: debounce, popup, toast =====
function debounce(func, delay) {
  let debounceTimer;
  return function() {
    const context = this;
    const args = arguments;
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => func.apply(context, args), delay);
  };
}

function openPopup(contentHTML) {
  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.innerHTML = contentHTML;
  document.body.appendChild(popup);
  document.body.classList.add('locked');
  popup.classList.add('pop-in');
  history.pushState({ popupOpen: true }, '');
}
function closePopup() {
  // Close the top-most popup (last .popup in the DOM)
  const popups = document.querySelectorAll('.popup');
  const popup = popups[popups.length - 1];
  if (popup) {
    popup.classList.add('pop-out');
    setTimeout(() => {
      popup.remove();
      // Only unlock body if no other popups remain
      if (!document.querySelector('.popup')) {
        document.body.classList.remove('locked');
      }
    }, 500);
  }
}

function showToast(message) {
  const toast = document.createElement('div');
  toast.textContent = message;
  toast.style = `
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #222;
    color: #fff;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 6px;
    z-index: 9999;
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2500);
}


// ===== Loader overlay (global: window.showLoadingIndicator / window.hideLoadingIndicator) =====
(function(){
  const STYLE_ID = 'br-loader-styles';
  function ensureLoaderStyles() {
    if (document.getElementById(STYLE_ID)) return;
    const s = document.createElement('style');
    s.id = STYLE_ID;
    s.textContent = `
#dataLoaderOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 10050; display: flex; align-items: center; justify-content: center; }
#dataLoaderOverlay .loader-box { background: #fff; padding: 20px 28px; border-radius: 12px; max-width: 320px; width: 90%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
#dataLoaderOverlay .rings { width: 96px; height: 96px; margin: 0 auto; position: relative; }
#dataLoaderOverlay .ring { position: absolute; border-radius: 50%; border: 6px solid transparent; border-top-color: #1976d2; animation: spin 1s linear infinite; }
#dataLoaderOverlay .ring.r2 { width: 64px; height: 64px; top: 16px; left: 16px; border-top-color: #ff8f00; animation-duration: 1.4s; }
#dataLoaderOverlay .ring.r3 { width: 40px; height: 40px; top: 28px; left: 28px; border-top-color: #6a1b9a; animation-duration: 1.85s; }
@keyframes spin { to { transform: rotate(360deg); } }
#dataLoaderOverlay .percent { font-size: 22px; font-weight: bold; margin-top: 8px; }
#dataLoaderOverlay .subtext { font-size: 13px; color: #555; margin-top: 4px; }
#dataLoaderOverlay button { margin-top: 12px; padding: 6px 14px; border-radius: 6px; background: #1976d2; color: #fff; border: none; cursor: pointer; }
    `;
    document.head.appendChild(s);
  }

  window.showLoadingIndicator = function() {
    if (document.getElementById('dataLoaderOverlay')) return;
    ensureLoaderStyles();

    const overlay = document.createElement('div');
    overlay.id = 'dataLoaderOverlay';
    overlay.innerHTML = `
      <div class="loader-box">
        <div class="rings">
          <div class="ring r1" style="width:96px;height:96px;"></div>
          <div class="ring r2"></div>
          <div class="ring r3"></div>
        </div>
        <div id="brLoaderPercent" class="percent">1%</div>
        <div id="brLoaderSub" class="subtext">Preparing files‚Ä¶</div>
      </div>
    `;
    document.body.appendChild(overlay);

    const percentEl = document.getElementById('brLoaderPercent');
    const subEl = document.getElementById('brLoaderSub');

    // Super-fast fake progress to 99%
    window.__br_fakeP = 1;
    clearInterval(window.__br_fakeTimer);
    window.__br_fakeTimer = setInterval(() => {
      if (!document.getElementById('dataLoaderOverlay')) { clearInterval(window.__br_fakeTimer); return; }
      if (window.__br_fakeP < 99) {
        window.__br_fakeP += 1;
        percentEl.textContent = window.__br_fakeP + '%';
        if (window.__br_fakeP < 20) subEl.textContent = 'Connecting to server‚Ä¶';
        else if (window.__br_fakeP < 50) subEl.textContent = 'Downloading result files‚Ä¶';
        else if (window.__br_fakeP < 80) subEl.textContent = 'Processing student data‚Ä¶';
        else subEl.textContent = 'Almost done‚Ä¶';
      } else {
        clearInterval(window.__br_fakeTimer);
      }
    }, 8);

    // Streaming update hook (subtitle only)
    window.step = function(loaded, total) {
      if (!document.getElementById('dataLoaderOverlay')) return;
      if (!total || !loaded) return;
      const ratio = loaded / total;
      if (ratio < 0.2) subEl.textContent = 'Connecting to server‚Ä¶';
      else if (ratio < 0.5) subEl.textContent = 'Downloading result files‚Ä¶';
      else if (ratio < 0.8) subEl.textContent = 'Processing student data‚Ä¶';
      else subEl.textContent = 'Almost done‚Ä¶';
    };
  };

  window.hideLoadingIndicator = function(opts = {}) {
    const overlay = document.getElementById('dataLoaderOverlay');
    if (!overlay) return;

    const percentEl = document.getElementById('brLoaderPercent');
    const subEl = document.getElementById('brLoaderSub');

    clearInterval(window.__br_fakeTimer);

    const noData = opts.forceError === true ||
                   (typeof filteredData !== 'undefined' && Array.isArray(filteredData) && filteredData.length === 0);

    if (noData) {
      overlay.querySelector('.loader-box').innerHTML = `
        <h2 style="color:#fca5a5; margin:6px 0;">‚ùó Data NOT FOUND</h2>
        <p style="color:#e5e7eb; margin-bottom: 10px;">
          ${opts.errorMessage || 'This selected results are not yet available.'}
        </p>
        <button onclick="window.location.href='index.html'">Go Back</button>
      `;
      return; // keep overlay to show the error UI
    }

    if (percentEl) percentEl.textContent = '100%';
    if (subEl) subEl.textContent = 'Done';

    requestAnimationFrame(() => overlay.remove());
  };
})();


// ===== Theme + Nav toggles (just the functions; wire them elsewhere) =====
function initThemeToggle() {
  const saved = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  document.body.classList.toggle('dark-mode', saved === 'dark');
  const t = document.getElementById('themeToggle');
  if (t) {
    t.checked = saved === 'dark';
    t.addEventListener('change', () => {
      const isDark = t.checked;
      document.body.classList.toggle('dark-mode', isDark);
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
  }
}

function initNavToggle() {
  const btn = document.getElementById('navToggle');
  const links = document.getElementById('navLinks');
  const overlay = document.getElementById('navOverlay');
  if (!btn || !links) return;

  const openNav = () => {
    links.classList.add('open');
    overlay?.classList.add('open');
    btn.setAttribute('aria-expanded', 'true');
  };
  const closeNav = () => {
    links.classList.remove('open');
    overlay?.classList.remove('open');
    btn.setAttribute('aria-expanded', 'false');
  };
  const toggleNav = () => {
    if (links.classList.contains('open')) closeNav(); else openNav();
  };

  btn.addEventListener('click', toggleNav);
  overlay?.addEventListener('click', closeNav);

  links.querySelectorAll('a, .linklike, input[type="checkbox"]').forEach(el => {
    el.addEventListener('click', () => {
      if (el.matches('input[type="checkbox"]')) return;
      closeNav();
    });
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeNav();
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth > 860) closeNav();
  });
} 
}

scripts\2-data-table.js {
// 2-data-table.js ‚Äî Data parse/sort, table rendering, pagination, search/suggestions, school view

// ===== Dataset state =====
let allData = [];
let filteredData = [];
const studentsPerPage = 100;
let currentPage = 1;
const InstituationSet = new Set();
window.InstituationSet = InstituationSet;
window._br_clickListenerSet = window._br_clickListenerSet || new Set();


// ===== Parse, process, and sort =====
function processData(mainData, individualData) {
  const rows = (mainData || '').trim().split('\n').slice(1);
  const individualScores = parseIndividualData(individualData);

  allData = rows.map(row => {
    const [serial, name, roll, gpa, total, Instituation] = row.split('\t');
    const individual = individualScores[roll] || {};
    InstituationSet.add((Instituation || '').trim());
    return {
      serial: parseInt(serial),
      name,
      roll: parseInt(roll),
      gpa: parseFloat(gpa),
      total: parseInt(total),
      Instituation: (Instituation || '').trim(),
      ...individual
    };
  });

  // Clean + sort
  allData = allData.filter(student => !isNaN(student.gpa) && !isNaN(student.total));
  allData.sort(compareStudents);

  // Initialize view
  filteredData = [...allData];
  updateTableData();

  // Expose + notify
  try {
    window.allData = allData;
    window.filteredData = filteredData;
    document.dispatchEvent(new CustomEvent('rank:data-ready'));
  } catch(e){}
}

function parseIndividualData(data) {
  if (!data) return {};
  const meta = (window.__br_currentDatasetMeta || {});
  const rows = data.trim().split('\n');
  const scores = {};

  rows.forEach(row => {
    const cols = row.split('\t');
    const roll = (cols[0] || '').trim();

    const phy = parseInt(cols[6]);
    const chem = parseInt(cols[7]);
    const math = parseInt(cols[8]);

    // Detect exam type for totals (HSC rows are shorter)
    const isHSC = (String(meta.year || '').includes('hsc')) || (cols.length <= 8);

    // Subject totals map (by column index)
    let subjectIdxTotals;
    if (isHSC) {
      // HSC: roll + 7 subjects => [1..7]
      // 200: Bangla, English, Physics, Chemistry, Compulsory, Optional
      // 100: ICT
      subjectIdxTotals = [
        [1,200],[2,200],[3,100],[4,200],[5,200],[6,200],[7,200]
      ];
    } else {
      // SSC: roll + 12 subjects => [1..12]
      // 200: Bangla, English
      // 100: Math, BGS, Religion, Physics, Chemistry, Compulsory, Optional, Physical
      // 50:  ICT, Career
      subjectIdxTotals = [
        [1,200],[2,200],[3,100],[4,100],[5,100],[6,100],
        [7,100],[8,100],[9,50],[10,100],[11,100],[12,50]
      ];
    }

    const allAPlus = subjectIdxTotals.every(([idx, total]) => {
      const m = parseFloat(cols[idx]);
      if (isNaN(m)) return false;
      const pct = (m / total) * 100;
      return pct >= 79.5;
    });

    scores[roll] = {
      phy: isNaN(phy) ? undefined : phy,
      chem: isNaN(chem) ? undefined : chem,
      math: isNaN(math) ? undefined : math,
      allAPlus
    };
  });

  return scores;
}

function compareStudents(a, b) {
  if (a.gpa !== b.gpa) return b.gpa - a.gpa;
  if (a.total !== b.total) return b.total - a.total;
  if (a.phy !== b.phy) return b.phy - a.phy;
  if (a.chem !== b.chem) return b.chem - a.chem;
  return b.math - a.math;
}


// ===== School view =====
function scrollToTop() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}

function showSchoolRanking(encodedSchoolName) {
  scrollToTop();
  const schoolName = (()=>{ try{return decodeURIComponent(encodedSchoolName);}catch(e){return encodedSchoolName;} })();

  try {
    const params = new URLSearchParams(window.location.search);
    const y = params.get('year') || (document.getElementById('currentYear')?.textContent || '').trim();
    const examType = (y && y.includes('hsc')) ? 'HSC' : 'SSC';
    const formattedYear = (y || '').replace('hsc_', '');
    document.title = `${schoolName} | ${formattedYear} ${examType}`;

    const yr = params.get('year');
    const grp = params.get('group');
    updateSEOForSchool(yr, grp, schoolName);
    injectDatasetForSchool(yr, grp, schoolName);
    injectBreadcrumbs(`${location.origin}${location.pathname}`, yr, grp, schoolName);
  } catch (e) { /* no-op */ }

  try {
    const params = new URLSearchParams(window.location.search);
    params.set('school', schoolName);
    history.pushState({}, '', `${location.pathname}?${params.toString()}`);
  } catch (e) {
    console.error('Error updating URL for school:', e);
  }

  const schoolData = allData
    .filter(student => (student.Instituation || '').trim().toLowerCase() === schoolName.trim().toLowerCase())
    .filter(student => isAdmin() || !((window.__br_hiddenRolls || new Set()).has(String(student.roll))));
  schoolData.sort(compareStudents);

  if (schoolData.length === 0) {
    contentDiv.innerHTML = `<h2>No data found for "${schoolName}"</h2>`;
  } else {
    contentDiv.innerHTML = `
      <h2>Showing rank of "${schoolName}"</h2>
      <button onclick="resetSchoolRanking()">Back</button>

      <table>
        <thead>
          <tr>
            <th>Serial</th>
            <th>Name</th>
            <th>Roll</th>
            <th>GPA</th>
            <th>Total</th>
            <th>Institution</th>
          </tr>
        </thead>
        <tbody>
          ${schoolData.map((student, index) => `
            <tr>
              <td>${index + 1}</td>

              <td class="student-name" onclick="
                (function(){
                  if (window.incrementClickCount) incrementClickCount(${student.roll});
                  showIndividualResultWithCheck(${student.roll}, '${currentYear.textContent.split(' ')[1]}', '${currentGroup.textContent.split(' ')[0]}');
                })()
              ">${student.name}</td>

              <td class="student-roll" onclick="
                (function(){
                  if (window.incrementClickCount) incrementClickCount(${student.roll});
                  showIndividualResultWithCheck(${student.roll}, '${currentYear.textContent.split(' ')[1]}', '${currentGroup.textContent.split(' ')[0]}');
                })()
              ">${student.roll}</td>

              <td><span class="${student.allAPlus ? 'gpa-shine' : ''}" title="${student.allAPlus ? 'All subjects ‚â• 79.5%' : ''}">${student.gpa}</span></td>
              <td>${student.total}</td>
              <td class="student-school">${student.Instituation}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }
}

function resetSchoolRanking() {
  loadGroup(currentYear.textContent.trim(), currentGroup.textContent.split(' ')[0]);
}


// ===== Table rendering =====
function updateTableData() {
  try { window.filteredData = filteredData; } catch(e){}
  const hidden = window.__br_hiddenRolls || new Set();
  const view = isAdmin() ? filteredData : filteredData.filter(s => !hidden.has(String(s.roll)));

  const startIndex = (currentPage - 1) * studentsPerPage;
  const endIndex = Math.min(startIndex + studentsPerPage, view.length);
  const dataToShow = view.slice(startIndex, endIndex);

  const tableBody = document.getElementById('studentTableBody');
  if (!tableBody) return;
  tableBody.innerHTML = '';

  dataToShow.forEach((student) => {
    const row = document.createElement('tr');
    const nameId = `name-${student.roll}`;
    const adminView = isAdmin();

    row.innerHTML = `
      <td>${allData.findIndex(s => s.roll === student.roll) + 1}</td>

      <td class="student-name" id="${nameId}">
        <h3 itemprop="name">${student.name}</h3>
        ${adminView ? `<span class="click-count" data-roll="${student.roll}" title="Opens count" style="margin-left:6px;color:#64748b;font-weight:600;">[${(window.clickCountsCache && window.clickCountsCache[student.roll]) || 0}]</span>` : ''}
        ${adminView ? `<span class="hide-eye" data-roll="${student.roll}" title="Hide/Unhide">üëÅÔ∏è</span>` : ''}
        ${adminView && window.__br_hiddenRolls?.has(String(student.roll)) ? `<span class="click-count" style="color:#b91c1c;font-weight:900;margin-left:6px;">HIDDEN</span>` : ''}
      </td>

      <td class="student-roll">${student.roll}</td>

      <td><span class="${student.allAPlus ? 'gpa-shine' : ''}" title="${student.allAPlus ? 'All subjects ‚â• 79.5%' : ''}">${student.gpa}</span></td>
      <td>${student.total}</td>
      <td class="student-school"><h4 itemprop="affiliation">${student.Instituation}</h4></td>
    `;

    const nameCell = row.querySelector('.student-name');
    nameCell.addEventListener('click', (e) => {
      if (e.target.classList.contains('hide-eye')) return;
      if (typeof window.incrementClickCount === 'function') window.incrementClickCount(student.roll);
      showIndividualResultWithCheck(student.roll, currentYear.textContent.split(' ')[1], currentGroup.textContent.split(' ')[0]);
    });

    if (adminView) {
      const eye = row.querySelector('.hide-eye');
      if (eye) {
        eye.addEventListener('click', async (ev) => {
          ev.stopPropagation();
          const r = String(ev.currentTarget.dataset.roll || student.roll);
          const hiddenNow = window.__br_hiddenRolls?.has(r);
          if (hiddenNow) await window.unhideResultRoll?.(r);
          else await window.hideResultRoll?.(r);
        });
      }
    }

    row.querySelector('.student-roll').addEventListener('click', () => {
      if (typeof window.incrementClickCount === 'function') window.incrementClickCount(student.roll);
      showIndividualResultWithCheck(student.roll, currentYear.textContent.split(' ')[1], currentGroup.textContent.split(' ')[0]);
    });

    row.querySelector('.student-school').addEventListener('click', () => {
      showSchoolRanking(student.Instituation.trim());
    });

    tableBody.appendChild(row);

    // Live admin click-count listener
    if (adminView && typeof window.listenClickCount === 'function') {
      const r = student.roll;
      window._br_clickListenerSet = window._br_clickListenerSet || new Set();
      if (!window._br_clickListenerSet.has(r)) {
        window._br_clickListenerSet.add(r);
        window.listenClickCount(r, (val) => {
          const span = document.querySelector(`.student-name .click-count[data-roll="${r}"]`);
          if (span) span.textContent = `[${val}]`;
        });
      }
    }
  });

  const info = document.getElementById('paginationInfo');
  if (info) info.textContent = `Showing ${view.length ? (startIndex + 1) : 0}-${endIndex} of ${view.length} students`;
  updatePaginationButtons();
}


// ===== Institution filter (basic; may be overridden later to open school view) =====
function filterByInstituation(InstituationName = null, fromTable = false) {
  const InstituationDropdown = document.getElementById('InstituationDropdown');
  if (fromTable) {
    InstituationDropdown.value = InstituationName;
    const event = new Event('change');
    InstituationDropdown.dispatchEvent(event);
  } else {
    InstituationName = InstituationDropdown ? InstituationDropdown.value : (InstituationName || '');
  }

  if (InstituationName) {
    filteredData = allData.filter(student => (student.Instituation || '').trim().toLowerCase() === (InstituationName || '').trim().toLowerCase());
    const btn = document.getElementById('resetFilterBtn');
    if (btn) btn.style.display = 'block';
  } else {
    resetFilter();
  }
  currentPage = 1;
  updatePage();
}

function resetFilter() {
  filteredData = [...allData];
  currentPage = 1;
  const btn = document.getElementById('resetFilterBtn');
  if (btn) btn.style.display = 'none';
  updatePage();
}


// ===== Pagination =====
function updatePage() {
  updateTableData();
  updatePaginationButtons();
}

function handlePrevButtonClick() {
  if (currentPage > 1) {
    currentPage--;
    updatePage();
  }
}
function handleFirstButtonClick() {
  if (currentPage > 1) {
    currentPage = 1;
    updatePage();
  }
}
function handleLastButtonClick() {
  const visibleLen = getVisibleLength();
  const maxPage = Math.ceil(visibleLen / studentsPerPage);
  if (currentPage < maxPage) {
    currentPage = maxPage;
    updatePage();
  }
}
function handleNextButtonClick() {
  const visibleLen = getVisibleLength();
  const maxPage = Math.ceil(visibleLen / studentsPerPage);
  if (currentPage < maxPage) {
    currentPage++;
    updatePage();
  }
}

function getVisibleLength() {
  const hidden = window.__br_hiddenRolls || new Set();
  return isAdmin() ? filteredData.length : filteredData.filter(s => !hidden.has(String(s.roll))).length;
}

function updatePaginationButtons() {
  const visibleLen = getVisibleLength();
  const maxPage = Math.ceil(visibleLen / studentsPerPage) || 1;
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  if (prevBtn) prevBtn.disabled = currentPage === 1;
  if (nextBtn) nextBtn.disabled = currentPage >= maxPage || visibleLen === 0;
}


// ===== Search + suggestions =====
function handleSearchInput() {
  const nameEl = document.getElementById('searchInput');
  const rollEl = document.getElementById('searchRollInput');
  const instEl = document.getElementById('InstituationDropdown');

  const searchTerm = nameEl ? nameEl.value.trim().toLowerCase() : '';
  const rollSearchTerm = rollEl ? rollEl.value.trim() : '';
  const selectedInstituation = instEl ? instEl.value : '';

  filteredData = allData.filter(student => {
    const matchesName = student.name && student.name.toLowerCase().includes(searchTerm);
    const matchesRoll = String(student.roll).includes(rollSearchTerm);
    const matchesInstituation = selectedInstituation
      ? (student.Instituation || '').trim().toLowerCase() === selectedInstituation.trim().toLowerCase()
      : true;
    return matchesName && matchesRoll && matchesInstituation;
  });

  currentPage = 1;
  updatePage();
}

function handleRollSearchInput() {
  handleSearchInput();
}

function populateInstituationDropdown() {
  const InstituationDropdown = document.getElementById('InstituationDropdown');
  if (!InstituationDropdown) return;
  InstituationDropdown.innerHTML = '<option value="">Select Instituation</option>';
  InstituationSet.forEach(Instituation => {
    const option = document.createElement('option');
    option.value = Instituation;
    option.textContent = Instituation;
    InstituationDropdown.appendChild(option);
  });
}


// ===== Suggestions UI =====
function attachSearchSuggestions() {
  const nameInput = document.getElementById('searchInput');
  const rollInput = document.getElementById('searchRollInput');
  if (!nameInput || !rollInput) return;

  ensureSuggestBox(nameInput, 'nameSuggestBox');
  ensureSuggestBox(rollInput, 'rollSuggestBox');

  nameInput.addEventListener('input', renderNameSuggestions);
  rollInput.addEventListener('input', renderRollSuggestions);

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.suggest-box')) hideSuggestions();
  });
}

function ensureSuggestBox(inputEl, id) {
  if (document.getElementById(id)) return;
  const box = document.createElement('div');
  box.id = id;
  box.className = 'suggest-box';
  inputEl.insertAdjacentElement('afterend', box);
}

function hideSuggestions() {
  const boxes = document.querySelectorAll('.suggest-box');
  boxes.forEach(b => b.style.display = 'none');
}

function renderNameSuggestions() {
  try {
    const input = document.getElementById('searchInput');
    const box = document.getElementById('nameSuggestBox');
    if (!input || !box || !Array.isArray(allData) || allData.length === 0) return;

    const q = input.value.trim().toLowerCase();
    if (!q) { box.style.display = 'none'; return; }

    const seen = new Set();
    const matches = allData
      .filter(s => s.name && s.name.toLowerCase().includes(q))
      .filter(s => {
        const key = s.name.toLowerCase();
        if (seen.has(key)) return false;
        seen.add(key); return true;
      })
      .slice(0, 8);

    box.innerHTML = matches.map(s =>
      `<div class="suggest-item" data-name="${String(s.name).replace(/"/g,'&quot;')}">
         <i class="ri-user-3-line"></i> ${s.name} <small>‚Ä¢ ${s.Instituation || ''}</small>
       </div>`).join('') || '<div class="suggest-empty">No matches</div>';

    box.style.display = 'block';
    box.querySelectorAll('.suggest-item').forEach(it => {
      it.addEventListener('click', () => {
        input.value = it.getAttribute('data-name');
        handleSearchInput();
        hideSuggestions();
      });
    });
  } catch(e){}
}

function renderRollSuggestions() {
  try {
    const input = document.getElementById('searchRollInput');
    const box = document.getElementById('rollSuggestBox');
    if (!input || !box || !Array.isArray(allData) || allData.length === 0) return;

    const q = input.value.trim();
    if (!q) { box.style.display = 'none'; return; }

    const matches = allData
      .filter(s => String(s.roll).includes(q))
      .slice(0, 8);

    box.innerHTML = matches.map(s =>
      `<div class="suggest-item" data-roll="${s.roll}">
         <i class="ri-hashtag"></i> ${s.roll} <small>‚Ä¢ ${s.name} ‚Äî ${s.Instituation || ''}</small>
       </div>`).join('') || '<div class="suggest-empty">No matches</div>';

    box.style.display = 'block';
    box.querySelectorAll('.suggest-item').forEach(it => {
      it.addEventListener('click', () => {
        input.value = it.getAttribute('data-roll');
        handleRollSearchInput();
        hideSuggestions();
      });
    });
  } catch(e){}
}
}

scripts\3A-popups-core.js {
// 3A-popups-core.js ‚Äî Help popup, Student details popup, comparison, copy/link, PDF export

// ====== Safe fallback for error popup (only if not provided elsewhere) ======
if (typeof window.showErrorPopup !== 'function') {
  window.showErrorPopup = function(msg) {
    openPopup(`
      <div class="popup-content">
        <span class="close-btn" onclick="closePopup()">&times;</span>
        <p>${String(msg || 'Something went wrong.')}</p>
      </div>
    `);
  };
}


// ====== Help / Tips popup ======
function showRankTipsPopup() {
  if (document.querySelector('.popup')) return;

  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.innerHTML = `
    <div class="popup-content help-popup" style="max-width: 720px;">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <h2 style="margin-top:0;">How it works</h2>

      <div class="help-grid">
        <div class="help-item">
          <div class="hi-text">Pick SSC/HSC + year. Then you can search, filter, and open details.</div>
        </div>


      <p class="help-note">Note: This is an unofficial ranking made from publicly available data.</p>
    </div>
  `;
  document.body.appendChild(popup);
  document.body.classList.add('locked');

  // Admin-only hide bar (guard roll var safely to avoid ReferenceError)
  (function(){
    const pc = popup.querySelector('.popup-content');
    if (!pc) return;
    const r = (typeof roll !== 'undefined') ? String(roll) : '';

    if (r && isAdmin()) {
      const bar = document.createElement('div');
      bar.className = 'admin-hidebar';
      bar.innerHTML = `
        <span>Admin</span>
        <button id="hrHideBtn" class="btn-secondary" style="margin-left:8px;">Hide</button>
        <button id="hrUnhideBtn" class="btn-secondary" style="margin-left:6px;display:none;">Unhide</button>
      `;
      pc.appendChild(bar);

      const applyState = () => {
        const hidden = window.__br_hiddenRolls?.has(r);
        pc.classList.toggle('admin-blur', hidden);
        bar.querySelector('#hrHideBtn').style.display = hidden ? 'none' : 'inline-block';
        bar.querySelector('#hrUnhideBtn').style.display = hidden ? 'inline-block' : 'none';
      };
      applyState();

      bar.querySelector('#hrHideBtn')?.addEventListener('click', async ()=>{ await window.hideResultRoll?.(r); applyState(); });
      bar.querySelector('#hrUnhideBtn')?.addEventListener('click', async ()=>{ await window.unhideResultRoll?.(r); applyState(); });
    } else if (r && window.__br_hiddenRolls?.has(r)) {
      closePopup();
      showErrorPopup("This result has been hidden by admin.");
    }
  })();

  // Wire quick commands ‚Üí open bot and send
  popup.querySelectorAll('.help-chip').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const cmd = btn.getAttribute('data-cmd') || '';
      const launcher = document.getElementById('hb-launcher');

      if (typeof togglePanel === 'function') togglePanel(true);
      else launcher?.click();

      setTimeout(()=>{
        const i = document.getElementById('hb-input');
        const s = document.getElementById('hb-send');
        if (i && s) {
          i.value = cmd;
          s.click();
        }
      }, 180);
    });
  });
}

// Hook buttons for Help + init toggles
document.getElementById('helpBtn')?.addEventListener('click', showRankTipsPopup);
document.addEventListener("DOMContentLoaded", () => {
    // Always show Profile & Favourite in the navbar, even if not logged in
  ['profile.html', 'favorite.html'].forEach(href => {
    const a = document.querySelector(`.nav-links a[href="${href}"]`);
    if (a && a.closest('li')) {
      a.closest('li').style.display = 'block'; // force show
      a.addEventListener('click', (e) => {
        if (localStorage.getItem('userLoggedIn') !== 'true') {
          e.preventDefault();
         if (typeof requireLogin === 'function') {
  requireLogin('Please log in to access your profile/favourites.');
} else {
  showModal({
    title: 'Login required',
    message: 'Please log in to access your profile/favourites.',
    buttons: [
      { text: 'Go to login', onClick: () => { window.location.href = 'login.html'; } },
      { text: 'Cancel', variant: 'secondary' }
    ]
  });
}
        }
      });
    }
  });

  const email = (localStorage.getItem("userEmail") || '').toLowerCase();
  if (email !== 'hasnyne2007@gmail.com') document.getElementById("visitorsLink")?.remove();

  document.getElementById('helpBtnHero')?.addEventListener('click', showRankTipsPopup);
  initThemeToggle();
  initNavToggle();
  // Log page view (if logged in)
(async () => {
  try {
    if (localStorage.getItem('userLoggedIn') === 'true') {
      const uid = localStorage.getItem('loggedInUserId');
      if (uid) {
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js');
        const { getDatabase, ref, push } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js');
        const cfg = {
          apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
          authDomain: "boardrankctg.firebaseapp.com",
          databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "boardrankctg",
          storageBucket: "boardrankctg.firebasestorage.app",
          messagingSenderId: "751761229963",
          appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
        };
        const app = window.__br_logApp || initializeApp(cfg, 'logApp');
        window.__br_logApp = app;
        const dbv = getDatabase(app);
        const url = location.href.split('#')[0];
        const title = document.title || 'Page';
        push(ref(dbv, `userLogs/${uid}/pages`), { url, title, ts: Date.now() });
      }
    }
  } catch (e) {
    console.warn('Page view log failed', e);
  }
})();

  if (localStorage.getItem('userLoggedIn') === 'true') {
    document.querySelectorAll('.logged-in-only').forEach(el => el.style.display = 'block');
    document.querySelectorAll('.logged-out-only').forEach(el => el.style.display = 'none');
  }
});

// ESC to close popups
document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closePopup(); });


// ====== Progress bars for subject marks ======
function getProgressBarHtml(score, totalMark) {
  const percentage = (parseFloat(score) / totalMark) * 100;
  const barId = `pb_${Math.random().toString(36).substr(2, 9)}`;
  const numId = `num_${Math.random().toString(36).substr(2, 9)}`;

  setTimeout(() => {
    animateProgressBar(barId, percentage);
    animateNumber(numId, score); 
  }, 100);

  return `
    <span id="${numId}">0</span>
    <div class="progress-bar-container">
      <div id="${barId}" class="progress-bar">0%</div>
    </div>
  `;
}

function animateProgressBar(id, targetPercentage) {
  const bar = document.getElementById(id);
  if (!bar) return;
  let current = 0;

  function update() {
    current += 1;
    if (current > targetPercentage) current = targetPercentage;

    let color = 'red';
    let additionalClass = '';
    if (current >= 95) {
      color = 'indigo';
    } else if (current >= 90) {
      color = 'blue';
    } else if (current >= 80) {
      color = 'green';
    } else if (current >= 70) {
      color = 'yellow';
      additionalClass = 'yellow';
    } else if (current >= 34) {
      color = 'orange';
    }

    bar.style.width = `${current}%`;
    bar.style.backgroundColor = color;
    bar.textContent = `${current.toFixed(0)}%`;

    if (current < targetPercentage) {
      requestAnimationFrame(update);
    } else {
      bar.style.width = `${targetPercentage}%`;
      bar.textContent = `${targetPercentage.toFixed(2)}%`;
    }
  }

  update();
}

function animateNumber(elementId, targetNumber) {
  const el = document.getElementById(elementId);
  if (!el) return;
  let current = 0;
  const duration = 1000;
  const stepTime = Math.max(Math.floor(duration / targetNumber), 10);

  const timer = setInterval(() => {
    current += 1;
    if (current >= targetNumber) {
      current = targetNumber;
      clearInterval(timer);
    }
    el.textContent = current;
  }, stepTime);
}


// ====== Student detail popup ======
function showIndividualResult(roll, year, group) {
  if (!isAdmin() && window.__br_hiddenRolls?.has(String(roll))) {
    showErrorPopup("This result has been hidden by admin.");
    return;
  }

  if (document.querySelector('.popup')) return; // Prevent multiple popups

  const fileName = `DATA/data_${year}_${group.toLowerCase()}_individual.txt`;
  const isHSC = fileName.includes("hsc");
  const newUrl = `${location.pathname}?year=${year}&group=${group}&roll=${roll}`;
  history.pushState({}, '', newUrl);

  fetch(fileName)
    .then(response => response.text())
    .then(data => {
      const rows = data.trim().split('\n');
      const individualData = rows.find(row => row.split('\t')[0].replace(/^0+/, '') === roll.toString().replace(/^0+/, ''));

      let popupContent;
      let student = null;  // <-- ADD THIS LINE
      if (individualData) {
        const parts = individualData.split('\t');
        let subject1Name, subject2Name, subject3Name;

        if (group === 'Commerce') {
          subject1Name = 'Science';
          subject2Name = 'Accounting';
          subject3Name = 'Finance';
        } else if (group === 'Arts') {
          subject1Name = 'Science';
          subject2Name = 'Geography';
          subject3Name = 'Civics';
        } else {
          subject1Name = 'BGS';
          subject2Name = 'Physics';
          subject3Name = 'Chemistry';
        }

        if (isHSC) {
          if (parts.length < 8) {
            popupContent = `<div class="popup-content"><p>Result not found</p><button class="back-button" onclick="closePopup()">Back</button></div>`;
          } else {
            const [rollStr, bangla, english, ICT, physics, chemistry, compulsory, optional] = parts;
            student = allData.find(student => student.roll === parseInt(rollStr));
            try { updateSEOForStudent(year, group, student.name, rollStr); } catch(e) {}

            const combinedRank = allData.findIndex(student => student.roll === parseInt(rollStr)) + 1;
            try {
              const examType = (year && year.includes('hsc')) ? 'HSC' : 'SSC';
              const formattedYear = (year || '').replace('hsc_', '');
              document.title = `${student.name} | ${formattedYear} ${examType}`;
            } catch (e) { /* no-op */ }

            popupContent = `
              <div class="popup-content">
                <span class="close-btn" onclick="closePopup()">&times;</span>
                <p>Name: ${student.name}</p>
                <p>Institution: ${student.Instituation}</p>
                <p>Roll: ${rollStr}</p>
                <p>GPA: ${student.gpa}</p>
                <p>Board Rank: ${combinedRank}</p>
                <p>Total Marks: ${student.total}</p>

                <p>Bangla: ${getProgressBarHtml(bangla, 200)}</p>
                <p>English: ${getProgressBarHtml(english, 200)}</p>
                <p>ICT: ${getProgressBarHtml(ICT, 100)}</p>
                <p>Physics: ${getProgressBarHtml(physics, 200)}</p>
                <p>Chemistry: ${getProgressBarHtml(chemistry, 200)}</p>
                <p>Compulsory: ${getProgressBarHtml(compulsory, 200)}</p>
                <p>Optional: ${getProgressBarHtml(optional, 200)}</p>

                <button onclick='promptComparison(${student.roll}, "${year}", "${group}")'>Compare with Other Student</button>
${localStorage.getItem('userLoggedIn') === 'true' ? `
<button onclick="toggleFavorite('${student.name}', '${roll}', '${student.Instituation}', '${student.gpa}', '${year}', '${group}')" style="background:#fff;color:#ef4444;border:2px solid #ef4444;font-weight:800;">
  <i class="fas fa-heart"></i> Add to Favorites
</button>
` : ''}
                <div class="popup-footer">
                  <button onclick="copyFullResult(this)" class="icon-btn footer-btn" title="Copy Result"><i class="fas fa-copy"></i></button>
                  <button onclick="closePopup()" class="icon-btn footer-btn" title="Close"><i class="fas fa-times"></i></button>
                  <button onclick="copyStudentResultLink(this)" class="icon-btn footer-btn" title="Copy Link"><i class="fas fa-link"></i></button>
                  <button onclick="downloadStudentPDF(this)" class="icon-btn footer-btn" title="Download PDF"><i class="fas fa-file-pdf"></i></button>
                </div>
              </div>
            `;
          }
        } else {
          if (parts.length < 13) {
            popupContent = `<div class="popup-content"><p>Result not found</p><button class="back-button" onclick="closePopup()">Back</button></div>`;
          } else {
            const [rollStr, bangla, english, math, bgs, religion, physics, chemistry, Compulsory, ICT, Optional, Physical, Career] = parts;
            student = allData.find(student => student.roll === parseInt(rollStr));
            try { updateSEOForStudent(year, group, student.name, rollStr); } catch(e) {}
            const combinedRank = allData.findIndex(student => student.roll === parseInt(rollStr)) + 1;
            try {
              const examType = (year && year.includes('hsc')) ? 'HSC' : 'SSC';
              const formattedYear = (year || '').replace('hsc_', '');
              document.title = `${student.name} | ${formattedYear} ${examType}`;
            } catch (e) { /* no-op */ }

            popupContent = `
              <div class="popup-content">
                <span class="close-btn" onclick="closePopup()">&times;</span>
                <p>Name: ${student.name}</p>
                <p>Institution: ${student.Instituation}</p>
                <p>Roll: ${rollStr}</p>
                <p>GPA: ${student.gpa}</p>
                <p>Board Rank: ${combinedRank}</p>
                <p>Total Marks: ${student.total}</p>

                <p>Bangla: ${getProgressBarHtml(bangla, 200)}</p>
                <p>English: ${getProgressBarHtml(english, 200)}</p>
                <p>Mathematics: ${getProgressBarHtml(math, 100)}</p>
                <p>${subject1Name}: ${getProgressBarHtml(bgs, 100)}</p>
                <p>Religion: ${getProgressBarHtml(religion, 100)}</p>
                <p>${subject2Name}: ${getProgressBarHtml(physics, 100)}</p>
                <p>${subject3Name}: ${getProgressBarHtml(chemistry, 100)}</p>
                <p>Compulsory: ${getProgressBarHtml(Compulsory, 100)}</p>
                <p>ICT: ${getProgressBarHtml(ICT, 50)}</p>
                <p>Optional: ${getProgressBarHtml(Optional, 100)}</p>
                <p>Physical: ${getProgressBarHtml(Physical, 100)}</p>
                <p>Career: ${getProgressBarHtml(Career, 50)}</p>

                <button onclick='promptComparison(${student.roll}, "${year}", "${group}")'>Compare with Other Student</button>
${localStorage.getItem('userLoggedIn') === 'true' ? `
<button onclick="toggleFavorite('${student.name}', '${roll}', '${student.Instituation}', '${student.gpa}', '${year}', '${group}')" style="background:#fff;color:#ef4444;border:2px solid #ef4444;font-weight:800;">
  <i class="fas fa-heart"></i> Add to Favorites
</button>
` : ''}
                <div class="popup-footer">
                  <button onclick="copyFullResult(this)" class="icon-btn footer-btn" title="Copy Result"><i class="fas fa-copy"></i></button>
                  <button onclick="closePopup()" class="icon-btn footer-btn" title="Close"><i class="fas fa-times"></i></button>
                  <button onclick="copyStudentResultLink(this)" class="icon-btn footer-btn" title="Copy Link"><i class="fas fa-link"></i></button>
                  <button onclick="downloadStudentPDF(this)" class="icon-btn footer-btn" title="Download PDF"><i class="fas fa-file-pdf"></i></button>
                </div>
              </div>
            `;
          }
        }
      } else {
        popupContent = `<div class="popup-content"><p>Result not found</p><button class="back-button" onclick="closePopup()">Back</button></div>`;
      }

      const popup = document.createElement('div');
      popup.classList.add('popup');
      popup.innerHTML = popupContent;
      document.body.appendChild(popup);
      document.body.classList.add('locked');
// Log viewed student (if logged-in)
(async () => {
  try {
    if (localStorage.getItem('userLoggedIn') === 'true') {
      const uid = localStorage.getItem('loggedInUserId');
      if (uid) {
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js');
        const { getDatabase, ref, push } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js');
        const cfg = {
          apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
          authDomain: "boardrankctg.firebaseapp.com",
          databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "boardrankctg",
          storageBucket: "boardrankctg.firebasestorage.app",
          messagingSenderId: "751761229963",
          appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
        };
        const app = window.__br_logApp || initializeApp(cfg, 'logApp');
        window.__br_logApp = app;
        const dbv = getDatabase(app);
        await push(ref(dbv, `userLogs/${uid}/views`), {
          roll: String(roll),
          name: (student && student.name) || '',
          year,
          group,
          institution: (student && student.Instituation) || '',
          ts: Date.now()
        });
      }
    }
  } catch (e) {
    console.warn('Failed to log viewed student', e);
  }
})();
      // Admin hide/unhide bar in student popup
      (function(){
        const pc = popup.querySelector('.popup-content');
        if (!pc) return;
        const r = String(roll);

        if (isAdmin()) {
          const bar = document.createElement('div');
          bar.className = 'admin-hidebar';
          bar.innerHTML = `
            <span>Admin</span>
            <button id="hrHideBtn" class="btn-secondary" style="margin-left:8px;">Hide</button>
            <button id="hrUnhideBtn" class="btn-secondary" style="margin-left:6px;display:none;">Unhide</button>
          `;
          pc.appendChild(bar);

          const applyState = () => {
            const hidden = window.__br_hiddenRolls?.has(r);
            pc.classList.toggle('admin-blur', hidden);
            bar.querySelector('#hrHideBtn').style.display = hidden ? 'none' : 'inline-block';
            bar.querySelector('#hrUnhideBtn').style.display = hidden ? 'inline-block' : 'none';
          };
          applyState();

          bar.querySelector('#hrHideBtn')?.addEventListener('click', async ()=>{ await window.hideResultRoll?.(r); applyState(); });
          bar.querySelector('#hrUnhideBtn')?.addEventListener('click', async ()=>{ await window.unhideResultRoll?.(r); applyState(); });
        } else if (window.__br_hiddenRolls?.has(r)) {
          closePopup();
          showErrorPopup("This result has been hidden by admin.");
        }
      })();
    })
    .catch(error => {
      console.error('Error loading individual data:', error);
      const popup = document.createElement('div');
      popup.classList.add('popup');
      popup.innerHTML = `<div class="popup-content"><p>Result not found</p><button class="back-button" onclick="closePopup()">Back</button></div>`;
      document.body.appendChild(popup);
      document.body.classList.add('locked'); 
    });
}
// Favorite functionality
async function toggleFavorite(name, roll, institution, gpa, year, group) {
  try {
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js");
    const { getDatabase, ref, get, set } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js");

    // Reuse the same app for favourites
    const dbApp = window.__br_favApp || initializeApp({
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
    }, "favApp");
    window.__br_favApp = dbApp;

    const db = getDatabase(dbApp);
    const userUID = localStorage.getItem('loggedInUserId');
    if (!userUID) {
      alert('Please log in to use favourites.');
      return;
    }

    // Use a stable key: year_group_roll
    const favKey = `${year}_${group}_${roll}`;
    const favRef = ref(db, 'favorites/' + userUID + '/' + favKey);

    const existing = await get(favRef);
    if (existing.exists()) {
      alert('This student is already in your favourites.');
      return;
    }

    await set(favRef, {
      name,
      roll,
      institution,
      gpa,
      year,
      group,
      exam: String(year).includes('hsc') ? 'HSC' : 'SSC',
      addedAt: Date.now()
    });

    alert('Added to favourites!');
  } catch (error) {
    console.error('Error adding favourite:', error);
    alert('Could not add to favourites. Please try again.');
  }
}

window.toggleFavorite = toggleFavorite;

// ====== Copy / link / entity nav ======
function copyFullResult(btn) {
  const popup = btn.closest('.popup-content');
  if (!popup) return;

  let text = '';
  const fields = popup.querySelectorAll('p'); 
  fields.forEach(p => {
    if (p.querySelector('.progress-bar')) return;
    const clean = p.textContent.trim();
    if (clean) text += `${clean}\n`;
  });

  navigator.clipboard.writeText(text).then(() => {
    showToast("üìã Result copied to clipboard");
  }).catch(() => {
    const input = document.createElement('textarea');
    input.value = text;
    document.body.appendChild(input);
    input.select();
    document.execCommand('copy');
    document.body.removeChild(input);
    showToast("üìã Result copied (fallback)");
  });
}

function copyStudentResultLink(btn) {
  const popup = btn.closest('.popup-content');
  const roll = popup?.innerHTML.match(/Roll:\s*(\d+)/)?.[1];
  const year = currentYear?.textContent?.trim();
  const group = currentGroup?.textContent?.split(' ')[0];
  const url = `https://boradrankctg.github.io/rank/entity.html?year=${year}&group=${encodeURIComponent(group)}&roll=${roll}`;

  navigator.clipboard.writeText(url).then(() => {
    showToast("üîó Link copied");
  }).catch(() => {
    const input = document.createElement('input');
    input.value = url;
    document.body.appendChild(input);
    input.select();
    document.execCommand('copy');
    document.body.removeChild(input);
    showToast("üîó Link copied (fallback)");
  });
}




function promptComparison(roll, year, group) {
  if (localStorage.getItem('userLoggedIn') !== 'true') {
    requireLogin('Please log in to access Compare Students.');
    return;
  }
  const baseStudent = allData.find(s => s.roll === roll);
  if (!baseStudent) return showModal({ title:'Not found', message:'Base student not found.' });



  const popup = document.createElement('div');
  popup.classList.add('popup');
  popup.innerHTML = `
    <div class="popup-content">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <p>Compare <b>${baseStudent.name}</b> with another student</p>
      <input type="text" id="compareRollInput" placeholder="Enter roll number to compare" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #000;">
      <button onclick="startComparison(${baseStudent.roll}, '${year}', '${group}')">Compare</button>
    </div>
  `;
  document.body.appendChild(popup);
  document.body.classList.add('locked');
}
function startComparison(roll1, year, group) {
  if (localStorage.getItem('userLoggedIn') !== 'true') {
    requireLogin('Please log in to access Compare Students.');
    return;
  }
  const roll2 = document.getElementById("compareRollInput").value.trim();

if (!roll2) return showModal({ 
  title:'Missing roll', 
  message:'Please enter a roll number to compare.' 
});

  const dataFile = `DATA/data_${year}_${group.toLowerCase()}_individual.txt`;

  fetch(dataFile)
    .then(res => res.text())
    .then(text => {
      const lines = text.trim().split('\n');
      const row1 = lines.find(r => r.split('\t')[0] === roll1.toString());
      const row2 = lines.find(r => r.split('\t')[0] === roll2.toString());
      if (!row2) return alert("Second roll not found.");

      const parts1 = row1.split('\t');
      const parts2 = row2.split('\t');

      const student1 = allData.find(s => s.roll === parseInt(roll1));
      const student2 = allData.find(s => s.roll === parseInt(roll2));
      if (!student1 || !student2) return alert("Student data not found.");

      let labels = [];
      const isHSC = year.includes("hsc");

      if (isHSC) {
        if (group === "Science") {
          labels = ["Bangla", "English", "ICT", "Physics", "Chemistry", "Compulsory", "Optional"];
        } else if (group === "Commerce") {
          labels = ["Bangla", "English", "ICT", "Accounting", "Finance", "Business Studies", "Optional"];
        } else if (group === "Arts") {
          labels = ["Bangla", "English", "ICT", "Geography", "Civics", "History", "Optional"];
        }
      } else {
        if (group === "Science") {
          labels = ["Bangla", "English", "Math", "BGS", "Religion", "Physics", "Chemistry", "Compulsory", "ICT", "Optional", "Physical", "Career"];
        } else if (group === "Commerce") {
          labels = ["Bangla", "English", "Math", "Science", "Religion", "Accounting", "Finance", "Compulsory", "ICT", "Optional", "Physical", "Career"];
        } else if (group === "Arts") {
          labels = ["Bangla", "English", "Math", "Science", "Religion", "Geography", "Civics", "Compulsory", "ICT", "Optional", "Physical", "Career"];
        }
      }

      let rows = `
        <h2 style="text-align:center; margin-top: 10px;">üéØ Student Comparison</h2>
        <p style="text-align:center; font-weight:bold;">${student1.name} <span style="color:green;">vs</span> ${student2.name}</p>
        <div class="compare-table-container">
          <table class="compare-table">
            <thead>
              <tr>
                <th>Subject</th>
                <th>${student1.name}</th>
                <th>${student2.name}</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>GPA</td><td>${student1.gpa}</td><td>${student2.gpa}</td></tr>
              <tr><td>Total Marks</td><td>${student1.total}</td><td>${student2.total}</td></tr>
      `;

      for (let i = 1; i < Math.min(parts1.length, parts2.length); i++) {
        const label = labels[i - 1] || `Subject ${i}`;
        rows += `<tr><td>${label}</td><td>${parts1[i]}</td><td>${parts2[i]}</td></tr>`;
      }

      rows += `
            </tbody>
          </table>
        </div>
        <button class="back-button" onclick="closePopup()">Close</button>
      `;

      closePopup(); // Close input popup
      const popup = document.createElement('div');
      popup.classList.add('popup');
      popup.innerHTML = `<div class="popup-content"><span class="close-btn" onclick="closePopup()">&times;</span>${rows}</div>`;
      document.body.appendChild(popup);
      document.body.classList.add('locked');
      // Log comparison (if logged-in)
(async () => {
  try {
    if (localStorage.getItem('userLoggedIn') === 'true') {
      const uid = localStorage.getItem('loggedInUserId');
      if (uid) {
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js');
        const { getDatabase, ref, push } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js');
        const cfg = {
          apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
          authDomain: "boardrankctg.firebaseapp.com",
          databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "boardrankctg",
          storageBucket: "boardrankctg.firebasestorage.app",
          messagingSenderId: "751761229963",
          appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
        };
        const app = window.__br_logApp || initializeApp(cfg, 'logApp');
        window.__br_logApp = app;
        const dbv = getDatabase(app);
        await push(ref(dbv, `userLogs/${uid}/comparisons`), {
          roll1: String(roll1),
          roll2: String(roll2),
          year,
          group,
          ts: Date.now()
        });
      }
    }
  } catch (e) {
    console.warn('Failed to log comparison', e);
  }
})();
    });
}


// ====== PDF Export ======
function downloadStudentPDF(btn) {
  const safe = s => String(s == null ? '' : s).trim();

  const popup = (btn && btn.closest && (btn.closest('.popup') || btn.closest('.popup-content'))) || 
                document.querySelector('.popup .popup-content') || null;
  if (!popup) {
    showModal({ 
  title:'Not found', 
  message:'No result popup found.' 
});

    return;
  }

  const data = { name: '', roll: '', institution: '', gpa: '', subjects: [] };

  const els = Array.from(popup.querySelectorAll('p,div,span,li,td'));
  els.forEach(el => {
    const txt = safe(el.textContent);
    if (!txt) return;
    const colon = txt.match(/^([^:]{1,40})\s*[:\-]\s*(.+)$/);
    if (colon) {
      const key = colon[1].toLowerCase();
      const val = colon[2].trim();
      if (key.includes('name') && !data.name) data.name = val;
      else if (key.includes('roll') && !data.roll) data.roll = val;
      else if ((key.includes('institution') || key.includes('school') || key.includes('college')) && !data.institution) data.institution = val;
      else if (key.includes('gpa') && !key.includes('subject') && !data.gpa) data.gpa = val;
      else if (!key.includes('board rank')) {
        data.subjects.push({ name: colon[1].trim(), mark: val });
      }
    }
  });

  data.subjects = data.subjects.filter(s => !/board\s*rank/i.test(s.name));

  function markToGrade(markStr, subjectName) {
    const m = parseFloat(String(markStr).replace(/[^0-9.\-]/g, ''));
    if (isNaN(m)) return { gp: '-', grade: '-' };

    const nameLower = (subjectName || '').toLowerCase();

    let yearText = '';
    try {
      if (typeof currentYear !== 'undefined' && currentYear && currentYear.textContent) {
        yearText = String(currentYear.textContent).toLowerCase();
      }
    } catch (e) { yearText = ''; }
    const popupText = (document.querySelector('.popup .popup-content')?.textContent || '').toLowerCase();
    const isHSC = (yearText.includes('hsc') || popupText.includes('hsc'));

    let totalMarks;
    if (isHSC) {
      if (nameLower.includes('ict')) totalMarks = 100;
      else totalMarks = 200;
    } else {
      if (nameLower.includes('ict') || nameLower.includes('career')) totalMarks = 50;
      else if (nameLower.includes('bangla') || nameLower.includes('english')) totalMarks = 200;
      else totalMarks = 100;
    }

    const percentage = (m / totalMarks) * 100;

    if (percentage >= 79.5) return { gp: 5.00, grade: 'A+' };
    if (percentage >= 70)   return { gp: 4.00, grade: 'A' };
    if (percentage >= 60)   return { gp: 3.50, grade: 'A-' };
    if (percentage >= 50)   return { gp: 3.00, grade: 'B' };
    if (percentage >= 40)   return { gp: 2.00, grade: 'C' };
    if (percentage >= 33)   return { gp: 1.00, grade: 'D' };
    return { gp: 0.00, grade: 'F' };
  }

  const filename = `${(data.name || 'marksheet').replace(/[^\w\- ]/g, '')}.pdf`;

  function loadJsPdf(cb) {
    if (window.jspdf && window.jspdf.jsPDF) return cb();
    const s = document.createElement('script');
    s.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
    s.onload = cb;
    document.head.appendChild(s);
  }

  loadJsPdf(() => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'mm', format: 'a4' });
    const pageW = doc.internal.pageSize.getWidth();
    const margin = 15;
    let y = 18;

    doc.setFontSize(18);
    doc.setFont(undefined, 'bold');
    doc.text('SSC 2025 Board Rank of Chittagong', margin, y);
    y += 12;

    const infoW = pageW - margin * 2;
    const colW = infoW / 4;
    const infoH = 20;
    const fields = [
      { label: 'Name', value: data.name || '-' },
      { label: 'Roll', value: data.roll || '-' },
      { label: 'Institution', value: data.institution || '-' },
      { label: 'GPA', value: data.gpa || '-' }
    ];
    doc.setLineWidth(0.3);
    doc.rect(margin, y, infoW, infoH);
    for (let i = 0; i < fields.length; i++) {
      const x = margin + i * colW;
      doc.rect(x, y, colW, infoH);
      doc.setFontSize(9);
      doc.text(fields[i].label + ':', x + 2, y + 6);

      doc.setFont(undefined, 'bold');
      const wrapped = doc.splitTextToSize(fields[i].value, colW - 4);
      doc.setFontSize(10);
      let textY = y + 12;
      wrapped.forEach(line => { doc.text(line, x + 2, textY); textY += 4; });
      doc.setFont(undefined, 'normal');
    }
    y += infoH + 8;

    const tblW = pageW - margin * 2;
    const col1 = Math.round(tblW * 0.5 * 100) / 100; 
    const col2 = Math.round(tblW * 0.25 * 100) / 100; 
    const col3 = tblW - col1 - col2; 
    const rowH = 8;

    doc.setFillColor(240);
    doc.rect(margin, y, col1, rowH, 'F');
    doc.rect(margin + col1, y, col2, rowH, 'F');
    doc.rect(margin + col1 + col2, y, col3, rowH, 'F');
    doc.setFont(undefined, 'bold');
    doc.text('Subject', margin + 2, y + 6);
    doc.text('Marks', margin + col1 + col2 - 2, y + 6, { align: 'right' });
    doc.text('GPA', margin + col1 + col2 + col3 - 2, y + 6, { align: 'right' });
    y += rowH;
    doc.setFont(undefined, 'normal');

    data.subjects.forEach(row => {
      const g = markToGrade(row.mark, row.name);

      doc.rect(margin, y, col1, rowH);
      doc.rect(margin + col1, y, col2, rowH);
      doc.rect(margin + col1 + col2, y, col3, rowH);

      doc.text(row.name, margin + 2, y + 5);
      doc.text(String(row.mark), margin + col1 + col2 - 2, y + 5, { align: 'right' });
      doc.text(`${typeof g.gp === 'number' ? g.gp.toFixed(2) : g.gp} (${g.grade})`, margin + col1 + col2 + col3 - 2, y + 5, { align: 'right' });
      y += rowH;
    });

    doc.setFontSize(9);
    doc.text(`Generated on ${new Date().toLocaleString()}`, margin, 285);
    doc.text('Unofficial printable copy', pageW - margin, 285, { align: 'right' });

    doc.save(filename);
    showToast("üì• Download started");
  });
}
}

scripts\3B-popups-verify-share.js {
// 3B-popups-verify-share.js ‚Äî Visitor verification gating + Share/Rating + minor SEO keywords

// ====== Visitor Verification (gates detailed result after threshold) ======
let visitorInfoCompleted = localStorage.getItem('visitorInfoGiven') === '1';

function getDeviceDataAndFingerprint() {
  const ua = navigator.userAgent || '';
  const platform = navigator.platform || '';
  const screenRes = `${screen.width}x${screen.height}`;
  const deviceMemory = navigator.deviceMemory || null;
  const cores = navigator.hardwareConcurrency || null;
  const vendor = navigator.vendor || '';

  let deviceModel = 'Unknown device';
  if (/Android/i.test(ua)) {
    const match = ua.match(/Android\s+[\d.]+;\s+([^)]+)/i);
    if (match && match[1]) {
      deviceModel = match[1].replace(/Build\/.+/, '').trim();
    }
  } else if (/iPhone/i.test(ua)) {
    deviceModel = 'Apple iPhone';
  } else if (/iPad/i.test(ua)) {
    deviceModel = 'Apple iPad';
  } else if (/Macintosh/i.test(ua)) {
    deviceModel = 'Apple Mac';
  } else if (/Windows/i.test(ua)) {
    deviceModel = 'Windows PC';
  } else if (/Linux/i.test(ua)) {
    deviceModel = 'Linux Device';
  }

  const deviceData = {
    ua,
    platform,
    screen: screenRes,
    deviceMemory,
    cores,
    vendor,
    deviceModel
  };

  // Just return a stable device ID instead of fingerprint
  const fingerprint = "device_verified";

  return { deviceData, fingerprint };
}


function getOrCreateVisitorId() {
  let id = localStorage.getItem('visitorIdV2');
  if (!id) {
    try { id = crypto.randomUUID(); }
    catch { id = String(Date.now()) + Math.random().toString(36).slice(2); }
    localStorage.setItem('visitorIdV2', id);
  }
  return id;
}

async function showIndividualResultWithCheck(roll, year, group) {
    // Skip ALL verification for logged-in users
  if (localStorage.getItem('userLoggedIn') === 'true') {
    return showIndividualResult(roll, year, group);
  }
  // If current URL already has the same roll ‚Üí allow directly
  const params = new URLSearchParams(window.location.search);
  if (params.has('roll') && params.get('roll') == roll) {
    return showIndividualResult(roll, year, group);
  }

  // Count attempts and allow first 10 freely
  let clickCount = parseInt(localStorage.getItem('detailedResultClickCount') || '0', 5);
  clickCount++;
  localStorage.setItem('detailedResultClickCount', clickCount);

  if (clickCount <= 10) {
  if (localStorage.getItem('visitorInfoGiven') === '1') {
    return showIndividualResult(roll, year, group);
  }

    const visitorId = getOrCreateVisitorId();

    if (localStorage.getItem('visitorVerifiedV2') === '1') {
      return showIndividualResult(roll, year, group);
    }

    try {
      const dbLib = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js");
      const { getDatabase, ref, get } = dbLib;
      const dbv = getDatabase();
      const snap = await get(ref(dbv, 'visitorsVerified/' + visitorId));
      if (snap && snap.exists() && snap.val() === 1) {
        localStorage.setItem('visitorVerifiedV2', '1');
        return showIndividualResult(roll, year, group);
      }
    } catch (e) {
      // Non-blocking if verification check fails
    }
    return showIndividualResult(roll, year, group);
  }

  // Past free threshold ‚Üí device/fingerprint check
  const { deviceData, fingerprint } = getDeviceDataAndFingerprint();

  // Previously verified on this device?
  if (localStorage.getItem('visitorInfoGiven') === '1') {

    visitorInfoCompleted = true;
    return showIndividualResult(roll, year, group);
  }

  // Skip Firebase fingerprint check - just use localStorage
  const alreadyVerified = localStorage.getItem('visitorInfoGiven') === '1';
  if (alreadyVerified) {
    visitorInfoCompleted = true;
    return showIndividualResult(roll, year, group);
  }


  // Build verification popup
  if (document.querySelector('.popup')) return; // avoid duplicates
  const popup = document.createElement('div');
  popup.classList.add('popup');
  popup.innerHTML = `
  <div class="popup-content">
    <div class="popup-header" style="background: linear-gradient(135deg, #1976d2, #42a5f5); color: white; font-weight: bold; font-size: 1.3rem; display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-top-left-radius: 8px; border-top-right-radius: 8px;">
      <div style="display: flex; align-items: center; gap: 8px;">
        <img src="https://img.icons8.com/color/48/verified-badge.png" alt="Icon" style="width: 28px; height: 28px;">
        <span>Quick Verification</span>
      </div>
      <button class="close-btn" onclick="visitorInfoDenied()" style="background: transparent; border: none; font-size: 1.5rem; color: white; cursor: pointer;">&times;</button>
    </div>

    <div class="popup-body">
<p style="color:#555;">
  Please tell us a bit about yourself so we can improve our service. We store basic device info so you won't see this again on the same device.
</p>
<div style="background:linear-gradient(135deg, #e0f2fe, #dbeafe);border:2px solid #0284c7;padding:14px;border-radius:10px;margin:12px 0;">
  <strong style="color:#075985;font-size:16px;">üí° Want to skip this forever?</strong><br>
  <a href="login.html" style="color:#0284c7;font-weight:800;font-size:15px;">Sign in / Log in</a> to skip all verification popups and unlock features like favorites & reviews!
</div>      
      <label>Name</label>
      <input id="visitorName" type="text" placeholder="Your name" />

      <label>Institution (school / college)</label>
      <input id="visitorInstitution" type="text" placeholder="Institution name" />

      <label>Type</label>
      <select id="visitorType">
        <option value="">Select ...</option>
        <option>SSC</option>
        <option>HSC</option>
        <option>Others</option>
      </select>

      <label>How did you find us?</label>
      <select id="visitorSource">
        <option value="">Select ...</option>
        <option>WhatsApp group</option>
        <option>Facebook group</option>
        <option>Friend / Classmate</option>
        <option>Facebook post</option>
        <option>Instagram</option>
        <option>YouTube</option>
        <option>Google Search</option>
        <option>School notice board</option>
        <option>Teacher</option>
        <option>Relatives</option>
        <option>Other social media</option>
        <option>Others</option>
      </select>

      <label>Experience so far</label>
      <select id="visitorExperience">
        <option value="">Select ...</option>
        <option value="worst">üòñ Worst</option>
        <option value="bad">üòû Bad</option>
        <option value="average">üòê Average</option>
        <option value="good">üôÇ Good</option>
        <option value="best">ü§© Best</option>
      </select>

      <label>Leave a Message (optional)</label>
      <textarea id="visitorMessage" placeholder="Write something..." style="min-height:60px;"></textarea>
    </div>
    <div class="popup-footer">
      <button class="secondary-btn" onclick="visitorInfoDenied()">Cancel</button>
      <button id="submitVisitorInfo" class="primary-btn">Submit</button>
    </div>
  </div>
`;

  document.body.appendChild(popup);
  document.body.classList.add('locked');

  // Helpers
  function looksFakeName(name) {
    if (!name) return true;
    const cleaned = name.trim();
    if (cleaned.length < 3 || cleaned.length > 40) return true;
    if (!/^[a-zA-Z\s]+$/.test(cleaned)) return true;
    const vowelCount = (cleaned.match(/[aeiouAEIOU]/g) || []).length;
    if (vowelCount < 2) return true;
    if (/(.)\1{3,}/.test(cleaned)) return true;
    return false;
  }

  let originalFormHTML = popup.querySelector('.popup-body').innerHTML;

  function bindSubmit() {
    const submitBtn = popup.querySelector('#submitVisitorInfo');
    if (!submitBtn) return;

    submitBtn.addEventListener('click', async () => {
      const body = popup.querySelector('.popup-body');
      const footer = popup.querySelector('.popup-footer');

      const name = popup.querySelector('#visitorName')?.value.trim() || '';
      const institution = popup.querySelector('#visitorInstitution')?.value.trim() || '';
      const type = popup.querySelector('#visitorType')?.value || '';
      const source = popup.querySelector('#visitorSource')?.value || '';
      const experience = popup.querySelector('#visitorExperience')?.value || '';
      const messageVal = popup.querySelector('#visitorMessage')?.value.trim() || '';

      // Deny on worst/bad
      if (experience === "worst" || experience === "bad") {
        if (footer) footer.style.display = 'none';
        body.innerHTML = `
          <div style="text-align:center; padding:20px;">
            <div class="access-status">
              <div class="circle" style="border: 4px solid #ccc; border-top: 4px solid #1976d2; border-radius: 50%; width: 40px; height: 40px; margin: auto; animation: spin 1s linear infinite;"></div>
              <div style="margin-top: 10px; font-size: 0.95rem;">Checking your feedback‚Ä¶</div>
            </div>
          </div>
          <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
        `;
        setTimeout(() => {
          body.innerHTML = `
            <div style="text-align:center; padding:20px;">
              <h3 style="color:#b91c1c;">üö´ Access Not Granted</h3>
              <p style="margin:10px 0; font-size:0.95rem;">Looks like this feature isn‚Äôt available with that feedback. Maybe try again later.</p>
              <p style="color:#666; font-size:0.85rem;">We‚Äôre always working to improve ‚Äî your opinion is noted.</p>
              <button onclick="visitorInfoDenied()" class="secondary-btn" style="margin-top:15px;">Close</button>
            </div>
          `;
        }, 1500);
        return;
      }

      // Basic validation & fake name detection
      if (looksFakeName(name)) {
        if (footer) footer.style.display = 'none';
        body.innerHTML = `
          <div style="text-align:center; padding:20px;">
            <div class="circle" style="border: 4px solid #ccc; border-top: 4px solid #1976d2; border-radius: 50%; width: 40px; height: 40px; margin: auto; animation: spin 1s linear infinite;"></div>
            <div style="margin-top: 10px; font-size: 0.95rem;">Verifying name‚Ä¶</div>
          </div>
          <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
        `;
        setTimeout(() => {
          body.innerHTML = `
            <div style="text-align:center; padding:20px;">
              <h3 style="color:#b91c1c;">üö´ Access Not Granted</h3>
              <p style="margin:10px 0; font-size:0.95rem;">The name provided doesn‚Äôt seem valid. Please use your real name to continue.</p>
              <button onclick="visitorInfoDenied()" class="secondary-btn" style="margin-top:15px;">Close</button>
            </div>
          `;
        }, 1500);
        return;
      }

      if (!name || name.length < 4) { alert('Name must contain at least 4 characters.'); return; }
      if (!institution || institution.length < 3) { alert('Institution name must contain at least 3 characters.'); return; }
      if (!type || !source) { alert('Please fill all required fields.'); return; }

      // Confirm name step
      if (footer) footer.style.display = 'none';
      const prev = body.innerHTML;
      body.innerHTML = `
        <div style="text-align:center; padding:20px;">
          <h3 style="color:#d97706; margin-bottom:8px;">‚ö† Confirm Your Name</h3>
          <p>Are you sure your name is <b>"${name}"</b>?</p>
          <p style="font-size:0.9rem; color:#555;">
            If you use a fake name, this form will appear again every time you visit.
            Please enter real details to avoid repeated verification.
          </p>
          <div style="margin-top:15px; display:flex; justify-content:center; gap:12px;">
            <button id="confirmNameBtn" class="primary-btn">Confirm</button>
            <button id="editNameBtn" class="secondary-btn">Edit Name</button>
          </div>
        </div>
      `;

      popup.querySelector('#confirmNameBtn')?.addEventListener('click', async () => {
        const { fingerprint } = getDeviceDataAndFingerprint();
        localStorage.setItem('visitorInfoGiven', '1');
        visitorInfoCompleted = true;

        try {
          const dbLib = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js");
          const { getDatabase, ref, push, set } = dbLib;
          const dbv = getDatabase();
          const visitorRef = push(ref(dbv, "visitors"));
          const { deviceData } = getDeviceDataAndFingerprint();

     await set(visitorRef, {
  name,
  institution,
  type,
  source,
  experience,
  message: messageVal,
  fingerprint: "verified_" + Date.now(), // Unique ID instead of device fingerprint
  deviceData,
  timestamp: Date.now()
});


          try {
            const verRef = ref(dbv, "visitorsVerified/" + getOrCreateVisitorId());
            await set(verRef, 1);
            localStorage.setItem('visitorVerifiedV2', '1');
          } catch (e) {}

          try { window.__HAS9_notify?.(name); } catch (e) {}
        } catch (err) {
          console.error('Error saving visitor info:', err);
        }

        body.innerHTML = `
          <div class="access-status">
            <div class="circle"></div>
            <div class="status-text">Processing...</div>
          </div>
        `;
        setTimeout(() => {
          body.innerHTML = `
            <div class="access-status">
              <div class="tick">‚úÖ</div>
              <div class="status-text" style="color:#16a34a;">Full Access Granted</div>
            </div>
          `;
          setTimeout(() => {
            closePopup();
            showIndividualResult(roll, year, group);
          }, 1500);
        }, 1000);
      });

      popup.querySelector('#editNameBtn')?.addEventListener('click', () => {
        if (footer) footer.style.display = 'flex';
        body.innerHTML = originalFormHTML;

        // restore values
        popup.querySelector('#visitorName').value = name;
        popup.querySelector('#visitorInstitution').value = institution;
        popup.querySelector('#visitorType').value = type;
        popup.querySelector('#visitorSource').value = source;
        popup.querySelector('#visitorExperience').value = experience;
        popup.querySelector('#visitorMessage').value = messageVal;

        bindSubmit(); // rebind handler after DOM reset
      });
    });
  }

  bindSubmit();
}

function visitorInfoDenied() {
  const popup = document.querySelector('.popup');
  if (!popup) return;

  const body = popup.querySelector('.popup-body');
  const footer = popup.querySelector('.popup-footer');

  if (footer) footer.style.display = 'none';

  if (body) {
    body.innerHTML = `
      <div class="access-status">
        <div class="circle"></div>
        <div class="status-text">Processing...</div>
      </div>
    `;

    setTimeout(() => {
      const circleEl = body.querySelector('.circle');
      if (circleEl) circleEl.style.display = 'none';

      body.innerHTML = `
        <div class="access-status">
          <div class="cross">‚ùå</div>
          <div class="status-text" style="color:#dc2626;">Access Denied ‚Äî Please try again</div>
        </div>
      `;
    }, 800);
  }

  setTimeout(() => {
    closePopup();
  }, 1800);
}


// ====== Share popup + rating ======
function showSharePopup() {
  if (document.querySelector('.popup')) return; 

  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.innerHTML = `
    <div class="popup-content">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <h2>üöÄEnjoying this amazing website?</h2>
      <p>Help us grow! Share this website:</p>
      <div style="display: flex; justify-content: space-around; flex-wrap: wrap; padding: 10px;">
        <a href="https://wa.me/?text=https://boradrankctg.github.io/rank/" target="_blank"><img src="https://img.icons8.com/color/48/whatsapp.png" alt="WhatsApp" width="36"></a>
        <a href="https://www.instagram.com/?url=https://boradrankctg.github.io/rank/" target="_blank"><img src="https://img.icons8.com/color/48/instagram-new.png" alt="Instagram" width="36"></a>
        <a href="https://www.facebook.com/dialog/send?link=https://boradrankctg.github.io/rank/&app_id=YOUR_APP_ID&redirect_uri=https://boradrankctg.github.io/rank/" target="_blank"><img src="https://img.icons8.com/color/48/facebook-messenger.png" alt="Messenger" width="36"></a>
        <a href="mailto:?subject=Check%20this%20awesome%20ranking%20site!&body=https://boradrankctg.github.io/rank/" target="_blank"><img src="https://img.icons8.com/color/48/gmail--v1.png" alt="Email" width="36"></a>
      </div>
      <hr>
      <h3 style="margin-top:10px">‚≠ê Rate this Website:</h3>
      <div id="starContainer" style="font-size: 1.8rem; color: gold; cursor: pointer;">
        <span onclick="rateSite(1)">&#9734;</span>
        <span onclick="rateSite(2)">&#9734;</span>
        <span onclick="rateSite(3)">&#9734;</span>
        <span onclick="rateSite(4)">&#9734;</span>
        <span onclick="rateSite(5)">&#9734;</span>
      </div>
      <textarea id="reviewText" placeholder="Leave your feedback here..." rows="3" style="width: 100%; margin-top: 10px;"></textarea>
      <button onclick="submitReview()">Submit Review</button>
    </div>
  `;

  document.body.appendChild(popup);
  document.body.classList.add('locked');
}

// Auto show share popup once per device after ~2.5 minutes
if (!localStorage.getItem('sharePopupShown')) {
  setTimeout(() => {
    showSharePopup();
    localStorage.setItem('sharePopupShown', '1');
  }, 150000);
}

// Hook share button (safe)
document.getElementById('shareBtn')?.addEventListener('click', showSharePopup);

function rateSite(rating) {
  const stars = document.getElementById('starContainer')?.children || [];
  for (let i = 0; i < stars.length; i++) {
    stars[i].innerHTML = i < rating ? '&#9733;' : '&#9734;';
  }
  localStorage.setItem('userRating', rating);
}

function submitReview() {
  const rating = localStorage.getItem('userRating') || 0;
  const comment = document.getElementById('reviewText')?.value.trim() || '';
  if (!comment && rating == 0) return alert('Please rate or write something.');
  localStorage.setItem('pendingReview', JSON.stringify({ rating, comment }));
  window.location.href = 'review.html';
}


// ====== Minor SEO enhancement (keywords from current data) ======
(function(){
  const words = Array.from(new Set((allData || []).flatMap(s => [ s?.name, s?.Instituation ]).filter(Boolean)));
  if (words.length) upsertMeta('keywords', words.join(', '));
})();
}

scripts\4-routing-data-ui.js {
// 4-routing-data-ui.js ‚Äî Routing, loaders, fetch, mobile filter, Top Schools, URL params, display masking

// ===== Year and Group loaders =====
function loadYear(year) {
  if (year) {
    document.getElementById("selectPrompt")?.style && (document.getElementById("selectPrompt").style.display = "none");
    document.querySelectorAll('.featured-box').forEach(b => b.remove());

    const newUrl = `${location.pathname}?year=${encodeURIComponent(year)}`;
    history.pushState({}, '', newUrl);

    if (currentYear) currentYear.textContent = ` ${year}`;
    if (currentGroup) currentGroup.style.display = 'none';
    if (noDataMessage) noDataMessage.style.display = 'none';

    contentDiv.innerHTML = `
      <p>Select your group:</p>
      <div class="group-buttons">
        <button onclick="loadGroup('${year}', 'Science')">
          <img src="asset/sci.png" alt="Science Icon">Science
        </button>
        <button onclick="loadGroup('${year}', 'Commerce')">
          <img src="asset/com.png" alt="Commerce Icon">Business
        </button>
        <button onclick="loadGroup('${year}', 'Arts')">
          <img src="asset/hum.png" alt="Arts Icon">Humanities
        </button>
      </div>
    `;
  } else {
    contentDiv.innerHTML = '';
  }
}

function loadGroup(year, group) {
  if (currentGroup) {
    currentGroup.style.display = 'inline';
    currentGroup.textContent = `${group} Group`;
  }

  // Update SEO
  const examType = String(year).includes('hsc') ? 'HSC' : 'SSC';
  const formattedYear = String(year).replace('hsc_', '');
  document.title = `BOARD RANK OF ${examType} ${formattedYear} of ${group}`;
  updateSEOForYearGroup(year, group);
  injectDatasetForYearGroup(year, group);
  injectBreadcrumbs(`${location.origin}${location.pathname}`, year, group, null);

  if (yearDropdown) yearDropdown.style.display = 'none';

  contentDiv.innerHTML = `
    <h3 id="examResultHeader"></h3>
    <div class="search-container">
      <label for="searchInput">Search by Name:</label>
      <input type="text" id="searchInput" class="search-input" placeholder="Enter name" oninput="debounce(handleSearchInput, 300)()">
    </div>
    <div class="search-container">
      <label for="searchRollInput">Search by Roll:</label>
      <input type="text" id="searchRollInput" class="search-input" placeholder="Enter roll" oninput="debounce(handleRollSearchInput, 300)()">
    </div>
    <div class="search-container">
      <label for="InstituationDropdown">Select Instituation:</label>
      <select id="InstituationDropdown" onchange="filterByInstituation()"></select>
    </div>

    <button id="resetFilterBtn" style="display: none;" onclick="resetFilter()">Reset Filter</button>
    <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>
    <p id="tableHint" style="margin-top: 20px; font-weight: bold;">
      üí° Click on student names to see detailed result and on school names to see school BASED RANK
    </p>
    <table>
      <thead>
        <tr>
          <th>Serial</th>
          <th>Name</th>
          <th>Roll</th>
          <th>GPA</th>
          <th>Total</th>
          <th>Institution</th>
        </tr>
      </thead>
      <tbody id="studentTableBody"></tbody>
    </table>
    <div class="pagination">
      <button id="firstBtn" onclick="handleFirstButtonClick()">First</button>
      <button id="prevBtn" onclick="handlePrevButtonClick()">Previous</button>
      <span id="paginationInfo">Loading data...</span>
      <button id="nextBtn" onclick="handleNextButtonClick()">Next</button>
      <button id="lastBtn" onclick="handleLastButtonClick()">Last</button>
    </div>
  `;

  const newUrl = `${location.pathname}?year=${encodeURIComponent(year)}&group=${encodeURIComponent(group)}`;
  history.pushState({}, '', newUrl);

  printExamResultHeader(year);
  fetchData(year, group);
  setTimeout(attachSearchSuggestions, 0);
}

function printExamResultHeader(year) {
  const headerElement = document.getElementById('examResultHeader');
  if (headerElement) {
    const examType = String(year).includes('hsc') ? 'HSC' : 'SSC';
    const formattedYear = String(year).replace('hsc_', '');
    headerElement.textContent = `${examType.toUpperCase()} ${formattedYear} Result`;
  }
}


// ===== Data fetch (XOR+Base64 decode for main, plain fetch for individual) =====
async function fetchData(year, group) {
  try { showLoadingIndicator(); } catch(e){}

  const mainDataUrl = `DATA/data_${year}_${group.toLowerCase()}.txt`;
  const individualDataUrl = `DATA/data_${year}_${group.toLowerCase()}_individual.txt`;

  try {
    const [mainData, individualData] = await Promise.all([
      fetchAndDecode(mainDataUrl, "MySecretKey123"),
      fetch(individualDataUrl).then(r => r.text()).catch(()=> null)
    ]);

    window.__br_currentDatasetMeta = { year, group };

    processData(mainData, individualData);
    populateInstituationDropdown();
    enableInstitutionSearchDropdown();
    createTopInstitutionsButton();
    try { hideLoadingIndicator(); } catch(e){}
  } catch (error) {
    console.error('Error loading data:', error);
    try { hideLoadingIndicator({ forceError: true, errorMessage: 'Unable to load files ‚Äî check your connection.' }); } catch(e){}
    if (noDataMessage) noDataMessage.style.display = 'block';
  }
}

// Switch select ‚Üí datalist for institution search
function enableInstitutionSearchDropdown() {
  const dropdown = document.getElementById('InstituationDropdown');
  if (!dropdown) return;

  dropdown.outerHTML = `
    <input list="institutionList" id="InstituationDropdown" placeholder="Type school name..." class="search-input" onchange="filterByInstituation()">
    <datalist id="institutionList">
      ${Array.from(InstituationSet).map(inst => `<option value="${inst}">`).join('')}
    </datalist>
  `;
}

// Override to open full school view from the institution selector (input or select)
function filterByInstituation() {
  const input = document.getElementById('InstituationDropdown');
  const val = (input && input.value || '').trim();
  if (!val) return resetFilter();
  showSchoolRanking(val);
}


// ===== Top Institutions + Mobile Filter =====
function createTopInstitutionsButton() {
  const resetBtn = document.getElementById('resetFilterBtn');
  if (!resetBtn) return;

  const topBtn = document.createElement('button');
  topBtn.id = 'topSchoolsBtn';
  topBtn.innerHTML = '<i class="ri-trophy-line" aria-hidden="true"></i><span>Top Schools</span>';
  topBtn.className = 'btn-pill btn-top-schools';
  topBtn.style.marginLeft = '10px';
  topBtn.onclick = showTopInstitutions;
  resetBtn.insertAdjacentElement('afterend', topBtn);

  const filterBtn = document.createElement('button');
  filterBtn.id = 'mobileFilterBtn';
  filterBtn.innerHTML = '<i class="ri-filter-3-line" aria-hidden="true"></i><span>Filter</span>';
  filterBtn.className = 'btn-pill btn-mobile-filter';
  filterBtn.style.marginLeft = '8px';
  filterBtn.addEventListener('click', openMobileFilter);
  topBtn.insertAdjacentElement('afterend', filterBtn);

  injectMobileFilterStyles();
  ensureMobileFilterUI();
}

function injectMobileFilterStyles() {
  if (document.getElementById('mfStyle')) return;
  const css = `
/* Add your mobile filter styles here if needed */
  `;
  const el = document.createElement('style'); el.id='mfStyle'; el.textContent = css; document.head.appendChild(el);
}

function ensureMobileFilterUI() {
  if (document.getElementById('mfDrawer')) return;
  const overlay = document.createElement('div'); overlay.className='mf-overlay'; overlay.id='mfOverlay';
  const drawer = document.createElement('aside'); drawer.className='mf-drawer'; drawer.id='mfDrawer';
  drawer.innerHTML = `
    <div class="mf-head">
      <div class="mf-title">Filter</div>
      <button class="mf-close" id="mfCloseBtn" aria-label="Close">‚úï</button>
    </div>
    <div class="mf-body">
      <div class="mf-section" id="mfTotal">
        <h4>Total</h4>
        <div class="mf-range">
          <div class="mf-dual">
            <div class="mf-track"></div>
            <div class="mf-track-fill" id="mfTrackFill"></div>
            <input id="mfRangeMin" type="range">
            <input id="mfRangeMax" type="range">
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <input id="mfTotalMin" type="number" placeholder="Min">
            <input id="mfTotalMax" type="number" placeholder="Max">
          </div>
        </div>
      </div>
      <div class="mf-section" id="mfGpa">
        <h4>GPA</h4>
        <div class="mf-chips" id="mfGpaChips"></div>
      </div>
      <div class="mf-section" id="mfSchool">
        <h4>School</h4>
        <div class="mf-search"><input id="mfSchoolSearch" type="text" placeholder="Search school"></div>
        <div class="mf-list" id="mfSchoolList"></div>
      </div>
    </div>
    <div class="mf-foot">
      <button class="mf-reset" id="mfResetBtn">Reset</button>
      <button class="mf-apply" id="mfApplyBtn">Apply</button>
    </div>
  `;
  document.body.appendChild(overlay);
  document.body.appendChild(drawer);

  document.getElementById('mfCloseBtn').addEventListener('click', closeMobileFilter);
  document.getElementById('mfOverlay')?.addEventListener('click', closeMobileFilter);
  document.getElementById('mfApplyBtn').addEventListener('click', applyMobileFilters);
  document.getElementById('mfResetBtn').addEventListener('click', resetMobileFilters);
  document.getElementById('mfSchoolSearch').addEventListener('input', filterSchoolList);

  populateMobileFilterOptions();
  attachMobileFilterLiveListeners();
}

function openMobileFilter() {
  if (localStorage.getItem('userLoggedIn') !== 'true') {
   if (typeof requireLogin === 'function') {
  requireLogin('Please log in to access advanced filters.');
} else {
  alert('Please log in to access advanced filters.');
}
    return;
  }
  document.getElementById('mfOverlay')?.classList.add('open');
  document.getElementById('mfDrawer')?.classList.add('open');
  try { history.pushState({ mf:true }, '', location.href); } catch(e){}
  window.addEventListener('popstate', mfPopCloseOnce, { once:true });
}

function closeMobileFilter() {
  document.getElementById('mfOverlay')?.classList.remove('open');
  document.getElementById('mfDrawer')?.classList.remove('open');
}
function mfPopCloseOnce() { closeMobileFilter(); }

function populateMobileFilterOptions() {
  if (!Array.isArray(allData) || !allData.length) return;

  const totals = allData.map(s=>parseInt(s.total)).filter(n=>!isNaN(n));
  const minT = Math.min(...totals), maxT = Math.max(...totals);

  const rMin = document.getElementById('mfRangeMin');
  const rMax = document.getElementById('mfRangeMax');
  const nMin = document.getElementById('mfTotalMin');
  const nMax = document.getElementById('mfTotalMax');
  [rMin,rMax,nMin,nMax].forEach(el=>{ if (el) { el.min=minT; el.max=maxT; } });
  if (rMin) rMin.value = nMin.value = minT;
  if (rMax) rMax.value = nMax.value = maxT;

  function drawTrackFill(){
    const fill = document.getElementById('mfTrackFill');
    if (!fill || !rMin || !rMax) return;
    const min = parseInt(rMin.min), max = parseInt(rMin.max);
    const a = (parseInt(rMin.value)-min)/(max-min)*100;
    const b = (parseInt(rMax.value)-min)/(max-min)*100;
    fill.style.left = a+'%';
    fill.style.right = (100-b)+'%';
  }

  const clamp = () => {
    let a = Math.min(parseInt(rMin.value), parseInt(rMax.value));
    let b = Math.max(parseInt(rMin.value), parseInt(rMax.value));
    rMin.value = a; rMax.value = b; nMin.value = a; nMax.value = b; drawTrackFill();
  };
  const syncFromNum = () => {
    let a = Math.max(minT, Math.min(maxT, parseInt(nMin.value||minT)));
    let b = Math.max(minT, Math.min(maxT, parseInt(nMax.value||maxT)));
    if (a>b) [a,b] = [b,a];
    rMin.value = a; rMax.value = b; drawTrackFill();
  };

  rMin?.addEventListener('input', clamp);
  rMax?.addEventListener('input', clamp);
  nMin?.addEventListener('input', syncFromNum);
  nMax?.addEventListener('input', syncFromNum);
  drawTrackFill();

  const gpas = Array.from(new Set(allData.map(s=>s.gpa).filter(x=>x!==undefined && !isNaN(x)))).sort((a,b)=>b-a);
  const gWrap = document.getElementById('mfGpaChips'); if (gWrap) gWrap.innerHTML='';
  gpas.forEach(val=>{
    const div = document.createElement('label'); div.className='mf-chip';
    div.innerHTML = `<input type="checkbox" name="mfGpa" value="${val}"><span>${val.toFixed ? val.toFixed(2) : val}</span>`;
    gWrap?.appendChild(div);
  });

  const schools = Array.from(new Set(allData.map(s => (s.Instituation || '').trim()).filter(Boolean)))
    .sort((a, b) => {
      const rankA = allData.find(s => (s.Instituation || '').trim() === a)?.TopSchools || Infinity;
      const rankB = allData.find(s => (s.Instituation || '').trim() === b)?.TopSchools || Infinity;
      return rankA - rankB;
    });

  const sWrap = document.getElementById('mfSchoolList'); if (sWrap) sWrap.innerHTML='';
  schools.forEach(name=>{
    const safe = name.replace(/"/g,'&quot;');
    const div = document.createElement('label'); div.className='mf-item';
    div.innerHTML = `<input type="checkbox" name="mfSchool" value="${safe}"><span>${safe}</span>`;
    sWrap?.appendChild(div);
  });

  // rebind listeners after rendering
  attachMobileFilterLiveListeners();
}

function attachMobileFilterLiveListeners() {
  const liveApply = debounce(applyMobileFilters, 120);
  ['mfRangeMin','mfRangeMax','mfTotalMin','mfTotalMax'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('input', liveApply);
  });
  document.querySelectorAll('#mfGpaChips input[type=checkbox], #mfSchoolList input[type=checkbox]').forEach(cb => {
    cb.addEventListener('change', liveApply);
  });
}

function filterSchoolList(){
  const q = (document.getElementById('mfSchoolSearch')?.value || '').trim().toLowerCase();
  document.querySelectorAll('#mfSchoolList .mf-item').forEach(el=>{
    const txt = el.textContent.toLowerCase();
    el.style.display = txt.includes(q)?'flex':'none';
  });
}

function applyMobileFilters(){
  const nMin = parseInt(document.getElementById('mfTotalMin')?.value || '0', 10);
  const nMax = parseInt(document.getElementById('mfTotalMax')?.value || '999999', 10);
  const gpaVals = Array.from(document.querySelectorAll('input[name="mfGpa"]:checked')).map(x=>parseFloat(x.value));
  const schoolVals = Array.from(document.querySelectorAll('input[name="mfSchool"]:checked')).map(x=>x.value);

  const nameQ = document.getElementById('searchInput') ? document.getElementById('searchInput').value.trim().toLowerCase() : '';
  const rollQ = document.getElementById('searchRollInput') ? document.getElementById('searchRollInput').value.trim() : '';
  const instSelEl = document.getElementById('InstituationDropdown');
  const instSel = instSelEl && instSelEl.value ? instSelEl.value : '';

  filteredData = allData.filter(s=>{
    const totOK = !isNaN(s.total) && s.total>=nMin && s.total<=nMax;
    const gpaOK = gpaVals.length? gpaVals.includes(parseFloat(s.gpa)) : true;
    const schOK = schoolVals.length? schoolVals.includes(s.Instituation) : true;
    const nameOK = nameQ ? String(s.name).toLowerCase().includes(nameQ) : true;
    const rollOK = rollQ ? String(s.roll).includes(rollQ) : true;
    const instOK = instSel ? (s.Instituation || '').trim().toLowerCase() === instSel.trim().toLowerCase() : true;
    return totOK && gpaOK && schOK && nameOK && rollOK && instOK;
  });

  currentPage = 1;
  updatePage();
  closeMobileFilter();
}

function resetMobileFilters(){
  document.querySelectorAll('#mfGpaChips input[type=checkbox], #mfSchoolList input[type=checkbox]').forEach(cb=>cb.checked=false);
  populateMobileFilterOptions();
  applyMobileFilters();
}
function showTopInstitutions() {
  if (localStorage.getItem('userLoggedIn') !== 'true') {
    if (typeof requireLogin === 'function') {
  requireLogin('Please log in to access Top Schools.');
} else {
  alert('Please log in to access Top Schools.');
}
    return;
  }
  const topSchools = {};

  allData.forEach(student => {
    const school = student.Instituation;
    if (!topSchools[school]) {
      topSchools[school] = { gpa5Count: 0, totalMarks: 0, count: 0, top1000Count: 0 };
    }
    if (student.gpa === 5.0) topSchools[school].gpa5Count += 1;
    topSchools[school].totalMarks += student.total;
    topSchools[school].count += 1;
  });

  allData.slice(0, 1000).forEach(student => {
    const school = student.Instituation;
    if (topSchools[school]) topSchools[school].top1000Count++;
  });

  const schoolArray = Object.entries(topSchools)
    .filter(([_, stats]) => stats.count >= 20)
    .map(([name, stats]) => {
      const gpa5Percent = (stats.gpa5Count / stats.count) * 100;
      return {
        name,
        gpa5Percent: gpa5Percent.toFixed(2),
        gpa5Count: stats.gpa5Count,
        avgTotal: (stats.totalMarks / stats.count).toFixed(1),
        top1000Count: stats.top1000Count,
        studentCount: stats.count
      };
    });

  schoolArray.sort((a, b) => {
    const percentDiff = parseFloat(b.gpa5Percent) - parseFloat(a.gpa5Percent);
    if (percentDiff !== 0) return percentDiff;
    return parseFloat(b.avgTotal) - parseFloat(a.avgTotal);
  });

  const top100 = schoolArray.slice(0, 100);

  contentDiv.innerHTML = `
    <h2> Top 100 Institutions - ${currentGroup.textContent} ${currentYear.textContent}</h2>
    <button onclick="loadGroup('${currentYear.textContent.trim()}', '${currentGroup.textContent.split(' ')[0]}')">Back</button>
    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Institution</th>
          <th>GPA 5.00 %</th>
          <th>Total GPA 5.00</th>
          <th>Avg Total</th>
          <th>Top 1000 Students</th>
          <th>Total Students</th>
        </tr>
      </thead>
      <tbody>
        ${top100.map((school, i) => `
          <tr>
            <td>${i + 1}</td>
            <td>${school.name}</td>
            <td>${school.gpa5Percent}%</td>
            <td>${school.gpa5Count}</td>
            <td>${school.avgTotal}</td>
            <td>${school.top1000Count}</td>
            <td>${school.studentCount}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
}


// ===== Featured year click animation to selection =====
function handleFeaturedClick(yearValue, el) {
  const box = el || document.querySelector(`.featured-box[data-value="${yearValue}"]`);
  if (!box) return;

  box.style.transition = "all 0.4s ease";
  box.style.opacity = "0";
  box.style.transform = "scale(0.9)";

  setTimeout(() => {
    box.style.display = "none";
    const dropdown = document.getElementById("yearDropdown");
    if (dropdown) {
      dropdown.value = yearValue;
      dropdown.style.display = 'none';
    }
    loadYear(yearValue);
  }, 400);
}


// ===== URL param handling =====
function handleURLParams() {
  const params = new URLSearchParams(window.location.search);
  const year = params.get('year');
  const group = params.get('group');
  const roll = params.get('roll');

  if (year && group) {
    if (yearDropdown) { yearDropdown.value = year; yearDropdown.style.display = 'none'; }

    document.getElementById("selectPrompt")?.remove();
    document.querySelectorAll('.featured-box').forEach(b => b.remove());

    if (currentYear) currentYear.textContent = ` ${year}`;
    if (currentGroup) { currentGroup.textContent = `${group} Group`; currentGroup.style.display = 'inline'; }

    contentDiv.innerHTML = `
      <h3 id="examResultHeader"></h3>
      <div class="search-container">
        <label for="searchInput">Search by Name:</label>
        <input type="text" id="searchInput" class="search-input" placeholder="Enter name" oninput="debounce(handleSearchInput, 300)()">
      </div>
      <div class="search-container">
        <label for="searchRollInput">Search by Roll:</label>
        <input type="text" id="searchRollInput" class="search-input" placeholder="Enter roll" oninput="debounce(handleRollSearchInput, 300)()">
      </div>
      <div class="search-container">
        <label for="InstituationDropdown">Select Institution:</label>
        <select id="InstituationDropdown" onchange="filterByInstituation()"></select>
      </div>
      <button id="resetFilterBtn" style="display: none;" onclick="resetFilter()">Reset Filter</button>
      <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>
      <p id="tableHint" style="margin-top: 20px; font-weight: bold;">
        üí° Click on student names to see detailed result and on school names to see school BASED RANK
      </p>
      <table>
        <thead>
          <tr>
            <th>Serial</th>
            <th>Name</th>
            <th>Roll</th>
            <th>GPA</th>
            <th>Total</th>
            <th>Institution</th>
          </tr>
        </thead>
        <tbody id="studentTableBody"></tbody>
      </table>
      <div class="pagination">
        <button id="firstBtn" onclick="handleFirstButtonClick()">First</button>
        <button id="prevBtn" onclick="handlePrevButtonClick()">Previous</button>
        <span id="paginationInfo">Loading data...</span>
        <button id="nextBtn" onclick="handleNextButtonClick()">Next</button>
        <button id="lastBtn" onclick="handleLastButtonClick()">Last</button>
      </div>
    `;

    printExamResultHeader(year);
    fetchData(year, group);
    setTimeout(attachSearchSuggestions, 0);

    if (roll) {
      setTimeout(() => { showIndividualResult(roll, year, group); }, 1000);
    }
    const school = params.get('school');
    if (school) {
      setTimeout(() => { showSchoolRanking(school); }, 1000);
    }
  } else if (year) {
    loadYear(year);
    if (yearDropdown) yearDropdown.value = year;
  } else {
    contentDiv.innerHTML = '';
  }
}

// Popstate routing (close popup if open; otherwise route params)
window.addEventListener('popstate', function () {
  const params = new URLSearchParams(window.location.search);
  const year = params.get('year');
  const group = params.get('group');
  const roll = params.get('roll');

  if (document.querySelector('.popup')) {
    closePopup();
    return;
  }

  if (year && group && roll) {
    showIndividualResult(roll, year, group);
  } else if (year && group) {
    loadGroup(year, group);
  } else if (year) {
    loadYear(year);
  } else {
    location.reload();
  }
});


// ===== Scroll to top button visibility =====
var scrollToTopBtn = document.getElementById("scrollToTopBtn");
window.onscroll = function() { scrollFunction(); };
function scrollFunction() {
  if (!scrollToTopBtn) return;
  if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
    scrollToTopBtn.style.display = "block";
  } else {
    scrollToTopBtn.style.display = "none";
  }
}


// ===== Display/masking controls hook (names/rolls visibility + name search toggle) =====
(function(){
  window.__br_applying = window.__br_applying || false;

  function maskWord(w){
    const s = String(w || '');
    if (s.length <= 2) return s.replace(/.(?=.)/g, '*');
    return s[0] + '*'.repeat(s.length - 2) + s[s.length - 1];
  }
  function maskName(full){
    return String(full || '').split(/\s+/).map(maskWord).join(' ');
  }
  function maskRollStr(r){
    const s = String(r || '').trim();
    if (s.length <= 2) return s.replace(/.(?=.)/g, '*');
    return s[0] + '*'.repeat(Math.max(0, s.length - 2)) + s[s.length - 1];
  }
  function safeSetText(el, val){
    if (el && el.textContent !== val) el.textContent = val;
  }

  function applyToTable(){
    const ds = window.__br_displaySettings || {};
    const showNames = (ds.showNames !== false);
    const showRolls = (ds.showRolls !== false);

    document.querySelectorAll('.student-name h3').forEach(el=>{
      if (!el.dataset.originalText) el.dataset.originalText = el.textContent || '';
      const newVal = showNames ? el.dataset.originalText : maskName(el.dataset.originalText);
      safeSetText(el, newVal);
    });

    document.querySelectorAll('.student-roll').forEach(el=>{
      if (!el.dataset.originalRoll) el.dataset.originalRoll = (el.textContent || '').trim();
      const newVal = showRolls ? el.dataset.originalRoll : maskRollStr(el.dataset.originalRoll);
      safeSetText(el, newVal);
    });
  }

  function applyToPopup(){
    const ds = window.__br_displaySettings || {};
    const showNames = (ds.showNames !== false);
    const showRolls = (ds.showRolls !== false);

    const pop = document.querySelector('.popup .popup-content');
    if (!pop) return;

    pop.querySelectorAll('p').forEach(p=>{
      const t = p.textContent || '';
      if (/^Name:\s*/i.test(t)) {
        const cur = t.replace(/^Name:\s*/i, '').trim();
        if (!p.dataset.originalText) p.dataset.originalText = cur;
        const newVal = 'Name: ' + (showNames ? p.dataset.originalText : maskName(p.dataset.originalText));
        safeSetText(p, newVal);
      } else if (/^Roll:\s*/i.test(t)) {
        const cur = t.replace(/^Roll:\s*/i, '').trim();
        if (!p.dataset.originalRoll) p.dataset.originalRoll = cur;
        const newVal = 'Roll: ' + (showRolls ? p.dataset.originalRoll : maskRollStr(p.dataset.originalRoll));
        safeSetText(p, newVal);
      }
    });
  }

  function applyNameSearchToggle(){
    const ds = window.__br_displaySettings || {};
    const enableNameSearch = (ds.nameSearch !== false);
    const nameInput = document.getElementById('searchInput');

    if (nameInput) {
      nameInput.disabled = !enableNameSearch;
      nameInput.placeholder = enableNameSearch ? 'Enter name' : 'Name search is disabled for now';
      if (!enableNameSearch) {
        nameInput.value = '';
      }
    }
  }

  window.applyDisplaySettingsToDOM = function(){
    if (window.__br_applying) return;
    window.__br_applying = true;
    try {
      applyToTable();
      applyToPopup();
      applyNameSearchToggle();
    } catch (e) {
      console.error('applyDisplaySettingsToDOM error:', e);
    } finally {
      window.__br_applying = false;
    }
  };

  if (typeof updateTableData === 'function' && !window.__br_wrap_updateTableData_v2) {
    window.__br_wrap_updateTableData_v2 = true;
    const _orig = updateTableData;
    window.updateTableData = function(){
      const r = _orig.apply(this, arguments);
      setTimeout(()=>window.applyDisplaySettingsToDOM(), 0);
      return r;
    };
  }

  if (typeof showSchoolRanking === 'function' && !window.__br_wrap_showSchoolRanking_v2) {
    window.__br_wrap_showSchoolRanking_v2 = true;
    const _orig2 = showSchoolRanking;
    window.showSchoolRanking = function(){
      const r = _orig2.apply(this, arguments);
      setTimeout(()=>window.applyDisplaySettingsToDOM(), 0);
      return r;
    };
  }

  const obs = new MutationObserver((muts)=>{
    let addedPopup = false;
    for (const m of muts) {
      for (const n of m.addedNodes) {
        if (n.nodeType === 1 && (n.matches?.('.popup') || n.querySelector?.('.popup'))) {
          addedPopup = true;
          break;
        }
      }
      if (addedPopup) break;
    }
    if (addedPopup) setTimeout(()=>window.applyDisplaySettingsToDOM(), 0);
  });
  obs.observe(document.body, { childList:true, subtree:true });
})();

// Kick off by reading URL state
handleURLParams();
}

scripts\admin-2.js {
    // Subtle parallax for hero blobs (optional)
    (function(){
      const hero = document.querySelector('.hero.hero-pro');
      if (!hero) return;
      const blobs = hero.querySelectorAll('.blob');
      let raf = 0;
      function onMove(e){
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=>{
          const r = hero.getBoundingClientRect();
          const cx = (e.clientX - r.left) / r.width - 0.5;
          const cy = (e.clientY - r.top) / r.height - 0.5;
          blobs.forEach((b, i)=>{
            const depth = (i+1)*5;
            b.style.transform = `translate3d(${cx*depth*6}px, ${cy*depth*-6}px, 0)`;
          });
        });
      }
      hero.addEventListener('mousemove', onMove);
      hero.addEventListener('mouseleave', ()=>{ blobs.forEach(b=>b.style.transform='translate3d(0,0,0)'); });
    })();

}

scripts\admin.js {
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove, set, get, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  
// --- Project 1: boardrankctg (DATABASE) ---
const dbConfig = {
  apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
  authDomain: "boardrankctg.firebaseapp.com",
  databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "boardrankctg",
  storageBucket: "boardrankctg.appspot.com",
  messagingSenderId: "751761229963",
  appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e"
};
const dbApp = initializeApp(dbConfig, "dbApp"); 
const db = getDatabase(dbApp);

// --- Project 2: boardrank-c095a (AUTH) ---
const authConfig = {
  apiKey: "AIzaSyAwUqYxrhyEZDmvlQaUB7tuVtXP1ZYdKfI",
  authDomain: "boardrank-c095a.firebaseapp.com",
  projectId: "boardrank-c095a",
  storageBucket: "boardrank-c095a.appspot.com",
  messagingSenderId: "953246350478",
  appId: "1:953246350478:web:xxxxxxxxxxxxxxxx" // ‚Üê copy exact value from Firebase settings
};
const authApp = initializeApp(authConfig, "authApp");
const auth = getAuth(authApp);

    const ADMIN_UID = "m2yGng2JRBfvG5MKGf5A977t5Az2";
  
    const main = document.querySelector('main');
    const container = document.getElementById("visitorsContainer");
    // Live banned map
    const bannedRef = ref(db, "bannedDevices");
  let bannedMap = {};
    let visitorsEntriesCache = [];
  let visitorsLimit = 100;
  onValue(bannedRef, (snap) => {
    bannedMap = snap.val() || {};
    // Re-render to refresh badges/buttons (lightweight; keeps it simple)
    if (typeof loadVisitors === 'function') {
      try { loadVisitors(); } catch (e) {}
    }
  });

    // Login box
    const loginHtml = `
  <div id="adminLoginBox" style="max-width:900px;margin:10px auto;padding:12px;border-radius:8px;background:#fff;">
    <div style="display:flex;align-items:center;gap:10px;">
      <input id="adminEmail" placeholder="Admin email" style="padding:8px;flex:1;" />
      <input id="adminPassword" type="text" placeholder="Password" style="padding:8px;width:180px;" />
      <button id="loginBtn">Login</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </div>
    <div id="loginError" style="color:#b71c1c;margin-top:6px;"></div>
  </div>
`;
main.insertAdjacentHTML('afterbegin', loginHtml);

  
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginError = document.getElementById('loginError');
  
(function(){
  const email = (localStorage.getItem('userEmail') || '').toLowerCase();
  if (email === 'hasnyne2007@gmail.com') {
    document.getElementById('adminLoginBox').style.display = 'none';
    initAnnouncementPanel();
    initDisplayControlsPanel();
    loadVisitors();
    initPollPanel();
  } else {
    document.getElementById('adminLoginBox').style.display = 'block';
    container.innerHTML = `<tr><td colspan="10" style="text-align:center;color:#b71c1c;">
      Admin access required. Please login with admin email at the Login page.
    </td></tr>`;
  }
})();

  
    loginBtn.addEventListener('click', async () => {
      loginError.textContent = '';
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value;
      if (!email || !password) {
        loginError.textContent = 'Enter email and password.';
        return;
      }
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
  console.error('Login failed:', err);
  loginError.textContent = 'Login failed: ' + (err.message || err.code);
}

    });
  
    logoutBtn.addEventListener('click', async () => {
      await signOut(auth);
      location.reload();
    });
  
       function loadVisitors() {
      const visitorsRef = ref(db, "visitors");
      onValue(visitorsRef, (snapshot) => {
        const visitors = snapshot.val() || {};
        visitorsEntriesCache = Object.entries(visitors).reverse();
        renderVisitorsTable();
      });
    }

    function renderVisitorsTable() {
      container.innerHTML = "";
      const entries = visitorsEntriesCache;
      if (!entries.length) {
        container.innerHTML = '<tr><td colspan="11" style="text-align:center;">No visitors yet.</td></tr>';
        return;
      }

      let count = entries.length;
      const slice = entries.slice(0, visitorsLimit);

      slice.forEach(([id, visitor]) => {
        const escapeHtml = (str) => String(str || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        const tr = document.createElement('tr');
        tr.innerHTML = `
  <td>${count--}</td>
  <td>${escapeHtml(visitor.name || '')}</td>
  <td>${escapeHtml(visitor.type || '')}</td>
  <td>${escapeHtml(visitor.source || '')}</td>
  <td>${escapeHtml(visitor.institution || '')}</td>
  <td>${escapeHtml(visitor.experience || '')}</td>
  <td>${visitor.message ? '<div class="visitor-message">' + escapeHtml(visitor.message) + '</div>' : ''}</td>
  <td>${escapeHtml(visitor.deviceData?.deviceModel || 'Unknown')}</td>
  <td>${escapeHtml(visitor.fingerprint || '‚Äî')}</td>
  <td>${visitor.timestamp ? new Date(visitor.timestamp).toLocaleString() : ''}</td>
  <td data-fp="${escapeHtml(visitor.fingerprint || '')}">
    <span class="ban-badge" style="color:#b91c1c;font-weight:900;margin-right:8px;">
      ${(visitor.fingerprint && bannedMap[visitor.fingerprint]) ? 'BANNED' : ''}
    </span>
    ${
      visitor.fingerprint
        ? (bannedMap[visitor.fingerprint]
            ? `<button onclick="unbanFingerprint('${escapeHtml(visitor.fingerprint)}')">‚úÖ Unban</button>`
            : `<button onclick="banFingerprint('${escapeHtml(visitor.fingerprint)}', '${escapeHtml(visitor.name || '')}', '${escapeHtml(visitor.deviceData?.deviceModel || '')}')">üö´ Ban</button>`)
        : '<span style="color:#666">No FP</span>'
    }
    <button onclick="deleteVisitor('${id}')" style="margin-left:6px">üóëÔ∏è Delete</button>
  </td>
        `;
        container.appendChild(tr);
      });

      // Load More button
      const mainEl = document.querySelector('main');
      let loadBtn = document.getElementById('loadMoreVisitorsBtn');
      if (entries.length > visitorsLimit) {
        if (!loadBtn && mainEl) {
          loadBtn = document.createElement('button');
          loadBtn.id = 'loadMoreVisitorsBtn';
          loadBtn.textContent = 'Load More';
          loadBtn.className = 'btn-secondary';
          loadBtn.style.margin = '12px auto';
          loadBtn.style.display = 'block';
          mainEl.appendChild(loadBtn);
          loadBtn.addEventListener('click', () => {
            visitorsLimit += 100;
            renderVisitorsTable();
          });
        } else if (loadBtn) {
          loadBtn.style.display = 'block';
        }
      } else if (loadBtn) {
        loadBtn.style.display = 'none';
      }
    }
    function initAnnouncementPanel() {
    if (document.getElementById('annPanel')) return;

    const html = `
      <section id="annPanel" style="max-width:900px;margin:12px auto;padding:12px;border:2px solid #0ea5e9;border-radius:10px;background:#f0f9ff;">
        <h3 style="margin:6px 0;">üì¢ Global Announcement</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <select id="annType" style="padding:8px;border:1px solid #ccc;border-radius:8px;">
            <option value="info">Info (blue)</option>
            <option value="warning">Warning (amber)</option>
            <option value="success">Success (green)</option>
            <option value="danger">Danger (red)</option>
          </select>
          <label style="display:flex;align-items:center;gap:6px;">
            <input type="checkbox" id="annActive" /> Active
          </label>
        </div>
        <textarea id="annMsg" rows="2" placeholder="Type the banner message..." style="width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px;"></textarea>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <input id="annBtnText" placeholder="Button text (optional)" style="flex:1;padding:8px;border:1px solid #ccc;border-radius:8px;">
          <input id="annBtnUrl" placeholder="https://example.com (optional)" style="flex:2;padding:8px;border:1px solid #ccc;border-radius:8px;">
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
          <button id="annSaveBtn">Publish / Update</button>
          <button id="annClearBtn" style="background:#e5e7eb;color:#111;border:1px solid #d1d5db;">Clear</button>
        </div>
        <div id="annStatus" style="margin-top:6px;color:#065f46;font-weight:700;"></div>
      </section>
    `;
    document.querySelector('main').insertAdjacentHTML('afterbegin', html);

    // Load current
    onValue(ref(db, 'announcements/global'), (snap) => {
      const v = snap.val() || {};
      document.getElementById('annType').value = v.type || 'info';
      document.getElementById('annActive').checked = !!v.active;
      document.getElementById('annMsg').value = v.message || '';
      document.getElementById('annBtnText').value = v.buttonText || '';
      document.getElementById('annBtnUrl').value = v.buttonUrl || '';
    });

    document.getElementById('annSaveBtn').addEventListener('click', async () => {
      const payload = {
        type: document.getElementById('annType').value,
        active: document.getElementById('annActive').checked,
        message: document.getElementById('annMsg').value.trim(),
        buttonText: document.getElementById('annBtnText').value.trim(),
        buttonUrl: document.getElementById('annBtnUrl').value.trim(),
        updatedAt: Date.now(),
        by: (auth.currentUser && auth.currentUser.uid) ? auth.currentUser.uid : 'admin'
      };
      try {
        await set(ref(db, 'announcements/global'), payload);
        document.getElementById('annStatus').textContent = 'Saved. Live in real-time.';
        setTimeout(() => document.getElementById('annStatus').textContent = '', 2000);
      } catch (e) {
        alert('Save failed: ' + (e.message || e.code));
      }
    });

    document.getElementById('annClearBtn').addEventListener('click', async () => {
      try {
        await set(ref(db, 'announcements/global'), { active: false, message: '', updatedAt: Date.now() });
        document.getElementById('annStatus').textContent = 'Cleared.';
        setTimeout(() => document.getElementById('annStatus').textContent = '', 2000);
      } catch (e) {
        alert('Clear failed: ' + (e.message || e.code));
      }
    });
  }

    window.deleteVisitor = function(id) {
      if (!confirm("Delete this visitor?")) return;
      remove(ref(db, `visitors/${id}`)).catch(err => {
        alert('Delete failed ‚Äî permission denied.');
      });
    };

    function initDisplayControlsPanel() {
  if (document.getElementById('displayControls')) return;
  const html = `
    <section id="displayControls" style="max-width:900px;margin:12px auto;padding:12px;border:2px solid #334155;border-radius:10px;background:#f8fafc;">
      <h3 style="margin:6px 0;">üõ†Ô∏è Display Controls (Global)</h3>
      <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:center;">
        <label><input type="checkbox" id="optNameSearch" checked /> Name Search</label>
        <label><input type="checkbox" id="optShowNames" checked /> Show Name</label>
        <label><input type="checkbox" id="optShowRolls" checked /> Show Roll</label>
      </div>
      <small style="display:block;margin-top:6px;color:#555;">Changes apply for everyone in real-time.</small>
    </section>
  `;
  const ann = document.getElementById('annPanel');
  (ann ? ann : document.querySelector('main')).insertAdjacentHTML('afterend', html);

  const dRef = ref(db, 'displaySettings');
  onValue(dRef, (snap) => {
    const v = snap.val() || {};
    document.getElementById('optNameSearch').checked = (v.nameSearch !== false);
    document.getElementById('optShowNames').checked = (v.showNames !== false);
    document.getElementById('optShowRolls').checked = (v.showRolls !== false);
  });

  document.getElementById('optNameSearch').addEventListener('change', e => update(dRef, { nameSearch: e.target.checked, updatedAt: Date.now() }));
  document.getElementById('optShowNames').addEventListener('change', e => update(dRef, { showNames: e.target.checked, updatedAt: Date.now() }));
  document.getElementById('optShowRolls').addEventListener('change', e => update(dRef, { showRolls: e.target.checked, updatedAt: Date.now() }));
}









     // Parse duration like "30m", "2h", "3d", "1w" or "forever"
  window.parseBanDuration = function(str) {
    if (!str) return null;
    const s = String(str).trim().toLowerCase();
    if (s === 'forever' || s === 'permanent' || s === 'perm') return -1;
    const m = s.match(/^(\d+)\s*(m|h|d|w)$/);
    if (!m) return null;
    const qty = parseInt(m[1], 10);
    const unit = m[2];
    const mult = unit === 'm' ? 60000
               : unit === 'h' ? 3600000
               : unit === 'd' ? 86400000
               : 604800000; // weeks
    return Date.now() + qty * mult;
  };

  window.banFingerprint = async function(fp, name = '', deviceModel = '') {
    if (!fp) return alert('No fingerprint found for this visitor.');
    const reason = prompt('Reason for ban (shown to user):', 'Policy violation');
    if (reason === null) return;
    const durationStr = prompt('Duration (examples: 30m, 2h, 3d, 1w, forever):', '2h');
    if (durationStr === null) return;

    const until = window.parseBanDuration(durationStr);
    if (until === null) return alert('Invalid duration. Use 30m, 2h, 3d, 1w, or forever');

    const data = {
      reason,
      until,
      createdAt: Date.now(),
      by: (auth.currentUser && auth.currentUser.uid) ? auth.currentUser.uid : 'admin',
      name,
      deviceModel
    };

    try {
      await set(ref(db, 'bannedDevices/' + fp), data);
      alert('Device banned.');
    } catch (e) {
      console.error('Ban failed:', e);
      alert('Ban failed: ' + (e.message || e.code));
    }
  };

  window.unbanFingerprint = async function(fp) {
    if (!fp) return;
    if (!confirm('Unban this device?')) return;
    try {
      await remove(ref(db, 'bannedDevices/' + fp));
      alert('Device unbanned.');
    } catch (e) {
      console.error('Unban failed:', e);
      alert('Unban failed: ' + (e.message || e.code));
    }
  };
  function initPollPanel() {
  if (document.getElementById('pollPanel')) return;
  const html = `
    <section id="pollPanel" style="max-width:900px;margin:12px auto;padding:12px;border:2px solid #7c3aed;border-radius:10px;background:#faf5ff;">
      <h3 style="margin:6px 0;">üìä Site Poll</h3>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <label><input type="checkbox" id="pollActive"> Active</label>
        <label><input type="checkbox" id="pollRequired"> Compulsory (Required)</label>
      </div>
      <input id="pollQ" placeholder="Poll question..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-top:8px;">
      <div id="pollOpts" style="margin-top:8px;display:grid;gap:8px;"></div>
      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
        <button id="pollAddOpt">+ Add option</button>
        <button id="pollSave">Publish / Update</button>
        <button id="pollClear" style="background:#e5e7eb;color:#111;border:1px solid #d1d5db;">Clear config</button>
        <button id="pollReset" style="background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;">Reset votes</button>
      </div>
      <div id="pollStatus" style="margin-top:6px;color:#065f46;font-weight:800;"></div>
      <div id="pollStats" style="margin-top:10px;"></div>
    </section>
  `;
  document.querySelector('main').insertAdjacentHTML('afterbegin', html);

  const optsWrap = document.getElementById('pollOpts');
  const addOpt = (val='') => {
    const row = document.createElement('div');
    row.style = 'display:flex;gap:8px;align-items:center;';
    row.innerHTML = `
      <input class="pollOpt" placeholder="Option..." value="${String(val).replace(/"/g,'&quot;')}"
             style="flex:1;padding:10px;border:1px solid #ddd;border-radius:8px;">
      <button class="rm">√ó</button>
    `;
    row.querySelector('.rm').addEventListener('click', ()=> row.remove());
    optsWrap.appendChild(row);
  };

  document.getElementById('pollAddOpt').addEventListener('click', ()=> addOpt());

  // Load current config + live results
  onValue(ref(db, 'polls/global'), (snap) => {
    const v = snap.val() || {};
    document.getElementById('pollActive').checked = !!v.active;
    document.getElementById('pollRequired').checked = !!v.required;
    document.getElementById('pollQ').value = v.question || '';
    optsWrap.innerHTML = '';
    (Array.isArray(v.options) ? v.options : []).forEach(o => addOpt(o));

    // Live vote counts (admin sees exact numbers)
    const pid = v.id || 'global';
    onValue(ref(db, 'pollVotes/' + pid), (vs) => {
      const votes = vs.val() || {};
      const counts = (Array.isArray(v.options) ? v.options : []).map(()=>0);
      Object.values(votes).forEach(rec => {
        const i = Number(rec?.opt);
        if (!isNaN(i) && counts[i] !== undefined) counts[i] += 1;
      });
      const total = counts.reduce((a,b)=>a+b,0);
      const rows = (v.options || []).map((o,i) => {
        const c = counts[i] || 0;
        const pct = total ? Math.round(c*100/total) : 0;
        return `
          <tr>
            <td>${i+1}</td>
            <td>${o}</td>
            <td><b>${c}</b></td>
            <td>${pct}%</td>
          </tr>
        `;
      }).join('');
      document.getElementById('pollStats').innerHTML = `
        <h4 style="margin:6px 0;">Live results</h4>
        <table border="1" style="width:100%;border-collapse:collapse;">
          <thead>
            <tr><th>#</th><th>Option</th><th>Votes</th><th>%</th></tr>
          </thead>
          <tbody>${rows}</tbody>
          <tfoot>
            <tr>
              <td colspan="2" style="text-align:right;font-weight:900;">Total</td>
              <td><b>${total}</b></td>
              <td>${total ? '100%' : '‚Äî'}</td>
            </tr>
          </tfoot>
        </table>
      `;
    });
  });

  // Save config
  document.getElementById('pollSave').addEventListener('click', async () => {
    const active = document.getElementById('pollActive').checked;
    const required = document.getElementById('pollRequired').checked;
    const question = document.getElementById('pollQ').value.trim();
    const options = Array.from(document.querySelectorAll('.pollOpt'))
      .map(i=>i.value.trim()).filter(Boolean);
    if (!question || options.length < 2) {
      alert('Enter a question and at least 2 options.');
      return;
    }
    const cur = (await get(ref(db, 'polls/global'))).val() || {};
    const cfg = {
      id: cur.id || ('poll_' + Date.now()),
      active, required, question, options,
      updatedAt: Date.now()
    };
    try {
      await set(ref(db, 'polls/global'), cfg);
      document.getElementById('pollStatus').textContent = 'Saved. Poll is live.';
      setTimeout(()=> document.getElementById('pollStatus').textContent = '', 1800);
    } catch (e) {
      alert('Save failed: ' + (e.message || e.code));
    }
  });

  // Clear config
  document.getElementById('pollClear').addEventListener('click', async () => {
    try {
      await set(ref(db, 'polls/global'), { active:false, required:false, question:'', options:[], updatedAt: Date.now() });
      document.getElementById('pollStatus').textContent = 'Cleared.';
      setTimeout(()=> document.getElementById('pollStatus').textContent = '', 1500);
    } catch (e) {
      alert('Clear failed: ' + (e.message || e.code));
    }
  });

  // Reset votes only (keep question/options)
  document.getElementById('pollReset').addEventListener('click', async () => {
    try {
      const cur = (await get(ref(db, 'polls/global'))).val() || {};
      if (!cur.id) return alert('No active poll to reset.');
      if (!confirm('Reset all poll votes?')) return;
      await remove(ref(db, 'pollVotes/' + cur.id));
      document.getElementById('pollStatus').textContent = 'Votes reset.';
      setTimeout(()=> document.getElementById('pollStatus').textContent = '', 1500);
    } catch (e) {
      alert('Reset failed: ' + (e.message || e.code));
    }
  });
}

}

scripts\app.js {
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, runTransaction, set, onValue, get, update, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
  authDomain: "boardrankctg.firebaseapp.com",
  databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "boardrankctg",
  storageBucket: "boardrankctg.firebasestorage.app",
  messagingSenderId: "751761229963",
  appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e",
  measurementId: "G-3Y6J44NWNH"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
window.db = db;
window.__br_lock_banner = false;
window.__br_lock_poll = false;
window.__br_lock_display = false;

(function(){
try {
const liveEl = document.getElementById('liveVisits');
if (!liveEl) return;

onValue(ref(db, "siteStats/totalVisits"), (snap) => {
  const v = Number(snap.val() || 0);
  liveEl.textContent = v.toLocaleString();
}, (err) => {
  console.error('TotalVisits listener error', err);
});

get(ref(db, "siteStats/totalVisits")).then((snap) => {
  const v = Number(snap.val() || 0);
  if (liveEl.textContent === '‚Äî' || liveEl.textContent === '') {
    liveEl.textContent = v.toLocaleString();
  }
}).catch(()=>{});
} catch(e) {
console.error('TotalVisits setup error', e);
}
})();

window.clickCountsCache = {};
window._br_clickListenerSet = new Set();
window.__br_hiddenRolls = new Set();

function initHiddenResultsListener() {
  try {
    const hrRef = ref(db, 'hiddenResults');
    onValue(hrRef, (snap) => {
      const obj = snap.val() || {};
      window.__br_hiddenRolls = new Set(Object.keys(obj));
      try { if (typeof window.updateTableData === 'function') window.updateTableData(); } catch(e){}
    });
  } catch (e) { console.error('hiddenResults listener failed', e); }
}

window.hideResultRoll = async function(roll) {
  try {
    await set(ref(db, 'hiddenResults/' + String(roll)), { on: true, at: Date.now() });
    alert('Hidden for everyone (except admin).');
  } catch (e) { alert('Failed: ' + (e.message || e.code)); }
};
window.unhideResultRoll = async function(roll) {
  try {
    await remove(ref(db, 'hiddenResults/' + String(roll)));
    alert('Unhidden.');
  } catch (e) { alert('Failed: ' + (e.message || e.code)); }
};

window.incrementClickCount = function(roll) {
  if (!window.db) {
    console.error("DB not ready for incrementClickCount");
    return;
  }
  try {
    const clickRef = ref(window.db, `clickCounts/${roll}`);
    runTransaction(clickRef, (count) => {
      return (count || 0) + 1;
    }).catch(err => console.error('incrementClickCount error', err));
  } catch (e) {
    console.error('incrementClickCount exception', e);
  }
};

window.listenClickCount = function(roll, cb) {
  if (!window.db) {
    console.error("DB not ready for listenClickCount");
    cb(0);
    return;
  }
  try {
    const clickRef = ref(window.db, `clickCounts/${roll}`);
    onValue(clickRef, (snap) => {
      const val = snap.val() || 0;
      window.clickCountsCache[roll] = val;
      cb(val);
    });
  } catch (e) {
    console.error('listenClickCount exception', e);
    cb(0);
  }
};

let userId = localStorage.getItem("userId");
if (!userId) {
  userId = crypto.randomUUID();
  localStorage.setItem("userId", userId);
}

function __isAdminEmail() {
  return (localStorage.getItem('userEmail') || '').toLowerCase() === 'hasnyne2007@gmail.com';
}
function initAdminLockListener() {
  try {
    const lockRef = ref(db, 'adminLock');
    onValue(lockRef, (snap) => {
      const v = snap.val() || {};
      window.__br_lock_banner = !!v.banner;
      window.__br_lock_poll = !!v.poll;
      window.__br_lock_display = !!v.displaySettings;
      // You can log to console if you want:
      // console.log('Admin lock updated:', v);
    });
  } catch (e) {
    console.error('Admin lock listener failed', e);
  }
}


function trackVisit() {
  runTransaction(ref(db, "siteStats/totalVisits"), (count) => (count || 0) + 1);
  set(ref(db, `siteStats/activeUsers/${userId}`), Date.now());
}

function showAdminStats() {
  const box = document.createElement("div");
  box.className = "admin-stats-box";
  box.innerHTML = `<h3>üìä Site Stats (Admin Only)</h3><div id="visitStats">Loading...</div>`;
  document.body.appendChild(box);

  const statsRef = ref(db, "siteStats");

  onValue(statsRef, (snapshot) => {
    const data = snapshot.val() || {};
    const total = data.totalVisits || 0;
    const active = data.activeUsers || {};
    const now = Date.now();
    const live = Object.values(active).filter(ts => now - ts < 5 * 60 * 1000).length;

    document.getElementById("visitStats").innerHTML = `
      üëÅÔ∏è Total Visits: <strong>${total}</strong><br />
      üü¢ Live Visitors (past 5 min): <strong>${live}</strong>
    `;
  });
}

trackVisit();
initAdminLockListener();       // NEW: read adminLock from DB
initAnnouncementsListener();
initDisplaySettingsListener();
initPollFeature();
initHiddenResultsListener();
initPollFeature();
checkAndEnforceBan();

if (__isAdminEmail()) showAdminStats();
function __deriveFingerprintFallback() {
  const ua = navigator.userAgent || '';
  const platform = navigator.platform || '';
  const screenRes = `${screen.width}x${screen.height}`;
  const deviceMemory = navigator.deviceMemory || '';
  const cores = navigator.hardwareConcurrency || '';
  const vendor = navigator.vendor || '';
  const seed = `${ua}|${platform}|${screenRes}|${deviceMemory}|${cores}|${vendor}`;
  let h = 5381;
  for (let i = 0; i < seed.length; i++) {
    h = ((h << 5) + h) + seed.charCodeAt(i);
    h = h & 0xffffffff;
  }
  return (h >>> 0).toString(16);
}

async function __getFingerprint() {
  try {
    if (typeof getDeviceDataAndFingerprint === 'function') {
      const v = getDeviceDataAndFingerprint();
      if (v && v.fingerprint) return v.fingerprint;
    }
  } catch (e) {}
  return __deriveFingerprintFallback();
}

function startBanCountdown(until) {
  const timer = document.getElementById('banTimer');
  if (!timer) return;
  clearInterval(window.__banTick);
  if (until === -1) {
    timer.textContent = 'Permanent ban';
    return;
  }
  function tick() {
    const ms = until - Date.now();
    if (ms <= 0) {
      timer.textContent = 'Ban expired. Reloading...';
      setTimeout(() => location.reload(), 1200);
      clearInterval(window.__banTick);
      return;
    }
    const s = Math.floor(ms / 1000);
    const d = Math.floor(s / 86400);
    const h = Math.floor((s % 86400) / 3600);
    const m = Math.floor((s % 3600) / 60);
    const ss = s % 60;
    timer.textContent = `Time left: ${d}d ${h}h ${m}m ${ss}s`;
  }
  tick();
  window.__banTick = setInterval(tick, 1000);
}
function initAnnouncementsListener() {
  const annRef = ref(db, 'announcements/global');
  onValue(annRef, (snap) => {
    const banner = document.getElementById('annBanner');
    if (!banner) return;

    // If locked, never show banner (ignore DB contents)
    if (window.__br_lock_banner) {
      banner.style.display = 'none';
      return;
    }

    const v = snap.val() || {};

    if (v.active && v.message) {
      banner.style.display = 'block';
      banner.className = `ann-banner type-${v.type || 'info'}`;
      const textEl = document.getElementById('annText');
      const btnEl = document.getElementById('annBtn');
      textEl.textContent = v.message || '';
      if (v.buttonText && v.buttonUrl) {
        btnEl.style.display = 'inline-block';
        btnEl.textContent = v.buttonText;
        btnEl.href = v.buttonUrl;
      } else {
        btnEl.style.display = 'none';
      }
    } else {
      banner.style.display = 'none';
    }
  });
}

async function checkAndEnforceBan() {
  const fp = await __getFingerprint();
  const bRef = ref(db, 'bannedDevices/' + fp);
  onValue(bRef, (snap) => {
    const ban = snap.val();
    const overlay = document.getElementById('banOverlay');
    if (!overlay) return;

    const active = ban && (ban.until === -1 || Number(ban.until) > Date.now());
    if (active) {
      overlay.style.display = 'flex';
      document.body.classList.add('ban-locked');
      const reason = ban.reason || '‚Äî';
      const until = Number(ban.until);
      document.getElementById('banReason').textContent = `Reason: ${reason}`;
      document.getElementById('banUntil').textContent = (until === -1)
        ? 'Until: Permanent'
        : 'Until: ' + new Date(until).toLocaleString();
      startBanCountdown(until);

      const stopper = (e) => { e.stopPropagation(); e.preventDefault(); };
      window.addEventListener('keydown', stopper, { capture: true });
      window.addEventListener('click', stopper, { capture: true });
    } else {
      overlay.style.display = 'none';
      document.body.classList.remove('ban-locked');
      clearInterval(window.__banTick);
    }
  });
}

function initDisplaySettingsListener() {
  try {
    const dRef = ref(db, 'displaySettings');
    onValue(dRef, (snap) => {
      if (window.__br_lock_display) {
        // When locked, force safe defaults
        window.__br_displaySettings = {
          nameSearch: true,
          showNames: true,
          showRolls: true
        };
      } else {
        window.__br_displaySettings = snap.val() || {};
      }
      if (typeof window.applyDisplaySettingsToDOM === 'function') {
        window.applyDisplaySettingsToDOM();
      }
    });
  } catch (e) {
    console.error('Display settings listener failed', e);
  }
}
function initPollFeature() {
  try {
    const pRef = ref(db, 'polls/global');
    onValue(pRef, (snap) => {
      // If locked, completely ignore polls
      if (window.__br_lock_poll) return;

      const poll = snap.val() || {};
      if (!poll.active || !Array.isArray(poll.options) || poll.options.length === 0) return;

      const pid = poll.id || 'global';
      const seenKey = 'poll_seen_' + pid;
      const votedKey = 'poll_voted_' + pid;

      if (localStorage.getItem(votedKey) || localStorage.getItem(seenKey)) return;

      setTimeout(() => {
        if (document.querySelector('.popup')) return;
        renderPollPopup(poll);
      }, 600);
    });
  } catch (e) {
    console.error('initPollFeature failed', e);
  }
}

function renderPollPopup(poll) {
  const pid = poll.id || 'global';
  const required = !!poll.required;

  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.innerHTML = `
    <div class="popup-content poll-box">
      ${required ? '' : '<span class="close-btn" onclick="closePopup()">&times;</span>'}
      <div class="poll-head">
        <div class="poll-emoji">üó≥Ô∏è</div>
        <div class="poll-title">${poll.question || 'Quick poll'}</div>
      </div>
      <div class="poll-optgrid" id="pollOptsUser">
        ${poll.options.map((opt,i)=>`
          <label class="poll-chip" data-idx="${i}">
            <input type="radio" name="pollOpt" value="${i}">
            <span>${opt}</span>
          </label>
        `).join('')}
      </div>

      <div class="poll-actions">
        ${required ? '' : '<button class="btn-secondary" id="pollSkipBtn">Skip</button>'}
        <button class="btn-primary" id="pollVoteBtn">Submit</button>
      </div>

      <div id="pollUserStats" class="poll-stats"></div>
    </div>
  `;
  document.body.appendChild(popup);
  document.body.classList.add('locked');

  document.querySelectorAll('.poll-chip').forEach(ch => {
    ch.addEventListener('click', () => {
      document.querySelectorAll('.poll-chip').forEach(c => c.classList.remove('active'));
      ch.classList.add('active');
      const r = ch.querySelector('input[type=radio]');
      if (r) r.checked = true;
    });
  });

  const pidSeen = 'poll_seen_' + pid;
  const pidVoted = 'poll_voted_' + pid;

  document.getElementById('pollSkipBtn')?.addEventListener('click', () => {
    localStorage.setItem(pidSeen, '1');
    closePopup();
  });

  document.getElementById('pollVoteBtn').addEventListener('click', async () => {
    const sel = document.querySelector('input[name="pollOpt"]:checked');
    if (!sel) { alert('Pick an option'); return; }
    await submitPollVote(poll, Number(sel.value));
  });
}

async function submitPollVote(poll, idx) {
  try {
    const pid = poll.id || 'global';
    const fp = await __getFingerprint();
    await set(ref(db, 'pollVotes/' + pid + '/' + fp), { opt: idx, at: Date.now() });
    localStorage.setItem('poll_voted_' + pid, '1');

    const statsBox = document.getElementById('pollUserStats');
    statsBox.innerHTML = `<div style="font-weight:800">Calculating results‚Ä¶</div>`;

    const snap = await get(ref(db, 'pollVotes/' + pid));
    const votes = snap.val() || {};
    const counts = poll.options.map(()=>0);
    Object.values(votes).forEach(rec => {
      const i = Number(rec?.opt);
      if (!isNaN(i) && counts[i] !== undefined) counts[i] += 1;
    });

    const total = counts.reduce((a,b)=>a+b,0);

    const rows = poll.options.map((o,i)=>{
      const c = counts[i] || 0;
      const pct = total ? Math.round(c*100/total) : 0;
      return `
        <div class="poll-row">
          <div class="poll-row-text">${o}</div>
          <div class="poll-bar">
            <div class="poll-bar-fill" style="width:${pct}%"></div>
          </div>
          <div class="poll-pct">${pct}%</div>
        </div>
      `;
    }).join('');

    statsBox.innerHTML = `
      <div class="poll-results">
        <div class="poll-results-title">Live percentages</div>
        ${rows}
        <div class="poll-total">Total votes: ${total}</div>
      </div>
      <div style="display:flex;justify-content:center;margin-top:12px;">
        <button class="btn-secondary" onclick="closePopup()">Close</button>
      </div>
    `;
  } catch (e) {
    alert('Vote failed: ' + (e.message || e.code));
  }
}

}

scripts\contact.js {
    function composeMessage() {
      const name = (document.getElementById("userName").value || "").trim();
      const message = (document.getElementById("userMessage").value || "").trim();
      return { name, message, full: name && message ? `Hi, I'm ${name}. ${message}` : "" };
    }

    document.getElementById("btnWhatsapp").addEventListener("click", () => {
      const { name, message, full } = composeMessage();
      if (!name || !message) return alert("Please fill in both your name and message.");
      const url = `https://wa.me/8801788481222?text=${encodeURIComponent(full)}`;
      window.open(url, "_blank", "noopener");
    });


    document.getElementById("btnCopy").addEventListener("click", async () => {
      const { name, message, full } = composeMessage();
      if (!name || !message) return alert("Please fill in both your name and message.");
      try {
        await navigator.clipboard.writeText(full);
        alert("Message copied to clipboard.");
      } catch {
        const t = document.createElement("textarea");
        t.value = full;
        document.body.appendChild(t);
        t.select();
        document.execCommand("copy");
        document.body.removeChild(t);
        alert("Message copied to clipboard.");
      }
    });
}

scripts\remove.js {
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      set,
      get,
      onValue,
      update,
      query,
      orderByChild,
      equalTo
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    
    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e",
      measurementId: "G-3Y6J44NWNH",
    };
    
    // === Init Firebase ===
    console.log('Initializing Firebase...');
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    console.log('Firebase initialized successfully');
    
    // === User ID ===
    let userId = localStorage.getItem("userId");
    if (!userId) {
      userId = crypto.randomUUID ? crypto.randomUUID() : 'user_' + Date.now() + '_' + Math.random().toString(36);
      localStorage.setItem("userId", userId);
    }
  const ADMIN_EMAIL = (localStorage.getItem('userEmail') || '').toLowerCase();
const isAdmin = ADMIN_EMAIL === 'hasnyne2007@gmail.com';


    // === Show/Hide Admin Section ===
    if (isAdmin) {
      document.getElementById('adminSection').style.display = 'block';
      document.getElementById('userSection').style.display = 'none';
      loadAdminRequests();
    } else {
      loadUserRequests();
    }

    // === Submit Removal Request (with better error handling) ===
    async function submitRemovalRequest() {
      console.log('Submit button clicked');
      
      try {
        // Clear previous errors
        document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

        // Get form values
        const examType = document.getElementById('examType').value;
        const examYear = document.getElementById('examYear').value;
        const streamGroup = document.getElementById('streamGroup').value;
        const studentName = document.getElementById('studentName').value.trim();
        const rollNumber = document.getElementById('rollNumber').value.trim();
        const regNumber = document.getElementById('regNumber').value.trim();
        const removalReason = document.getElementById('removalReason').value.trim();

        console.log('Form values:', { examType, examYear, streamGroup, studentName, rollNumber, regNumber });

        // Validate
        let hasError = false;
        
        if (!examType || !examYear || !streamGroup) {
          alert('Please select exam type, year, and stream/group.');
          return;
        }

        if (!studentName || studentName.length < 3) {
          document.getElementById('nameError').textContent = 'Name must be at least 3 characters.';
          hasError = true;
        }

        if (!rollNumber || rollNumber.length < 4) {
          document.getElementById('rollError').textContent = 'Please enter a valid roll number.';
          hasError = true;
        }

        if (!regNumber || regNumber.length < 4) {
          document.getElementById('regError').textContent = 'Please enter a valid registration number.';
          hasError = true;
        }

        if (hasError) {
          console.log('Validation failed');
          return;
        }

        console.log('Validation passed, checking for duplicates...');

        // Check for duplicate request
        try {
          const existingQuery = query(
            ref(db, 'removalRequests'),
            orderByChild('rollNumber'),
            equalTo(rollNumber)
          );
          
          const snapshot = await get(existingQuery);
          if (snapshot.exists()) {
            const existing = Object.values(snapshot.val());
            const hasPending = existing.some(req => 
              req.examType === examType && 
              req.examYear === examYear && 
              req.status === 'pending'
            );
            
            if (hasPending) {
              alert('You already have a pending request for this roll number.');
              return;
            }
          }
        } catch (dupError) {
          console.log('Duplicate check error (continuing):', dupError);
          // Continue anyway if duplicate check fails
        }

        // Show processing state
        document.getElementById('requestForm').style.display = 'none';
        document.getElementById('statusDisplay').style.display = 'block';
        document.getElementById('statusSpinner').style.display = 'block';
        document.getElementById('statusTitle').textContent = 'Submitting Request...';
        document.getElementById('statusMessage').textContent = 'Please wait while we process your request.';

        console.log('Submitting to Firebase...');

        // Submit to Firebase
        const newRequestRef = push(ref(db, 'removalRequests'));
        const requestData = {
          examType,
          examYear,
          streamGroup,
          studentName,
          rollNumber,
          regNumber,
          removalReason: removalReason || 'No reason provided',
          status: 'pending',
          userId: userId,
          timestamp: Date.now(),
          requestId: newRequestRef.key
        };
        
        console.log('Saving data:', requestData);
        await set(newRequestRef, requestData);
        
        console.log('Successfully saved to Firebase');

        // Update UI for success
        document.getElementById('statusSpinner').style.display = 'none';
        document.getElementById('statusTitle').innerHTML = '<i class="fas fa-check-circle" style="color:#22c55e;"></i> Request Submitted';
        document.getElementById('statusMessage').innerHTML = `
          Your removal request has been submitted successfully.<br>
          <strong>Status: Waiting for admin approval</strong><br>
          <small style="color:#64748b;">Request ID: ${newRequestRef.key}</small>
        `;
        document.getElementById('statusActions').style.display = 'block';

        // Clear form
        document.getElementById('examType').value = '';
        document.getElementById('examYear').value = '';
        document.getElementById('streamGroup').value = '';
        document.getElementById('studentName').value = '';
        document.getElementById('rollNumber').value = '';
        document.getElementById('regNumber').value = '';
        document.getElementById('removalReason').value = '';

        // Reload user's requests
        loadUserRequests();

      } catch (error) {
        console.error('Firebase Error:', error);
        alert('Error submitting request: ' + error.message + '\n\nPlease check console for details.');
        
        document.getElementById('statusSpinner').style.display = 'none';
        document.getElementById('statusTitle').innerHTML = '<i class="fas fa-times-circle" style="color:#ef4444;"></i> Submission Failed';
        document.getElementById('statusMessage').innerHTML = 'Error: ' + error.message;
        document.getElementById('statusActions').style.display = 'block';
      }
    }
    
    // IMPORTANT: Expose function to global scope
    window.submitRemovalRequest = submitRemovalRequest;
    console.log('submitRemovalRequest function attached to window');

    // === Submit New Request ===
    function submitNewRequest() {
      document.getElementById('requestForm').style.display = 'block';
      document.getElementById('statusDisplay').style.display = 'none';
      document.getElementById('statusActions').style.display = 'none';
    }
    window.submitNewRequest = submitNewRequest;

    // === Load User's Requests ===
    function loadUserRequests() {
      console.log('Loading user requests...');
      const userRequestsRef = query(
        ref(db, 'removalRequests'),
        orderByChild('userId'),
        equalTo(userId)
      );

      onValue(userRequestsRef, (snapshot) => {
        const container = document.getElementById('userRequests');
        const listContainer = document.getElementById('userRequestsList');
        
        if (!snapshot.exists()) {
          console.log('No existing requests found');
          container.style.display = 'none';
          return;
        }

        console.log('Found user requests:', snapshot.size);
        container.style.display = 'block';
        listContainer.innerHTML = '';

        const requests = [];
        snapshot.forEach((child) => {
          requests.push({ id: child.key, ...child.val() });
        });

        // Sort by timestamp (newest first)
        requests.sort((a, b) => b.timestamp - a.timestamp);

        requests.forEach(req => {
          const statusColor = 
            req.status === 'approved' ? '#22c55e' :
            req.status === 'rejected' ? '#ef4444' :
            '#f59e0b';

          const statusIcon = 
            req.status === 'approved' ? 'check-circle' :
            req.status === 'rejected' ? 'times-circle' :
            'clock';

          const requestCard = document.createElement('div');
          requestCard.className = 'review-box';
          requestCard.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:start;">
              <div>
                <strong>${req.examType} ${req.examYear} - ${req.streamGroup}</strong>
                <div style="color:#64748b; font-size:0.9rem; margin-top:4px;">
                  Roll: ${req.rollNumber} | Reg: ${req.regNumber}
                </div>
                <div style="color:#64748b; font-size:0.85rem;">
                  ${new Date(req.timestamp).toLocaleString()}
                </div>
              </div>
              <div style="text-align:right;">
                <span style="color:${statusColor}; font-weight:bold;">
                  <i class="fas fa-${statusIcon}"></i> ${req.status.toUpperCase()}
                </span>
              </div>
            </div>
            ${req.adminNote ? `
              <div style="margin-top:10px; padding:8px; background:#f3f4f6; border-radius:6px;">
                <strong>Admin Note:</strong> ${req.adminNote}
              </div>
            ` : ''}
          `;
          listContainer.appendChild(requestCard);
        });
      }, (error) => {
        console.error('Error loading user requests:', error);
      });
    }

    // === Admin Functions ===
    let currentFilter = 'all';

    function filterRequests(status) {
      currentFilter = status;
      loadAdminRequests();
    }
    window.filterRequests = filterRequests;

    function loadAdminRequests() {
      if (!isAdmin) return;
      
      console.log('Loading admin requests...');
      const requestsRef = ref(db, 'removalRequests');
      
      onValue(requestsRef, (snapshot) => {
        const tbody = document.getElementById('adminRequestsTable');
        
        if (!snapshot.exists()) {
          tbody.innerHTML = '<tr><td colspan="10" style="text-align:center;">No requests found.</td></tr>';
          return;
        }

        tbody.innerHTML = '';
        const allRequests = [];

        snapshot.forEach((child) => {
          const req = child.val();
          req.id = child.key;
          
          if (currentFilter === 'all' || req.status === currentFilter) {
            allRequests.push(req);
          }
        });

        // Sort by timestamp (newest first)
        allRequests.sort((a, b) => b.timestamp - a.timestamp);

        if (allRequests.length === 0) {
          tbody.innerHTML = '<tr><td colspan="10" style="text-align:center;">No requests found.</td></tr>';
          return;
        }

        allRequests.forEach(req => {
          const row = document.createElement('tr');
          const statusColor = 
            req.status === 'approved' ? '#22c55e' :
            req.status === 'rejected' ? '#ef4444' :
            '#f59e0b';

          row.innerHTML = `
            <td>${new Date(req.timestamp).toLocaleDateString()}</td>
            <td><strong>${req.studentName}</strong></td>
            <td>${req.examType}</td>
            <td>${req.examYear}</td>
            <td>${req.streamGroup}</td>
            <td>${req.rollNumber}</td>
            <td>${req.regNumber}</td>
            <td><small>${req.removalReason || 'N/A'}</small></td>
            <td><span style="color:${statusColor}; font-weight:bold;">${req.status.toUpperCase()}</span></td>
            <td>
              ${req.status === 'pending' ? `
                <button onclick="approveRequest('${req.id}')" style="background:#22c55e; color:#fff; padding:4px 8px; margin:2px;">
                  <i class="fas fa-check"></i> Approve
                </button>
                <button onclick="rejectRequest('${req.id}')" style="background:#ef4444; color:#fff; padding:4px 8px; margin:2px;">
                  <i class="fas fa-times"></i> Reject
                </button>
              ` : `
                <small style="color:#64748b;">Processed</small>
              `}
            </td>
          `;
          tbody.appendChild(row);
        });
      }, (error) => {
        console.error('Error loading admin requests:', error);
        const tbody = document.getElementById('adminRequestsTable');
        tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; color:red;">Error loading requests. Check console.</td></tr>';
      });
    }

    // === Approve Request ===
    async function approveRequest(requestId) {
      const note = prompt('Add a note for the user (optional):');
      
      try {
        await update(ref(db, `removalRequests/${requestId}`), {
          status: 'approved',
          processedAt: Date.now(),
          processedBy: userId,
          adminNote: note || 'Your request has been approved.'
        });
        
        alert('Request approved successfully!');
      } catch (error) {
        console.error('Error approving request:', error);
        alert('Failed to approve request: ' + error.message);
      }
    }
    window.approveRequest = approveRequest;

    // === Reject Request ===
    async function rejectRequest(requestId) {
      const note = prompt('Reason for rejection:');
      
      if (!note) {
        alert('Please provide a reason for rejection.');
        return;
      }
      
      try {
        await update(ref(db, `removalRequests/${requestId}`), {
          status: 'rejected',
          processedAt: Date.now(),
          processedBy: userId,
          adminNote: note
        });
        
        alert('Request rejected.');
      } catch (error) {
        console.error('Error rejecting request:', error);
        alert('Failed to reject request: ' + error.message);
      }
    }
    window.rejectRequest = rejectRequest;
}

scripts\review.js {
 import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      set,
      get,
      onValue,
      runTransaction,
      remove,
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // =========================
    // Firebase
    // =========================
    const firebaseConfig = {
      apiKey: "AIzaSyBaKVrTWKeaUxa0EaiDBR8OGpGCAjxAcUA",
      authDomain: "boardrankctg.firebaseapp.com",
      databaseURL: "https://boardrankctg-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "boardrankctg",
      storageBucket: "boardrankctg.firebasestorage.app",
      messagingSenderId: "751761229963",
      appId: "1:751761229963:web:43f9dbf71feef6dc9cec8e",
      measurementId: "G-3Y6J44NWNH",
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // =========================
    // Helpers & User State
    // =========================
    const ADMIN_EMAIL = "hasnyne2007@gmail.com"; // update if needed
    const PAGE_SIZE = 10;

    let allReviewsEntries = []; // [[id, review], ...]
    let currentSort = "top"; // "top" | "new"
    let visibleCount = PAGE_SIZE;

    function getOrCreateAnonId() {
      let uid = localStorage.getItem("anonUserId");
      if (!uid) {
        uid = (self.crypto?.randomUUID?.() || "u_" + Math.random().toString(36).slice(2));
        localStorage.setItem("anonUserId", uid);
      }
      return uid;
    }
    const anonUserId = getOrCreateAnonId();

    function isLoggedIn() {
      return localStorage.getItem("userLoggedIn") === "true";
    }
    function currentUserId() {
      return localStorage.getItem("loggedInUserId") || anonUserId;
    }
    function currentUserEmail() {
      return (localStorage.getItem("userEmail") || "").toLowerCase();
    }
    function isAdmin() {
      return currentUserEmail() === ADMIN_EMAIL.toLowerCase();
    }
    function esc(s) {
      return String(s || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
    // Safe fallback if other scripts don‚Äôt define it
    window.requireLogin = window.requireLogin || function (msg) {
      alert(msg || "Please log in to continue.");
      window.location.href = "login.html";
    };

    // =========================
    // UI: Login state toggle
    // =========================
    function checkLoginStatus() {
      const loggedInForm = document.getElementById("reviewFormLoggedIn");
      const loginPrompt = document.getElementById("loginPrompt");

      if (isLoggedIn()) {
        loggedInForm.style.display = "block";
        loginPrompt.style.display = "none";

        const userName = localStorage.getItem("userName") || "User";
        const nameEl = document.getElementById("reviewingAsName");
        if (nameEl) nameEl.textContent = userName;

        document.querySelectorAll(".logged-in-only").forEach((el) => (el.style.display = "block"));
        document.querySelectorAll(".logged-out-only").forEach((el) => (el.style.display = "none"));
      } else {
        loggedInForm.style.display = "none";
        loginPrompt.style.display = "block";

        document.querySelectorAll(".logged-in-only").forEach((el) => (el.style.display = "none"));
        document.querySelectorAll(".logged-out-only").forEach((el) => (el.style.display = "block"));
      }
    }

    // =========================
    // Stars
    // =========================
    function rateSite(rating) {
      const container = document.getElementById("starContainer");
      if (!container) return;
      const stars = container.children;
      for (let i = 0; i < stars.length; i++) {
        stars[i].textContent = i < rating ? "‚òÖ" : "‚òÜ";
      }
      localStorage.setItem("userRating", String(rating));
    }
    window.rateSite = rateSite;

    // =========================
    // Submit Review
    // =========================
    let isSubmittingReview = false;
    async function submitReview(e) {
      if (e && typeof e.preventDefault === "function") e.preventDefault();
      if (!isLoggedIn()) return requireLogin("Please sign in to submit a review.");
      if (isSubmittingReview) return;

      const btn = document.getElementById("submitReviewBtn");
      const textField = document.getElementById("reviewText");
      const comment = (textField?.value || "").trim();
      const rating = parseInt(localStorage.getItem("userRating") || "0", 10);

      // Clear errors
      const starErr = document.getElementById("starError");
      const commentErr = document.getElementById("commentError");
      if (starErr) starErr.textContent = "";
      if (commentErr) commentErr.textContent = "";

      let hasError = false;
      if (!rating || rating < 1 || rating > 5) {
        if (starErr) starErr.textContent = "Please select a rating";
        hasError = true;
      }
      if (!comment) {
        if (commentErr) commentErr.textContent = "Please write your feedback";
        hasError = true;
      }
      if (hasError) return;

      try {
        isSubmittingReview = true;
        if (btn) { btn.disabled = true; btn.textContent = "Submitting..."; }

        const uid = currentUserId();
        let name = localStorage.getItem("userName") || "Anonymous User";

        // Try to read profile name if exists
        if (isLoggedIn() && uid) {
          try {
            const snap = await get(ref(db, `users/${uid}`));
            if (snap.exists()) {
              const u = snap.val();
              name = u.fullName || u.firstName || name;
            }
          } catch (_) {}
        }

        const newRef = push(ref(db, "reviews"));
        await set(newRef, {
          name,
          comment,
          rating,
          likes: 0,
          dislikes: 0,
          replies: {},
          timestamp: Date.now(),
          userId: uid,
          userEmail: localStorage.getItem("userEmail") || "",
        });

        if (textField) textField.value = "";
        rateSite(0);
        localStorage.removeItem("userRating");

showModal({ title: "Thank you!", message: "Your review has been submitted." });

      } catch (err) {
        console.error("Error submitting review:", err);
showModal({ title: "Couldn‚Äôt submit", message: "Failed to submit review. Please try again." });

      } finally {
        isSubmittingReview = false;
        if (btn) { btn.disabled = false; btn.textContent = "Submit Review"; }
      }
    }
    window.submitReview = submitReview;

    // =========================
    // Replies
    // =========================
    window.submitReply = async function (reviewId) {
      if (!isLoggedIn()) return requireLogin("Please sign in to reply to reviews.");

      const input = document.getElementById(`reply-${reviewId}`);
      const text = (input?.value || "").trim();
      if (!text) return;

      try {
        const uid = currentUserId();
        let userName = localStorage.getItem("userName") || "User";

        // Try to read profile name
        if (uid) {
          try {
            const snap = await get(ref(db, `users/${uid}`));
            if (snap.exists()) {
              const u = snap.val();
              userName = u.fullName || u.firstName || userName;
            }
          } catch (_) {}
        }

        const replyRef = push(ref(db, `reviews/${reviewId}/replies`));
        await set(replyRef, {
          text,
          name: userName,
          isAdmin: isAdmin(),
          userId: uid,
          likes: 0,
          timestamp: Date.now(),
        });

        if (input) input.value = "";
      } catch (error) {
        console.error("Error submitting reply:", error);
showModal({ title: "Couldn‚Äôt submit reply", message: "Please try again." });

      }
    };

    window.deleteReview = async function (id) {
      if (!confirm("Are you sure you want to delete this review?")) return;
      try {
        await remove(ref(db, `reviews/${id}`));
      } catch (e) {
        console.error(e);
showModal({ title: "Delete failed", message: "Failed to delete review." });

      }
    };

    window.deleteReply = async function (reviewId, replyId) {
      if (!confirm("Delete this reply?")) return;
      try {
        await remove(ref(db, `reviews/${reviewId}/replies/${replyId}`));
      } catch (e) {
        console.error(e);
showModal({ title: "Delete failed", message: "Failed to delete reply." });

      }
    };

    window.likeReply = function (reviewId, replyId) {
      const key = `replyLike_${reviewId}_${replyId}`;
      if (localStorage.getItem(key) === "1") return;
      localStorage.setItem(key, "1");
      runTransaction(ref(db, `reviews/${reviewId}/replies/${replyId}/likes`), (v) => (v || 0) + 1);
    };

    // =========================
    // Like / Dislike
    // =========================
    window.voteReview = function (id, type) {
      const key = "reviewVote_" + id;
      const prev = localStorage.getItem(key);
      if (prev === type) return;

      const path = `reviews/${id}/${type === "like" ? "likes" : "dislikes"}`;
      runTransaction(ref(db, path), (v) => (v || 0) + 1);

      if (prev && prev !== type) {
        const undo = `reviews/${id}/${prev === "like" ? "likes" : "dislikes"}`;
        runTransaction(ref(db, undo), (v) => Math.max(0, (v || 0) - 1));
      }
      localStorage.setItem(key, type);
    };

    // =========================
    // Sorting + Pagination
    // =========================
    function getSortedEntries() {
      const entries = allReviewsEntries.slice();
      if (currentSort === "top") {
        // Most liked (desc), tie-breaker: newest first
        entries.sort((a, b) => {
          const lb = (b[1]?.likes || 0), la = (a[1]?.likes || 0);
          if (lb !== la) return lb - la;
          const tb = (b[1]?.timestamp || 0), ta = (a[1]?.timestamp || 0);
          return tb - ta;
        });
      } else {
        // Newest first
        entries.sort((a, b) => (b[1]?.timestamp || 0) - (a[1]?.timestamp || 0));
      }
      return entries;
    }

    function renderReviews() {
      const container = document.getElementById("reviewsContainer");
      const loadMoreBtn = document.getElementById("loadMoreBtn");
      const countEl = document.getElementById("reviewsCount");
      if (!container) return;

      container.innerHTML = "";

      if (!allReviewsEntries.length) {
        container.innerHTML = '<p style="text-align:center; color:#64748b; padding:20px;">No reviews yet. Be the first to review!</p>';
        if (loadMoreBtn) loadMoreBtn.style.display = "none";
        if (countEl) countEl.textContent = "";
        return;
      }

      const uid = currentUserId();
      const admin = isAdmin();

      const entries = getSortedEntries();
      const total = entries.length;
      const limit = Math.min(visibleCount, total);
      const page = entries.slice(0, limit);

      for (const [id, review] of page) {
        const owner = (review.userId === uid) || admin;

        // Replies (ascending by time)
        let repliesHTML = "";
        if (review.replies && typeof review.replies === "object") {
          const replyEntries = Object.entries(review.replies)
            .sort((a, b) => (a[1]?.timestamp || 0) - (b[1]?.timestamp || 0));
          repliesHTML = replyEntries.map(([rid, r]) => {
            const adminTag = r.isAdmin ? `<span class="badge-admin">[ADMIN]</span>` : "";
            const canDelete = r.userId && (r.userId === uid || admin);
            const likeCount = r.likes || 0;
            const replyName = esc(r.name || "Anonymous");
            const replyText = esc(r.text || "");

            return `
              <div class="reply-box">
                ‚Ü™Ô∏è ${adminTag} <strong>${replyName}:</strong> ${replyText}
                <span class="reply-actions">
                  <button class="reply-like-btn" onclick="likeReply('${id}','${rid}')">üëç</button>
                  <span class="reply-like-count" style="font-weight:800;">${likeCount}</span>
                  ${canDelete ? `<button class="reply-del-btn" onclick="deleteReply('${id}','${rid}')">üóëÔ∏è</button>` : ``}
                </span>
              </div>
            `;
          }).join("");
        }

        const safeName = esc(review.name || "Anonymous");
        const safeComment = esc(review.comment || "");
        const ts = review.timestamp ? new Date(review.timestamp).toLocaleString() : "";
        const rating = review.rating || 0;

        container.innerHTML += `
          <div class="review-box">
            <div>
              <strong>${safeName}</strong>
              <small class="muted" style="margin-left: 10px;">${ts}</small>
              <div>‚≠ê ${"‚òÖ".repeat(rating)}${"‚òÜ".repeat(5 - rating)}</div>
            </div>
            <div class="review-comment">${safeComment}</div>
            <div style="margin-top:10px;">
              <button onclick="voteReview('${id}', 'like')">üëç ${review.likes || 0}</button>
              <button onclick="voteReview('${id}', 'dislike')">üëé ${review.dislikes || 0}</button>
              ${
                isLoggedIn()
                  ? `<input type="text" placeholder="Write a reply..." id="reply-${id}" style="width: 60%; margin-left:10px;" />
                     <button onclick="submitReply('${id}')">Reply</button>`
                  : `<a href="login.html" style="margin-left:10px; color:#0284c7;">Sign in to reply</a>`
              }
              ${owner ? `<button onclick="deleteReview('${id}')">üóëÔ∏è Delete</button>` : ""}
            </div>
            ${repliesHTML}
          </div>
        `;
      }

      // Count + Load more visibility
      if (countEl) countEl.textContent = `Showing ${limit} of ${total}`;
      if (loadMoreBtn) loadMoreBtn.style.display = limit < total ? "inline-block" : "none";
    }

    // =========================
    // Load Reviews (subscribe)
    // =========================
    function loadReviews() {
      const container = document.getElementById("reviewsContainer");
      if (container) {
        container.innerHTML = `<p style="text-align:center;color:#64748b;padding:20px;">Loading reviews‚Ä¶</p>`;
      }
      const reviewsRef = ref(db, "reviews");
      onValue(reviewsRef, (snapshot) => {
        const data = snapshot.val();
        allReviewsEntries = data ? Object.entries(data) : [];
        renderReviews();
      });
    }
    window.loadReviews = loadReviews;

    // =========================
    // Visit Counter
    // =========================
    function updateVisitStats() {
      const totalRef = ref(db, "siteStats/totalVisits");
      const userRef = ref(db, "siteStats/activeUsers/" + currentUserId());
      runTransaction(totalRef, (n) => (n || 0) + 1);
      set(userRef, Date.now());
    }

    // =========================
    // Logout
    // =========================
    window.doLogout = function () {
      localStorage.clear();
      window.location.href = "login.html";
    };

    // =========================
    // Init
    // =========================
    document.addEventListener("DOMContentLoaded", () => {
      // Always show Profile/Favorite in the navbar, but gate with login on click
      ["profile.html", "favorite.html"].forEach((href) => {
        const a = document.querySelector(`.nav-links a[href="${href}"]`);
        if (a && a.closest("li")) {
          a.closest("li").style.display = "block";
          a.addEventListener("click", (e) => {
            if (!isLoggedIn()) {
              e.preventDefault();
              requireLogin("Please log in to access your profile/favourites.");
            }
          });
        }
      });

      // Sorting control
      const sortSelect = document.getElementById("sortSelect");
      const loadMoreBtn = document.getElementById("loadMoreBtn");
      if (sortSelect) {
        sortSelect.value = currentSort;
        sortSelect.addEventListener("change", (e) => {
          currentSort = e.target.value;
          visibleCount = PAGE_SIZE;
          renderReviews();
        });
      }
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener("click", () => {
          visibleCount += PAGE_SIZE;
          renderReviews();
        });
      }

      checkLoginStatus();
      loadReviews();
      updateVisitStats();
    });
}

